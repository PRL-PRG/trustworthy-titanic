
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin15.6.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> ## ----setup, include=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> knitr::opts_chunk$set(echo = TRUE)
> 
> 
> ## ----message=FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # Data input, assesment : ë°ì´í„° ë¶ˆëŸ¬ë“¤ì´ê¸°, í™•ì¸í•˜ëŠ” ê³¼ì • 
> library(readr)           # Data input with readr::read_csv()
> library(descr)           # descr::CrossTable() - ë²”ì£¼ë³„ ë¹ˆë„ìˆ˜, ë¹„ìœ¨ ìˆ˜ì¹˜ë¡œ í™•ì¸
> 
> # Visualization
> library(VIM)             # Missing values assesment used by VIM::aggr()
Loading required package: colorspace
Loading required package: grid
VIM is ready to use.

Suggestions and bug-reports can be submitted at: https://github.com/statistikat/VIM/issues

Attaching package: â€˜VIMâ€™

The following object is masked from â€˜package:datasetsâ€™:

    sleep

> library(ggplot2)         # Used in almost visualization 
Warning message:
package â€˜ggplot2â€™ was built under R version 3.6.2 
> library(RColorBrewer)    # plotì˜ color ì„¤ì • 
> library(scales)          # plot setting - x, y ì¶• ì„¤ì •

Attaching package: â€˜scalesâ€™

The following object is masked from â€˜package:readrâ€™:

    col_factor

Warning message:
package â€˜scalesâ€™ was built under R version 3.6.2 
> 
> # Feature engineering, Data Pre-processing
> # library(tidyverse)     # dplyr, ggplot2, purrr, etc... 
> library(dplyr)           # Feature Engineering & Data Pre-processing 

Attaching package: â€˜dplyrâ€™

The following objects are masked from â€˜package:statsâ€™:

    filter, lag

The following objects are masked from â€˜package:baseâ€™:

    intersect, setdiff, setequal, union

Warning message:
package â€˜dplyrâ€™ was built under R version 3.6.2 
> library(purrr)           # Check missing values 

Attaching package: â€˜purrrâ€™

The following object is masked from â€˜package:scalesâ€™:

    discard

Warning message:
package â€˜purrrâ€™ was built under R version 3.6.2 
> library(tidyr)           # tidyr::gather() 
Warning message:
package â€˜tidyrâ€™ was built under R version 3.6.2 
> 
> # Model generation  
> library(randomForest)    # For Random Forest Modeling
randomForest 4.6-14
Type rfNews() to see new features/changes/bug fixes.

Attaching package: â€˜randomForestâ€™

The following object is masked from â€˜package:dplyrâ€™:

    combine

The following object is masked from â€˜package:ggplot2â€™:

    margin

> 
> # Model validation : ì›ë˜ëŠ” í•˜ëŠ”ê²Œ ë§ì§€ë§Œ ì´ë²ˆ ê³¼ì •ì—ì„œëŠ” ìƒëµ
> # library(caret)           # caret::confusionMatrix() 
> # library(ROCR)            # Plotting ROC Curve
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # Multiple plot function
> #
> # ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
> # - cols:   Number of columns in layout
> # - layout: A matrix specifying the layout. If present, 'cols' is ignored.
> #
> # If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
> # then plot 1 will go in the upper left, 2 will go in the upper right, and
> # 3 will go all the way across the bottom.
> #
> 
> multiplot <- function(..., plotlist = NULL, file, cols = 1, layout = NULL) {
+   library(grid)
+   
+   # Make a list from the ... arguments and plotlist
+   plots <- c(list(...), plotlist)
+   
+   numPlots = length(plots)
+   
+   # If layout is NULL, then use 'cols' to determine layout
+   if (is.null(layout)) {
+     # Make the panel
+     # ncol: Number of columns of plots
+     # nrow: Number of rows needed, calculated from # of cols
+     layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
+                      ncol = cols, nrow = ceiling(numPlots/cols))
+   }
+   
+   if (numPlots==1) {
+     print(plots[[1]])
+     
+   } else {
+     # Set up the page
+     grid.newpage()
+     pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
+     
+     # Make each plot, in the correct location
+     for (i in 1:numPlots) {
+       # Get the i,j matrix positions of the regions that contain this subplot
+       matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
+       
+       print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
+                                       layout.pos.col = matchidx$col))
+     }
+   }
+ }
> 
> 
> ## ----warning=FALSE, message=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train <- readr::read_csv('../input/train.csv')
Parsed with column specification:
cols(
  PassengerId = [32mcol_double()[39m,
  Survived = [32mcol_double()[39m,
  Pclass = [32mcol_double()[39m,
  Name = [31mcol_character()[39m,
  Sex = [31mcol_character()[39m,
  Age = [32mcol_double()[39m,
  SibSp = [32mcol_double()[39m,
  Parch = [32mcol_double()[39m,
  Ticket = [31mcol_character()[39m,
  Fare = [32mcol_double()[39m,
  Cabin = [31mcol_character()[39m,
  Embarked = [31mcol_character()[39m
)
> 
> test  <- readr::read_csv('../input/test.csv')
Parsed with column specification:
cols(
  PassengerId = [32mcol_double()[39m,
  Pclass = [32mcol_double()[39m,
  Name = [31mcol_character()[39m,
  Sex = [31mcol_character()[39m,
  Age = [32mcol_double()[39m,
  SibSp = [32mcol_double()[39m,
  Parch = [32mcol_double()[39m,
  Ticket = [31mcol_character()[39m,
  Fare = [32mcol_double()[39m,
  Cabin = [31mcol_character()[39m,
  Embarked = [31mcol_character()[39m
)
> 
> full <- dplyr::bind_rows(train, test)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full <- full %>%
+   dplyr::mutate(Survived = factor(Survived),
+                 Pclass   = factor(Pclass, ordered = T),
+                 Name     = factor(Name),
+                 Sex      = factor(Sex),
+                 Ticket   = factor(Ticket),
+                 Cabin    = factor(Cabin),
+                 Embarked = factor(Embarked))
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> head(full, 10)
[90m# A tibble: 10 x 12[39m
   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare Cabin
         [3m[90m<dbl>[39m[23m [3m[90m<fct>[39m[23m    [3m[90m<ord>[39m[23m  [3m[90m<fct>[39m[23m [3m[90m<fct>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<fct>[39m[23m  [3m[90m<dbl>[39m[23m [3m[90m<fct>[39m[23m
[90m 1[39m           1 0        3      Brauâ€¦ male     22     1     0 A/5 2â€¦  7.25 [31mNA[39m   
[90m 2[39m           2 1        1      Cumiâ€¦ femaâ€¦    38     1     0 PC 17â€¦ 71.3  C85  
[90m 3[39m           3 1        3      Heikâ€¦ femaâ€¦    26     0     0 STON/â€¦  7.92 [31mNA[39m   
[90m 4[39m           4 1        1      Futrâ€¦ femaâ€¦    35     1     0 113803 53.1  C123 
[90m 5[39m           5 0        3      Alleâ€¦ male     35     0     0 373450  8.05 [31mNA[39m   
[90m 6[39m           6 0        3      Moraâ€¦ male     [31mNA[39m     0     0 330877  8.46 [31mNA[39m   
[90m 7[39m           7 0        1      McCaâ€¦ male     54     0     0 17463  51.9  E46  
[90m 8[39m           8 0        3      Palsâ€¦ male      2     3     1 349909 21.1  [31mNA[39m   
[90m 9[39m           9 1        3      Johnâ€¦ femaâ€¦    27     0     2 347742 11.1  [31mNA[39m   
[90m10[39m          10 1        2      Nassâ€¦ femaâ€¦    14     1     0 237736 30.1  [31mNA[39m   
[90m# â€¦ with 1 more variable: Embarked [3m[90m<fct>[90m[23m[39m
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> str(full)
tibble [1,309 Ã— 12] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ PassengerId: num [1:1309] 1 2 3 4 5 6 7 8 9 10 ...
 $ Survived   : Factor w/ 2 levels "0","1": 1 2 2 2 1 1 1 1 2 2 ...
 $ Pclass     : Ord.factor w/ 3 levels "1"<"2"<"3": 3 1 3 1 3 3 1 3 3 2 ...
 $ Name       : Factor w/ 1307 levels "Abbing, Mr. Anthony",..: 156 287 531 430 23 826 775 922 613 855 ...
 $ Sex        : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...
 $ Age        : num [1:1309] 22 38 26 35 35 NA 54 2 27 14 ...
 $ SibSp      : num [1:1309] 1 1 0 1 0 0 0 3 0 1 ...
 $ Parch      : num [1:1309] 0 0 0 0 0 0 0 1 2 0 ...
 $ Ticket     : Factor w/ 929 levels "110152","110413",..: 721 817 915 66 650 374 110 542 478 175 ...
 $ Fare       : num [1:1309] 7.25 71.28 7.92 53.1 8.05 ...
 $ Cabin      : Factor w/ 186 levels "A10","A11","A14",..: NA 107 NA 71 NA NA 164 NA NA NA ...
 $ Embarked   : Factor w/ 3 levels "C","Q","S": 3 1 3 3 3 2 3 3 3 1 ...
 - attr(*, "spec")=
  .. cols(
  ..   PassengerId = [32mcol_double()[39m,
  ..   Survived = [32mcol_double()[39m,
  ..   Pclass = [32mcol_double()[39m,
  ..   Name = [31mcol_character()[39m,
  ..   Sex = [31mcol_character()[39m,
  ..   Age = [32mcol_double()[39m,
  ..   SibSp = [32mcol_double()[39m,
  ..   Parch = [32mcol_double()[39m,
  ..   Ticket = [31mcol_character()[39m,
  ..   Fare = [32mcol_double()[39m,
  ..   Cabin = [31mcol_character()[39m,
  ..   Embarked = [31mcol_character()[39m
  .. )
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> summary(full)
  PassengerId   Survived   Pclass                                Name     
 Min.   :   1   0   :549   1:323   Connolly, Miss. Kate            :   2  
 1st Qu.: 328   1   :342   2:277   Kelly, Mr. James                :   2  
 Median : 655   NA's:418   3:709   Abbing, Mr. Anthony             :   1  
 Mean   : 655                      Abbott, Master. Eugene Joseph   :   1  
 3rd Qu.: 982                      Abbott, Mr. Rossmore Edward     :   1  
 Max.   :1309                      Abbott, Mrs. Stanton (Rosa Hunt):   1  
                                   (Other)                         :1301  
     Sex           Age            SibSp            Parch            Ticket    
 female:466   Min.   : 0.17   Min.   :0.0000   Min.   :0.000   CA. 2343:  11  
 male  :843   1st Qu.:21.00   1st Qu.:0.0000   1st Qu.:0.000   1601    :   8  
              Median :28.00   Median :0.0000   Median :0.000   CA 2144 :   8  
              Mean   :29.88   Mean   :0.4989   Mean   :0.385   3101295 :   7  
              3rd Qu.:39.00   3rd Qu.:1.0000   3rd Qu.:0.000   347077  :   7  
              Max.   :80.00   Max.   :8.0000   Max.   :9.000   347082  :   7  
              NA's   :263                                      (Other) :1261  
      Fare                     Cabin      Embarked  
 Min.   :  0.000   C23 C25 C27    :   6   C   :270  
 1st Qu.:  7.896   B57 B59 B63 B66:   5   Q   :123  
 Median : 14.454   G6             :   5   S   :914  
 Mean   : 33.295   B96 B98        :   4   NA's:  2  
 3rd Qu.: 31.275   C22 C26        :   4             
 Max.   :512.329   (Other)        : 271             
 NA's   :1         NA's           :1014             
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> VIM::aggr(full, prop = FALSE, combined = TRUE, numbers = TRUE,
+           sortVars = TRUE, sortCombs = TRUE)

 Variables sorted by number of missings: 
    Variable Count
       Cabin  1014
    Survived   418
         Age   263
    Embarked     2
        Fare     1
 PassengerId     0
      Pclass     0
        Name     0
         Sex     0
       SibSp     0
       Parch     0
      Ticket     0
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full %>%
+   dplyr::summarize_all(funs(sum(is.na(.))/n()))
[90m# A tibble: 1 x 12[39m
  PassengerId Survived Pclass  Name   Sex   Age SibSp Parch Ticket    Fare Cabin
        [3m[90m<dbl>[39m[23m    [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m
[90m1[39m           0    0.319      0     0     0 0.201     0     0      0 7.64[90me[39m[31m-4[39m 0.775
[90m# â€¦ with 1 more variable: Embarked [3m[90m<dbl>[90m[23m[39m
Warning message:
`funs()` is deprecated as of dplyr 0.8.0.
Please use a list of either functions or lambdas: 

  # Simple named list: 
  list(mean = mean, median = median)

  # Auto named with `tibble::lst()`: 
  tibble::lst(mean, median)

  # Using lambdas
  list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
[90mThis warning is displayed once every 8 hours.[39m
[90mCall `lifecycle::last_warnings()` to see where this warning was generated.[39m 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # ê° featureì˜ ê²°ì¸¡ì¹˜ ë¹„ìœ¨ ê³„ì‚° -> Data Frame ì†ì„± but 1í–‰ 12ì—´ êµ¬ì¡°ë¡œ ë˜ì–´ìˆìŒ.
> missing_values <- full %>%
+   dplyr::summarize_all(funs(sum(is.na(.))/n()))
> 
> # ìœ„ì—ì„œ êµ¬í•œ missing_valuesë¥¼ 12X2 data frame ìœ¼ë¡œ ìƒì„± 
> missing_values <- tidyr::gather(missing_values,
+                                 key = "feature", value = "missing_pct")
> 
> # missing_valuesë¥¼ ì´ìš©í•œ ì‹œê°í™” 
> missing_values %>% 
+   # Aesthetic setting : missing_pct ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬  
+   ggplot(aes(x = reorder(feature, missing_pct), y = missing_pct)) +
+   # Bar plot 
+   geom_bar(stat = "identity", fill = "red") +
+   # Title generation 
+   ggtitle("Rate of missing values in each features") +
+   # Title detail setting 
+   theme(plot.title = element_text(face = "bold",    # ê¸€ì”¨ì²´ 
+                                   hjust = 0.5,      # Horizon(ê°€ë¡œë¹„ìœ¨) = 0.5
+                                   size = 15, color = "darkblue")) +
+   # x, y axis label setting 
+   labs(x = "Feature names", y = "Rate") + 
+   # Plotì˜ x, yì¶• ë³€í™˜ 
+   coord_flip()
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # ë³€ìˆ˜ë³„ ê²°ì¸¡ì¹˜ ë¹„ìœ¨ ê³„ì‚°
> miss_pct <- purrr::map_dbl(full, function(x){round((sum(is.na(x))/length(x)) * 100, 1) })
> 
> # ê²°ì¸¡ì¹˜ ë¹„ìœ¨ì´ 0%ë³´ë‹¤ í° ë³€ìˆ˜ë“¤ë§Œ ì„ íƒ
> miss_pct <- miss_pct[miss_pct > 0]
> 
> # Data Frame ìƒì„± 
> data.frame(miss = miss_pct, var = names(miss_pct), row.names = NULL) %>%
+   # Aesthetic setting : miss ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ 
+   ggplot(aes(x = reorder(var, miss), y = miss)) + 
+   # Bar plot 
+   geom_bar(stat = 'identity', fill = 'red') +
+   # Plot title setting 
+   ggtitle("Rate of missing values") + 
+   # Title detail setting 
+   theme(plot.title = element_text(face = "bold",    # ê¸€ì”¨ì²´ 
+                                   hjust = 0.5,      # Horizon(ê°€ë¡œë¹„ìœ¨) = 0.5
+                                   size = 15, color = "darkblue")) +
+   # x, y axis label setting 
+   labs(x = 'Feature names', y = 'Rate of missing values') +
+   # Plotì˜ x, yì¶• ë³€í™˜ 
+   coord_flip()
> 
> 
> ## ----message=FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> age.p1 <- full %>% 
+   ggplot(aes(Age)) + 
+   # íˆìŠ¤í† ê·¸ë¨ ê·¸ë¦¬ê¸°, ì„¤ì •
+   geom_histogram(breaks = seq(0, 80, by = 1), # ê°„ê²© ì„¤ì • 
+                  col    = "red",              # ë§‰ëŒ€ ê²½ê³„ì„  ìƒ‰ê¹” 
+                  fill   = "green",            # ë§‰ëŒ€ ë‚´ë¶€ ìƒ‰ê¹” 
+                  alpha  = .5) +               # ë§‰ëŒ€ íˆ¬ëª…ë„ = 50% 
+   # Plot title
+   ggtitle("All Titanic passengers age hitogram") +
+   theme(plot.title = element_text(face = "bold",    # ê¸€ì”¨ì²´ 
+                                   hjust = 0.5,      # Horizon(ê°€ë¡œë¹„ìœ¨) = 0.5
+                                   size = 15, color = "darkblue"))
> 
> age.p2 <- full %>% 
+   # test data setì˜ Survived == NA ì¸ ê°’ë“¤ ì œì™¸ 
+   filter(!is.na(Survived)) %>% 
+   ggplot(aes(Age, fill = Survived)) + 
+   geom_density(alpha = .5) +
+   ggtitle("Titanic passengers age density plot") + 
+   theme(plot.title = element_text(face = "bold", hjust = 0.5,
+                                   size = 15, color = "darkblue"))
> 
> # multiplot layout í˜•ì‹ ì§€ì •
> multi.layout = matrix(c(1, 1, 2, 2), 2, 2, byrow = T)
> 
> # ìœ„ì—ì„œ ìƒì„±í•œ 2ê°œì˜ ê·¸ë˜í”„ í•œ í™”ë©´ì— ì¶œë ¥ 
> multiplot(age.p1, age.p2, layout = multi.layout)
Warning messages:
1: Removed 263 rows containing non-finite values (stat_bin). 
2: Removed 177 rows containing non-finite values (stat_density). 
> 
> 
> ## ----message=FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full %>% 
+   # dplyr::group_by(), summarize() ë¥¼ ì´ìš©í•´ì„œ Pclass ë¹ˆë„ìˆ˜ êµ¬í•˜ê¸°
+   group_by(Pclass) %>% 
+   summarize(N = n()) %>% 
+   # Aesthetic setting 
+   ggplot(aes(Pclass, N)) +
+   geom_col() +
+   # Pclass ë¹ˆë„ìˆ˜ plotì— ì¶œë ¥ 
+   geom_text(aes(label = N),        # Plotì˜ yì— í•´ë‹¹í•˜ëŠ” N(ë¹ˆë„ìˆ˜)ë¥¼ ë§¤í•‘
+             size = 5,              # ê¸€ì”¨ í¬ê¸° 
+             vjust = 1.2,           # vertical(ê°€ë¡œ) ìœ„ì¹˜ ì„¤ì • 
+             color = "#FFFFFF") +   # ê¸€ì”¨ ìƒ‰ê¹” : í°ìƒ‰
+   # Plot title 
+   ggtitle("Number of each Pclass's passengers") + 
+   # Title setting 
+   theme(plot.title = element_text(face = "bold", hjust = 0.5, size = 15)) +
+   # x, y axis name change  
+   labs(x = "Pclass", y = "Count")
`summarise()` ungrouping output (override with `.groups` argument)
> 
> 
> ## ----message=FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # Histogram 
> Fare.p1 <- full %>%
+   ggplot(aes(Fare)) + 
+   geom_histogram(col    = "yellow",
+                  fill   = "blue", 
+                  alpha  = .5) +
+   ggtitle("Histogram of passengers Fare") +
+   theme(plot.title = element_text(face = "bold", hjust = 0.5, size = 15))
> 
> # Boxplot 
> Fare.p2 <- full %>%
+   filter(!is.na(Survived)) %>% 
+   ggplot(aes(Survived, Fare)) + 
+   # ê´€ì¸¡ì¹˜ë¥¼ íšŒìƒ‰ì ìœ¼ë¡œ ì°ë˜, ì¤‘ë³µë˜ëŠ” ë¶€ë¶„ì€ í¼ì§€ê²Œ ê·¸ë ¤ì¤ë‹ˆë‹¤.
+   geom_jitter(col = "gray") + 
+   # ìƒìê·¸ë¦¼ : íˆ¬ëª…ë„ 50% 
+   geom_boxplot(alpha = .5) + 
+   ggtitle("Boxplot of passengers Fare") +
+   theme(plot.title = element_text(face = "bold", hjust = 0.5, size = 15))
> 
> # multiplot layout í˜•ì‹ ì§€ì •
> multi.layout = matrix(c(1, 1, 2, 2), 2, 2)
> 
> # ìœ„ì—ì„œ ìƒì„±í•œ 2ê°œì˜ ê·¸ë˜í”„ í•œ í™”ë©´ì— ì¶œë ¥ 
> multiplot(Fare.p1, Fare.p2, layout = multi.layout)
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
Warning message:
Removed 1 rows containing non-finite values (stat_bin). 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> sex.p1 <- full %>% 
+   dplyr::group_by(Sex) %>% 
+   summarize(N = n()) %>% 
+   ggplot(aes(Sex, N)) +
+   geom_col() +
+   geom_text(aes(label = N), size = 5, vjust = 1.2, color = "#FFFFFF") + 
+   ggtitle("Bar plot of Sex") +
+   labs(x = "Sex", y = "Count")
`summarise()` ungrouping output (override with `.groups` argument)
>   
> sex.p2 <- full[1:891, ] %>% 
+   ggplot(aes(Sex, fill = Survived)) +
+   geom_bar(position = "fill") + 
+   scale_fill_brewer(palette = "Set1") +
+   scale_y_continuous(labels = percent) +
+   ggtitle("Survival Rate by Sex") + 
+   labs(x = "Sex", y = "Rate")
> 
> multi.layout = matrix(rep(c(1, 2), times = 2), 2, 2, byrow = T)
> 
> multiplot(sex.p1, sex.p2, layout = multi.layout)
> 
> mosaicplot(Survived ~ Sex,
+            data = full[1:891, ], col = TRUE,
+            main = "Survival rate by passengers gender")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full <- full %>%
+   # ê²°ì¸¡ì¹˜(NA)ë¥¼ ë¨¼ì € ì±„ìš°ëŠ”ë° ê²°ì¸¡ì¹˜ë¥¼ ì œì™¸í•œ ê°’ë“¤ì˜ í‰ê· ìœ¼ë¡œ ì±„ì›€.
+   mutate(Age = ifelse(is.na(Age), mean(full$Age, na.rm = TRUE), Age),
+          # Age ê°’ì— ë”°ë¼ ë²”ì£¼í˜• íŒŒìƒ ë³€ìˆ˜ Age.Group ë¥¼ ìƒì„±
+          Age.Group = case_when(Age < 13             ~ "Age.0012",
+                                Age >= 13 & Age < 18 ~ "Age.1317",
+                                Age >= 18 & Age < 60 ~ "Age.1859",
+                                Age >= 60            ~ "Age.60inf"),
+          # Chr ì†ì„±ì„ Factorë¡œ ë³€í™˜ 
+          Age.Group = factor(Age.Group))
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full <- full %>% 
+   # SibSp, Parchì™€ 1(ë³¸ì¸)ì„ ë”í•´ì„œ FamilySizeë¼ëŠ” íŒŒìƒë³€ìˆ˜ë¥¼ ë¨¼ì € ìƒì„±  
+   mutate(FamilySize = .$SibSp + .$Parch + 1,
+          # FamilySize ì˜ ê°’ì— ë”°ë¼ì„œ ë²”ì£¼í˜• íŒŒìƒ ë³€ìˆ˜ FamilySized ë¥¼ ìƒì„± 
+          FamilySized = dplyr::case_when(FamilySize == 1 ~ "Single",
+                                         FamilySize >= 2 & FamilySize < 5 ~ "Small",
+                                         FamilySize >= 5 ~ "Big"),
+          # Chr ì†ì„±ì¸ FamilySizedë¥¼ factorë¡œ ë³€í™˜í•˜ê³ 
+          # ì§‘ë‹¨ ê·œëª¨ í¬ê¸°ì— ë”°ë¼ levelsë¥¼ ìƒˆë¡œ ì§€ì •
+          FamilySized = factor(FamilySized, levels = c("Single", "Small", "Big")))
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # ìš°ì„  Name ì—´ë²¡í„°ë§Œ ì¶”ì¶œí•´ì„œ title ë²¡í„°ì— ì €ì¥ 
> title <- full$Name
> 
> # ì •ê·œí‘œí˜„ì‹ê³¼ gsub()ì„ ì´ìš©í•´ì„œ ì„±ë³„ê³¼ ê´€ë ¨ì„±ì´ ë†’ì€ ì´ë¦„ë§Œ ì¶”ì¶œí•´ì„œ title ë²¡í„°ë¡œ ì €ì¥ 
> title <- gsub("^.*, (.*?)\\..*$", "\\1", title)
> 
> # ìœ„ì—ì„œ ì €ì¥í•œ title ë²¡í„°ë¥¼ ë‹¤ì‹œ full ì— ì €ì¥í•˜ë˜, title íŒŒìƒë³€ìˆ˜ë¡œ ì €ì¥ 
> full$title <- title
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> unique(full$title)
 [1] "Mr"           "Mrs"          "Miss"         "Master"       "Don"         
 [6] "Rev"          "Dr"           "Mme"          "Ms"           "Major"       
[11] "Lady"         "Sir"          "Mlle"         "Col"          "Capt"        
[16] "the Countess" "Jonkheer"     "Dona"        
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # ë²”ì£¼ë³„ ë¹ˆë„ìˆ˜, ë¹„ìœ¨ í™•ì¸ 
> descr::CrossTable(full$title)
   Cell Contents 
|-------------------------|
|                       N | 
|           N / Row Total | 
|-------------------------|

|         Capt |          Col |          Don |         Dona |           Dr |
|--------------|--------------|--------------|--------------|--------------|
|            1 |            4 |            1 |            1 |            8 |
|        0.001 |        0.003 |        0.001 |        0.001 |        0.006 |
|--------------|--------------|--------------|--------------|--------------|

|     Jonkheer |         Lady |        Major |       Master |         Miss |
|--------------|--------------|--------------|--------------|--------------|
|            1 |            1 |            2 |           61 |          260 |
|        0.001 |        0.001 |        0.002 |        0.047 |        0.199 |
|--------------|--------------|--------------|--------------|--------------|

|         Mlle |          Mme |           Mr |          Mrs |           Ms |
|--------------|--------------|--------------|--------------|--------------|
|            2 |            1 |          757 |          197 |            2 |
|        0.002 |        0.001 |        0.578 |        0.150 |        0.002 |
|--------------|--------------|--------------|--------------|--------------|

|          Rev |          Sir | the Countess |
|--------------|--------------|--------------|
|            8 |            1 |            1 |
|        0.006 |        0.001 |        0.001 |
|--------------|--------------|--------------|

> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # 5ê°œ ë²”ì£¼ë¡œ ë‹¨ìˆœí™” ì‹œí‚¤ëŠ” ì‘ì—… 
> full <- full %>%
+   # "%in%" ëŒ€ì‹  "=="ì„ ì‚¬ìš©í•˜ê²Œë˜ë©´ Recyling Rule ë•Œë¬¸ì— ì›í•˜ëŠ”ëŒ€ë¡œ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
+   mutate(title = ifelse(title %in% c("Mlle", "Ms", "Lady", "Dona"), "Miss", title),
+          title = ifelse(title == "Mme", "Mrs", title),
+          title = ifelse(title %in% c("Capt", "Col", "Major", "Dr", "Rev", "Don",
+                                      "Sir", "the Countess", "Jonkheer"), "Officer", title),
+          title = factor(title))
> 
> # íŒŒìƒë³€ìˆ˜ ìƒì„± í›„ ê° ë²”ì£¼ë³„ ë¹ˆë„ìˆ˜, ë¹„ìœ¨ í™•ì¸ 
> descr::CrossTable(full$title)
   Cell Contents 
|-------------------------|
|                       N | 
|           N / Row Total | 
|-------------------------|

|  Master |    Miss |      Mr |     Mrs | Officer |
|---------|---------|---------|---------|---------|
|      61 |     266 |     757 |     198 |      27 |
|   0.047 |   0.203 |   0.578 |   0.151 |   0.021 |
|---------|---------|---------|---------|---------|

> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # ê³ ìœ í•œ(uniqueí•œ) ë²”ì£¼ì˜ ê°¯ìˆ˜ë§Œ íŒŒì•…í•˜ë ¤ê³  length()ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
> length(unique(full$Ticket))
[1] 929
> 
> # ëª¨ë‘ ì¶œë ¥í•˜ë©´ ë„ˆë¬´ ì§€ì €ë¶„í•´ì„œ 10ê°œë§Œ ì¶œë ¥í–ˆìŠµë‹ˆë‹¤.
> head(summary(full$Ticket), 10)
    CA. 2343         1601      CA 2144      3101295       347077       347082 
          11            8            8            7            7            7 
    PC 17608 S.O.C. 14879       113781        19950 
           7            7            6            6 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full %>% 
+   # í‹°ì¼“ì´ ì¼ì¹˜í•˜ëŠ” 11ëª…ì˜ ìŠ¹ê°ë“¤ë§Œ í•„í„°ë§ 
+   filter(Ticket == "CA. 2343") %>% 
+   # ëª¨ë“  ë³€ìˆ˜ì— ëŒ€í•´ í™•ì¸í•  í•„ìš”ëŠ” ì—†ìœ¼ë¯€ë¡œ ì•„ë˜ ë³€ìˆ˜ë“¤ë§Œ ë³´ë ¤ê³  í•©ë‹ˆë‹¤.
+   select(Pclass, Name, Age, FamilySized)
[90m# A tibble: 11 x 4[39m
   Pclass Name                                    Age FamilySized
   [3m[90m<ord>[39m[23m  [3m[90m<fct>[39m[23m                                 [3m[90m<dbl>[39m[23m [3m[90m<fct>[39m[23m      
[90m 1[39m 3      [90m"[39mSage, Master. Thomas Henry[90m"[39m           29.9 Big        
[90m 2[39m 3      [90m"[39mSage, Miss. Constance Gladys[90m"[39m         29.9 Big        
[90m 3[39m 3      [90m"[39mSage, Mr. Frederick[90m"[39m                  29.9 Big        
[90m 4[39m 3      [90m"[39mSage, Mr. George John Jr[90m"[39m             29.9 Big        
[90m 5[39m 3      [90m"[39mSage, Miss. Stella Anna[90m"[39m              29.9 Big        
[90m 6[39m 3      [90m"[39mSage, Mr. Douglas Bullen[90m"[39m             29.9 Big        
[90m 7[39m 3      [90m"[39mSage, Miss. Dorothy Edith \"Dolly\"[90m"[39m  29.9 Big        
[90m 8[39m 3      [90m"[39mSage, Miss. Ada[90m"[39m                      29.9 Big        
[90m 9[39m 3      [90m"[39mSage, Mr. John George[90m"[39m                29.9 Big        
[90m10[39m 3      [90m"[39mSage, Master. William Henry[90m"[39m          14.5 Big        
[90m11[39m 3      [90m"[39mSage, Mrs. John (Annie Bullen)[90m"[39m       29.9 Big        
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # ìš°ì„  ticket.uniqueê°€ ëª¨ë‘ 0ì´ë¼ê³  ì €ì¥í•¨
> ticket.unique <- rep(0, nrow(full))
> 
> # Ticket Featureì—ì„œ ê³ ìœ í•œ ê²ƒë“¤ë§Œ ì¶”ì¶œí•´ì„œ tickets ë²¡í„°ì— ì €ì¥ 
> tickets <- unique(full$Ticket)
> 
> # ë°˜ë³µë¬¸ì„ ì¤‘ì²© í™œìš©í•´ì„œ í‹°ì¼“ì´ ê°™ì€ ìŠ¹ê°ë“¤ë§Œ ì¶”ì¶œ í›„, ê° í‹°ì¼“ë“¤ì˜ ê¸¸ì´(ë¬¸ì ê°¯ìˆ˜)ë¥¼ ì¶”ì¶œí•´ì„œ ì €ì¥í•œë‹¤.
> for (i in 1:length(tickets)) {
+   current.ticket <- tickets[i]
+   party.indexes <- which(full$Ticket == current.ticket)
+     # For loop ì¤‘ì²© 
+     for (k in 1:length(party.indexes)) {
+     ticket.unique[party.indexes[k]] <- length(party.indexes)
+     }
+   }
> 
> # ìœ„ì—ì„œ ê³„ì‚°í•œ ticket.unique ì„ íŒŒìƒë³€ìˆ˜ë¡œ ì €ì¥ 
> full$ticket.unique <- ticket.unique
> 
> # ticket.uniqueì— ë”°ë¼ ì„¸ê°€ì§€ ë²”ì£¼ë¡œ ë‚˜ëˆ ì„œ ticket.size ë³€ìˆ˜ ìƒì„± 
> full <- full %>% 
+   mutate(ticket.size = case_when(ticket.unique == 1 ~ 'Single',
+                                  ticket.unique < 5 & ticket.unique >= 2 ~ "Small",
+                                  ticket.unique >= 5 ~ "Big"),
+          ticket.size = factor(ticket.size,
+                               levels = c("Single", "Small", "Big")))
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full$Embarked <- replace(full$Embarked,               # ì¹˜í™˜í•  Data$feature ì§€ì •
+                          which(is.na(full$Embarked)), # ê²°ì¸¡ì¹˜ë“¤ë§Œ ì°¾ê¸°
+                          'S')                         # ì¹˜í™˜í•  ê°’ ì§€ì • 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full$Fare <- replace(full$Fare, which(is.na(full$Fare)), 0)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # feature selection ì „ì´ë¯€ë¡œ ìš°ì„ ì€ ëª¨ë“  ë³€ìˆ˜ë“¤ì„ ì„ íƒí•©ë‹ˆë‹¤.
> train <- full[1:891, ]
> 
> test <- full[892:1309, ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train %>% 
+   ggplot(aes(Pclass, fill = Survived)) + 
+   geom_bar(position = "fill") +
+   # plot í…Œë§ˆ ì„¤ì • : ì¡°ê¸ˆ ë” ì„ ëª…í•œ ìƒ‰ê¹”ë¡œ ë³€í™˜í•´ì¤€ë‹¤.
+   scale_fill_brewer(palette = "Set1") +
+   # Y axis setting 
+   scale_y_continuous(labels = percent) +
+   # x, y ì¶• ì´ë¦„ê³¼ plotì˜ main title, sub title ì„¤ì • 
+   labs(x = "Pclass", y = "Rate",
+        title = "Bar plot", subtitle = "How many people survived in each Pclass?")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> mosaicplot(Survived ~ Sex,
+            data = train, col = TRUE,
+            main = "Survival rate by passengers gender")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train %>% 
+   ggplot(aes(Embarked, fill = Survived)) +
+   geom_bar(position = "fill") + 
+   scale_fill_brewer(palette = "Set1") +
+   scale_y_continuous(labels = percent) +
+   labs(x = "Embarked", y = "Rate",
+        title = "Bar plot", subtitle = "How many people survived in each Embarked?")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train %>% 
+   ggplot(aes(FamilySized, fill = Survived)) + 
+   geom_bar(position = "fill") + 
+   scale_fill_brewer(palette = "Set1") + 
+   scale_y_continuous(labels = percent) +
+   labs(x = "FamilySized", y = "Rate",
+        title = "Bar plot", subtitle = "Survival rate by FamilySized")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train %>% 
+   ggplot(aes(Age.Group, fill = Survived)) + 
+   geom_bar(position = "fill") + 
+   scale_fill_brewer(palette = "Set1") + 
+   scale_y_continuous(labels = percent) +
+   labs(x = "Age group", y = "Rate",
+        title = "Bar plot", subtitle = "Survival rate by Age group")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train %>% 
+   ggplot(aes(title, fill = Survived)) + 
+   geom_bar(position = "fill") + 
+   scale_fill_brewer(palette = "Set1") + 
+   scale_y_continuous(labels = percent) +
+   labs(x = "title", y = "Rate",
+        title = "Bar plot", subtitle = "Survival rate by passengers title")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train %>% 
+   ggplot(aes(ticket.size, fill = Survived)) + 
+   geom_bar(position = "fill") + 
+   scale_fill_brewer(palette = "Set1") + 
+   scale_y_continuous(labels = percent) +
+   labs(x = "ticket.size", y = "Rate",
+        title = "Bar plot", subtitle = "Survival rate by ticket.size")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # Id number ì œì™¸í•˜ê³  ì‹¤ì œë¡œ ì‚¬ìš©í•  7ê°œ ì…ë ¥ë³€ìˆ˜ì™€ 1ê°œì˜ íƒ€ê²Ÿë³€ìˆ˜ë¥¼ ì„ íƒ, ì €ì¥ 
> train <- train %>% 
+   select("Pclass", "Sex", "Embarked", "FamilySized",
+          "Age.Group", "title", "ticket.size", "Survived")
> 
> # Submitì„ ìœ„í•´ì„œ Id ì—´ë²¡í„° ì¶”ì¶œí•´ì„œ IDì— ì €ì¥ 
> ID <- test$PassengerId
> 
> # Idì™€ Survivedë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ 6ê°œ ë³€ìˆ˜ë“¤ì„ ì„ íƒ, ì €ì¥ 
> test <- test %>% 
+   select("Pclass", "Sex", "Embarked", "FamilySized",
+          "Age.Group", "title", "ticket.size")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # ì¬í˜„ì„±ì„ ìœ„í•´ì„œ seed numberë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
> set.seed(1901)
> 
> titanic.rf <- randomForest(Survived ~ ., data = train, importance = T, ntree = 2000)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> importance(titanic.rf)
                    0        1 MeanDecreaseAccuracy MeanDecreaseGini
Pclass      47.360545 55.62872             66.31022        36.760810
Sex         52.420408 35.59064             56.91694        54.419528
Embarked    -6.251717 38.21176             28.54509         9.347211
FamilySized 30.474466 30.59797             48.64847        18.023144
Age.Group   14.657035 27.29525             29.44747        10.074983
title       49.844635 43.18055             59.19629        76.104303
ticket.size 41.578242 38.28502             60.90637        23.002893
> 
> varImpPlot(titanic.rf)
> 
> 
> ## ----eval=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> ## # Prediction
> ## pred.rf <- predict(object = titanic.rf, newdata = test, type = "class")
> ## 
> ## # Data frame generation
> ## submit <- data.frame(PassengerID = ID, Survived = pred.rf)
> ## 
> ## # Write the submit data frame to file : setwd()ë¡œ ì§€ì •í•´ë†“ì€ í´ë”ì— csvë¡œ ìƒì„±ë©ë‹ˆë‹¤.
> ## write.csv(submit, file = './titanic_submit.csv', row.names = F)
> 
> 
> proc.time()
   user  system elapsed 
  6.422   0.330   6.912 
