{"cells":[{"metadata":{"trusted":true,"_uuid":"828dde6b2e810066c46d0f27e955184adc1eceb1"},"cell_type":"markdown","source":"# **Titanic Disaster - Finding Fate with science.**"},{"metadata":{"_uuid":"724de0e1a62fbf133ce062dcc54be980225e09c9"},"cell_type":"markdown","source":"**Introduction to titanic data set:**\n\nThe sinking of the RMS Titanic is one of the most infamous shipwrecks in history.  On April 15, 1912, during her maiden voyage, the Titanic sank after colliding with an iceberg, killing 1502 out of 2224 passengers and crew. This sensational tragedy shocked the international community and led to better safety regulations for ships.\n\nOne of the reasons that the shipwreck led to such loss of life was that there were not enough lifeboats for the passengers and crew. Although there was some element of luck involved in surviving the sinking, some groups of people were more likely to survive than others, such as women, children, and the upper-class.\n\nIn this challenge, we ask you to complete the analysis of what sorts of people were likely to survive. In particular, we ask you to apply the tools of machine learning to predict which passengers survived the tragedy."},{"metadata":{"_uuid":"d1324b6b810cc134a26017540ccc55eb3f87ce3e"},"cell_type":"markdown","source":"This is my first kernel to explore data and find insights after I am introduced to machine learning. Here I tired to explore the data as much as I can, draw some hidden insights and inforamtion about each passanger from the available data."},{"metadata":{"_uuid":"e3a13c4651d8ebaf051724c324feda9d8863e9be"},"cell_type":"markdown","source":"**Libraries Used and data**"},{"metadata":{"trusted":true,"_uuid":"1f540151d05afbbfab9ecdcad4af2ea35b7d5414","_kg_hide-output":true,"_kg_hide-input":false},"cell_type":"code","source":"#requuired libraries\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(gridExtra)\nlibrary(DMwR)\nlibrary(dummies)\nlibrary(ROCR)\nlibrary(randomForest)\n\n#Lets read the data \ntrain = read.csv('../input/train.csv')\ntest = read.csv('../input/test.csv')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"92230fdb2f526a88bbd03279e7b00826281e973a"},"cell_type":"markdown","source":"Lets combine train and test data, so that any exploartion and feature engineering will be similar throughout all the data. For this lets include Survived column in Test data with NA values, by this we can seperate the train and test when model bulding."},{"metadata":{"_kg_hide-output":true,"_kg_hide-input":false,"trusted":true,"_uuid":"1a5d2888ad7392d4e3447b5ea545400fbfd98c9b"},"cell_type":"code","source":"test$Survived <- NA\ncmp_titanic = rbind(train, test)\nsummary(cmp_titanic)","execution_count":null,"outputs":[]},{"metadata":{"_kg_hide-output":false,"_kg_hide-input":false,"trusted":true,"_uuid":"cce39401181bc1c8f11a7e5c9bd87676bc53a727"},"cell_type":"markdown","source":"From the above summary, we can see that Age feature has 263 NA's and 418 NA's in survived as we combine test and train data.\nlest see the structuer of the data"},{"metadata":{"trusted":true,"_uuid":"abe8ef885d990b9261c221bdf2212aa2d3c768ab","_kg_hide-output":true},"cell_type":"code","source":"str(cmp_titanic)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2978f61137045ecfc879992a9138e03cc2f01ff5"},"cell_type":"markdown","source":"#lest convert required columns to factor variables"},{"metadata":{"trusted":true,"_uuid":"f65b74210890faafc8ec60a06bc32f959c99fd29","_kg_hide-output":true},"cell_type":"code","source":"cmp_titanic$Survived <- as.factor(cmp_titanic$Survived)\ncmp_titanic$Pclass <- as.factor(cmp_titanic$Pclass)\ncmp_titanic$Name <- as.character(cmp_titanic$Name)\nstr(cmp_titanic)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a7fb11a7cdcb57cb0b0f70afed7073eb2930bce8"},"cell_type":"markdown","source":"#Survived\nLets see data in terms of our trget variablle - Survided"},{"metadata":{"trusted":true,"_uuid":"8214e67dedab3d87d77f11b6a9cb3e311d6705d9","_kg_hide-output":false},"cell_type":"code","source":"table(cmp_titanic$Survived)\n\nggplot(cmp_titanic[!is.na(cmp_titanic$Survived),],aes(Survived, fill = Survived)) +\n  geom_bar()+\n  labs(x= 'Survival Rate')+\n  geom_label(stat = 'count', aes(label = ..count..), size = 4)+\n  theme_grey(base_size = 18)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"07a6ca9310cc6ddbb24d956125cb31066e6d46aa"},"cell_type":"markdown","source":"#Sex"},{"metadata":{"trusted":true,"_uuid":"1f877363fd4dfe4cd41566fd1cb03898c83375ad","_kg_hide-output":false},"cell_type":"code","source":"g1 <- ggplot(cmp_titanic, aes(Sex, fill = Sex)) +\n  geom_bar()+\n  labs(x='Gender Distribution in complete data')+\n  geom_label(stat = 'count',aes(label=..count..))+\n  scale_fill_manual(values = c(\"female\" = \"yellow\", \"male\" = \"sky blue\"))\n\ng2 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(x=Sex, fill = Survived))+\n  geom_bar()+\n  labs(x='Train data - Survival distribution across genders')+\n  geom_label(stat = 'count',aes(label=..count..),position = \"stack\")+\n  scale_fill_manual('legend',values = c(\"0\" = \"red\", \"1\" = \"green\"))\n\ngrid.arrange(g1, g2, ncol=2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7d00160ad40ed43fd6ef13444d2d2c5cae27ac9b"},"cell_type":"markdown","source":"#Name\nName here is a full name of a passsanger and we can extract last name\nand title from it.\n\n#Last name"},{"metadata":{"trusted":true,"_uuid":"18e3f502c24130c02e810ac757aa581eef94c383","_kg_hide-output":false},"cell_type":"code","source":"cmp_titanic$LastName = unlist(lapply(cmp_titanic$Name, function(x){unlist(strsplit(x, split='[,.]'))[1]}))\n\ndata.frame(table(cmp_titanic$LastName))%>%\n  group_by(Freq)%>%\n  summarise(groups = n())","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"3548c060b7703a9490a825c0e998e86ea1748ca5"},"cell_type":"markdown","source":"Almost half of the surnames are present only once in the passanger list\n#Title"},{"metadata":{"trusted":true,"_uuid":"2f0654694ec9036ef04ba0e02d7a59f93b05ebe1"},"cell_type":"code","source":"cmp_titanic$Title <-unlist(lapply(cmp_titanic$Name,\n                                  function(x){unlist(strsplit(x, '[,.]'))[2]}))\ncmp_titanic$Title <- trimws(cmp_titanic$Title)\ndata.frame(table(cmp_titanic$Title))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"278a4382c76db7e641a0450daa7d55bf22b14a49"},"cell_type":"markdown","source":"we can see most of the titles are Master, Miss, Mr, Mrs.\nSome googling suguest me to use Ms as Miss, so lets assign that"},{"metadata":{"trusted":true,"_uuid":"2911d6d211beeeac76d4d34efd1f653563c98598"},"cell_type":"code","source":"cmp_titanic$Title <- ifelse(cmp_titanic$Title=='Ms', 'Miss', cmp_titanic$Title)","execution_count":null,"outputs":[]},{"metadata":{"_kg_hide-input":false,"_kg_hide-output":true,"_uuid":"c19c9e3db1d909889bec401e2032cebaf5f178f8"},"cell_type":"markdown","source":"Reamining all titles are very less in number and they seems to be a representation of status. Lets group them all together"},{"metadata":{"trusted":true,"_uuid":"8ddfd9018ed729868ba100bddd4fe631be2170b9"},"cell_type":"code","source":"cmp_titanic$Title <- ifelse(cmp_titanic$Title %in% c('Master','Miss','Mr', 'Mrs'),\n                            cmp_titanic$Title, 'Rare')\ncmp_titanic$Title <- as.factor(cmp_titanic$Title)\n\ng1 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(Title, fill = Survived))+\n  geom_bar(position = 'fill')+\n  labs(x='Survival rate across Titles')\n\ng2 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(Title, fill=Survived))+\n  geom_bar(position = 'stack')+\n  facet_grid(.~Pclass)+\n  labs(x='Pclass wise survival for each Title')+\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\ngrid.arrange(g1, g2, ncol = 2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2356e01f8b6fe40959946cd77480478680a8665b"},"cell_type":"markdown","source":"#Passanger class"},{"metadata":{"trusted":true,"_uuid":"9c195737cbb833ff16b760c24a774dda532f7a9d"},"cell_type":"code","source":"g1 <- ggplot(cmp_titanic, aes(Pclass, fill = Pclass)) +\n  geom_bar() +\n  geom_label(stat = 'count', aes(label = ..count..)) +\n  labs(x='PClass Distribution in complete data')\n\ng2 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(x=Pclass, fill = Survived)) +\n  geom_bar(stat='count',position = 'stack') +\n  labs(x='Train Data - Survived vs Not across Classes')\n\ng3 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(x=Sex, fill = Survived)) +\n  geom_bar(stat='count',position = 'fill') +\n  labs(x='Train Data - Survived vs Not as per gender across Classes')+\n  facet_grid(.~Pclass)+\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\ngrid.arrange(g1, g2, g3, ncol=3)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f057447280f6685e7edca118f7e6bac4c1154499"},"cell_type":"markdown","source":"#Age"},{"metadata":{"trusted":true,"_uuid":"15a23149f2170fa63d55e8635ed9f90ae8d8866c"},"cell_type":"code","source":"nrow(cmp_titanic)\nsummary(cmp_titanic$Age)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2e2456744e641cf4d0069742a6c9355c490cb222"},"cell_type":"markdown","source":"Age has 263 NA's of 1309, which means 20% of data is not available"},{"metadata":{"trusted":true,"_uuid":"cf4672510171dde54d837b10269a1cd00c5856f6"},"cell_type":"code","source":"g1 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Age) & !is.na(cmp_titanic$Survived),],\n       aes(Age, fill = Survived))+\n  geom_density(alpha=0.5)+\n  labs(x='Age density to survival')\n\ng2 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Age) & !is.na(cmp_titanic$Survived),],\n       aes(Age, fill = Survived))+\n  geom_density(alpha=0.5)+\n  scale_fill_manual(values = c('red', 'green'))+\n  facet_grid(.~Pclass)+\n  labs(x='Age Density across Pclass to survival')\n\ng3 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Age),], aes(x=Title, y=Age))+\n  geom_boxplot()+\n  labs(x= 'Age distribution across Titles')\n\ng4 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Age),], aes(Title, y=Age, fill = Pclass))+\n  geom_boxplot()+\n  labs(x= 'Age distribution as per Pclass across Titles')+\n  scale_fill_manual('legend', values = c('1' ='yellow', '2' = 'violet', '3' ='navy blue'))\n\ngrid.arrange(g1, g3, g2, g4, nrow = 2, top = 'Age distribution Models')\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"580f1717ce4fe48dc3c32c32b12f6ba31e31be16"},"cell_type":"markdown","source":"As age is an important feature that effect the survival of a passanger, we have to impute it."},{"metadata":{"_uuid":"836b709d43936a0bc9067a961cda71c7ea062154"},"cell_type":"markdown","source":"#SibSp and Parch\nThese two represent the presence of family memebers along with each passanges, lets see how many of family members present of each passanger."},{"metadata":{"trusted":true,"_uuid":"611e0fba4ace26fad747ed99f79dd2465b0e1702"},"cell_type":"code","source":"cmp_titanic$Family = cmp_titanic$SibSp + cmp_titanic$Parch + 1\n\ndata.frame(table(cmp_titanic$Family))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"84767091a0680c70c08aed861b9985f74beff83b"},"cell_type":"markdown","source":"790 passangers traveling alone"},{"metadata":{"trusted":true,"_uuid":"11a2067f7db6795b4df653eb89568f1259e09684"},"cell_type":"code","source":"g1 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(Family, fill = Survived))+\n  geom_bar(position = 'stack')+\n  scale_x_continuous(breaks = seq(1,12,1))+\n  labs(x='Survival as per family size')\n\ng2 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(Family, fill = Survived))+\n  geom_bar()+\n  scale_x_continuous(breaks = seq(1,12,1))+\n  facet_wrap(.~Sex+Pclass, ncol = 3)+\n  labs(x='PClass - Gender - Family size')\n\ngrid.arrange(g1, g2, nrow = 2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e349b6a3ec62ff1760f510370633313069377c8f"},"cell_type":"markdown","source":"#lets see the realtion between family size and Last name of passanger"},{"metadata":{"_kg_hide-output":true,"trusted":true,"_uuid":"78c2b53328732805cfc0748a61f8c934566253a5"},"cell_type":"code","source":"cmp_titanic[cmp_titanic$LastName=='Allison',c('Survived','Pclass','Name',\n                                              'Sex','Age','SibSp','Parch',\n                                              'Ticket','Title','LastName','Family')]\ncmp_titanic[cmp_titanic$LastName=='Boulos',c('Survived','Pclass','Name',\n                                             'Sex','Age','SibSp','Parch',\n                                             'Ticket','Title','LastName','Family')]\ncmp_titanic[cmp_titanic$LastName=='Brown',c('Survived','Pclass','Name',\n                                             'Sex','Age','SibSp','Parch',\n                                             'Ticket','Title','LastName','Family')]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7e1d20e5b7e511e6d37ee4126f56f57090824eb8"},"cell_type":"markdown","source":"If we see there are four sets of people in the 'Brown' group one is a family of \n3 members, two are individuals travelling alone but here Mrs. John Murray\n(Caroline Lane Lamson)' mentioned as family of 3 but there are no one with the same\nlast name belong to this family.\n\nSo, Family size or Last Name not significant to define a family together, For this Iam\ngoing to create a combined feature for this with Fmaily size and ticket number"},{"metadata":{"trusted":true,"_uuid":"a25f42303dd0564b3c2921d1b071ed899e5e6d69"},"cell_type":"code","source":"cmp_titanic$Fml_Tkt = paste(cmp_titanic$Family,cmp_titanic$Ticket, sep = '-')\n#now lets see the same records\ncmp_titanic[cmp_titanic$LastName=='Brown',c('Survived','Pclass','Name',\n                                            'Sex','Age','SibSp','Parch',\n                                            'Ticket','Family','Fml_Tkt')]\n\ncmp_titanic[cmp_titanic$Fml_Tkt=='3-11769',]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"861f1b2b94206f9c2b0efdac80dc99a65345eaeb"},"cell_type":"markdown","source":"On this ticket there has been booking for 3 members but here only 2 members onboarded \nto the ship.\n\nMeans one might cancelled thier ticket or thier might not onboard, anyway not all family/friends \nmembers mentioned in the ticket onboard to the ship."},{"metadata":{"trusted":true,"_uuid":"d1347e4d8df735b0c67b5c573092971a76847602"},"cell_type":"code","source":"cmp_titanic[cmp_titanic$Fml_Tkt=='1-110152',]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"036bd6319d66853b036cbafe88586c40e2f27ff8"},"cell_type":"markdown","source":"If we see this ticket  they are not a family but they onboard together they might be friends\ntraviling together\nAs number of family/friends defenitly effect the survival as we saw, real effect will be\nby onboarded members rather than they mentioned in the tickets as family members\n\nlets create a feature that indicates the number of people onboard"},{"metadata":{"trusted":true,"_uuid":"de0068df7c26856b3c4b3ed73cb0fc4a0cf4226f"},"cell_type":"code","source":"cmp_titanic[cmp_titanic$LastName=='Andersson',]\ncmp_titanic[cmp_titanic$Fml_Tkt=='7-347082',]\n\nPasngr_Ticket <- data.frame(cmp_titanic%>%\n                              group_by(Ticket)%>%\n                              summarise(OnBrd_2gtr = n()))\n\ncmp_titanic = left_join(cmp_titanic,Pasngr_Ticket,by=\"Ticket\")\ncmp_titanic[cmp_titanic$LastName=='Andersson',]\n\nnrow(cmp_titanic[cmp_titanic$Family!=cmp_titanic$OnBrd_2gtr,])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2b9907b53ef4d6fcab33318fd2d58d97a9b26c19"},"cell_type":"markdown","source":"Here there are 284 passangers who have a difference between family members and onboarded together\nwe can look for a second degree family realtion in the passangers who have a difference in family memebers and onboard members\n\nLets see a paassanger"},{"metadata":{"trusted":true,"_uuid":"eba2225762cbb381a4817dfb9c291044fbb08fcb"},"cell_type":"code","source":"cmp_titanic[cmp_titanic$Ticket %in% c('PC 17558','PC 17761'),]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"119fc19761367c8f33ab002685fba7e04acc02bb"},"cell_type":"markdown","source":"Here these six members by family name they are two families but they are all ralated.\nPassanger #1076 is a daughter of #300 and been married to son of #545 and passanger 1076 is travelling with her mother(#300) and brother(#119) rether then her uncle and aunt. \n\nAnd here #538 with different family name is traveling with family Douglas without a cabin, she might be a friend of them with missing data, or a servent travelling with them.\n\nSo we can correct the family members number by looking to second degree family name from maiden names of passangers but I am not going to that level, as I think ticket and OnBrd_2gtr can explain the relations.\n\nLets see the survial rate per onboard together"},{"metadata":{"trusted":true,"_uuid":"fa6f4d23326ba7447554d18df72085f55cafa912"},"cell_type":"code","source":"g1 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(Family, fill = Survived))+\n  geom_bar(position = 'dodge')+\n  scale_x_continuous(breaks = seq(1,12,1))+\n  labs(x='Survival as per family size')\n\ng2 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(OnBrd_2gtr, fill = Survived))+\n  geom_bar(position = 'dodge')+\n  scale_x_continuous(breaks = seq(1,12,1))+\n  labs(x='Survival as per onboard together')\n\ngrid.arrange(g1, g2, ncol=1)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"92916854c98e0854398d38935f5e3ff11766e0a7"},"cell_type":"markdown","source":"Here are the differences between survivals of actual family noted and onboared, the real effect will be by actual onboared.\n\n#Fare"},{"metadata":{"trusted":true,"_uuid":"6ed5e16a2319b3767af43ac3f8b91574af1a019a"},"cell_type":"code","source":"head(cmp_titanic[cmp_titanic$Pclass=='1',-c(4,5,6,7,8)])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"64f12a21cc71e152ba55a45659d8596f39e50556"},"cell_type":"markdown","source":"Here we can see the data, fare is the amount charged by passangers per ticket onboard charges per passanger class wise are approximatley equal, but there is a slight difference, i think it is due to the room allocation. People onboared to upeer deck will be charged a bit more than the lower floors and luggage will also influence the price.\nEach room is 1/2/3 sharing In some cases a single passanger books a whole room. In 1st class, we can see that ecah cabin has been provided to at max two passangers. You can see this in the below data."},{"metadata":{"trusted":true,"_uuid":"967735897226423b1f88bac5572ee10fb6da1a4b"},"cell_type":"code","source":"cmp_titanic[cmp_titanic$Ticket %in% c('19950','PC 17759'),-c(1,2,4,5) ]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"88daf3f79275ebb220eae6b1ea6e22076779a12a"},"cell_type":"markdown","source":"Here in the above data ther are two families from 1st class, where one family traveling father and daugther who chose to be in two cabins with a single sharing and other family of 6 members in three cabind of two sharing."},{"metadata":{"trusted":true,"_uuid":"84aec59ec03abaf0fe15e23cd57906713cb89544"},"cell_type":"code","source":"cmp_titanic[cmp_titanic$LastName %in% c('Hogeboom', 'Andrews'),]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5b20b867691d74b2a0e615c84cf2bf4d45522179"},"cell_type":"markdown","source":"Here from teh above data we can get that miss. Kornelia and Mrs. John are sibilings and they are travelling together in a single sharing cabins.\n\nMr. Thomas might be a relative but not directly a family memeber though he share the same family name and he has been allocated with a different cabin.\n\nSo the fare value define that it is a sum of amount for all the members in a ticket."},{"metadata":{"trusted":true,"_uuid":"63f73ad2e36319cf439efa1dd1253337ac87b92f"},"cell_type":"code","source":"cmp_titanic[!(cmp_titanic$Fare==''|cmp_titanic$Fare==0|is.na(cmp_titanic$Fare)==TRUE),] %>%\n  group_by(Pclass) %>%\n  summarise(mean(Fare))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0f53530ee99e4867989dd02b5328d40d0b9cc041"},"cell_type":"markdown","source":"We have 18 records with either 0 or NA, so lets impute it with mean value per each class."},{"metadata":{"trusted":true,"_uuid":"21e8780a15bf9b722303e821349b1e1a197d1786"},"cell_type":"code","source":"cmp_titanic$Fare = ifelse((cmp_titanic$Fare==''|cmp_titanic$Fare==0|is.na(cmp_titanic$Fare)==TRUE),\n       ifelse(cmp_titanic$Pclass==1,89.4,\n              ifelse(cmp_titanic$Pclass==2,21.6,13.4)),cmp_titanic$Fare)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"77ab4360b046578a9af48ac05f4912fb7b029f39"},"cell_type":"markdown","source":"Let us get the fare value for individual."},{"metadata":{"trusted":true,"_uuid":"70dd9423d534cb33644cf91406da49b913d0fb21"},"cell_type":"code","source":"cmp_titanic$Fare_Pasngr = cmp_titanic$Fare/cmp_titanic$OnBrd_2gtr","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"3e40b0830db9f0b790cf05a26b00f125624d56d6"},"cell_type":"markdown","source":"#Cabin"},{"metadata":{"trusted":true,"_uuid":"70bac6ff065039290be5f2e95912740c0ee7c0aa"},"cell_type":"code","source":"sum(is.na(cmp_titanic$Cabin)) + nrow(cmp_titanic[cmp_titanic$Cabin=='',])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f0ecd6c0d9e6502870d14078290f853446acbd0c"},"cell_type":"markdown","source":"Here we can see that 1014 passangers doesnt have a cabin number allocated, 77.46% of data is not present in terms of feature cabin.\nFor prediction model it is not so recomandable to imput a feature with 77.46% data not present and it is better to drop the feature.\n\n#Embarked"},{"metadata":{"trusted":true,"_uuid":"258d692b12931331168c9d8fb4a6008c3b14aa91"},"cell_type":"code","source":"sum(is.na(cmp_titanic$Embarked)) + nrow(cmp_titanic[cmp_titanic$Embarked=='',])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"91f298e99f6bbd6d5ae8db0f148af470e7eb08f2"},"cell_type":"markdown","source":"Here ther two missing values in the data, lets impute it with mode of the data."},{"metadata":{"trusted":true,"_uuid":"9978364337f0a31e2e371c6b06ee92dabcc3034f"},"cell_type":"code","source":"cmp_titanic %>%\n  group_by(Embarked) %>%\n  summarise(n())","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0416478bc341f82367944b335a80a82eeaf8690f"},"cell_type":"markdown","source":"As 'S' is the most repeated value lets impute it with 'S' in blank records"},{"metadata":{"trusted":true,"_uuid":"b12f52ce09243c1af5bfd87070780f43e77c6be9"},"cell_type":"code","source":"cmp_titanic$Embarked = as.character(cmp_titanic$Embarked)\ncmp_titanic$Embarked = ifelse(cmp_titanic$Embarked=='', 'S', cmp_titanic$Embarked)\ncmp_titanic$Embarked = as.factor(cmp_titanic$Embarked)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"68a84f18de0fa1aa29042f7b2c018f19ee528fa3"},"cell_type":"markdown","source":"Lets see the passanger onboard rate at each of these places"},{"metadata":{"trusted":true,"_uuid":"81943ef98d916256fb76e69a56ca88b37ab7ac1b"},"cell_type":"code","source":"g1 <- ggplot(cmp_titanic, aes(x= Embarked, fill = Embarked))+\n  geom_bar()\n\ng2 <- ggplot(cmp_titanic[!is.na(cmp_titanic$Survived),], aes(x=Embarked, fill = Survived))+\n  geom_bar()\n\ng3 <- ggplot(cmp_titanic, aes(x=Embarked, fill = Pclass))+\n  geom_bar(position = 'dodge')+\n  scale_fill_manual('legend', values = c('1' ='yellow', '2' = 'violet', '3' ='navy blue'))\n\ngrid.arrange(g1, g3, g2, nrow = 2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d17c7c7232466f65587f6fac19240a822ec0bd6c"},"cell_type":"markdown","source":"**Age Imputation to deal with NA values**\n\nHere are the details of NA's for each title in the age column."},{"metadata":{"trusted":true,"scrolled":true,"_uuid":"baddb8a1330481244d4ea089b4bdca85c7503457"},"cell_type":"code","source":"cmp_titanic[is.na(cmp_titanic$Age),]%>%\n  group_by(Title)%>%\n  summarise(n())","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7fd6f1103ef853b12b306a34ae468c30ca17ac56"},"cell_type":"markdown","source":"Here are the number of NA's present in the age for each title. We are going to impute these NA's using KNN imputation along each title."},{"metadata":{"trusted":true,"_uuid":"8e577d2f8f1ae6e766b79daf404e216c51c1987d"},"cell_type":"code","source":"fnScaling = function(x){\n  return((x-min(x))/(max(x)-min(x)))\n}","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"3f64489d4fc0e362c759a7c2a54cae2ad6a8a635"},"cell_type":"markdown","source":"**Master**"},{"metadata":{"trusted":true,"_uuid":"0fda5e3e8d35fac6f2b8fd986145d7deef698fdc"},"cell_type":"code","source":"master_dummies = dummy.data.frame(cmp_titanic[cmp_titanic$Title ==\n                                                \"Master\",c(3,5,7,8,10,15,17,18)])\nfor(i in 1:ncol(master_dummies)){\n  master_dummies[,i] = fnScaling(master_dummies[,i])\n}\nmaster_dummies=cbind(master_dummies,cmp_titanic[cmp_titanic$Title == \"Master\",c(6)])\ncolnames(master_dummies)[colnames(master_dummies) ==\n    'cmp_titanic[cmp_titanic$Title == \"Master\", c(6)]'] <- 'Age'","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5e2f36220bff8e8b537ec2c462356764fd582964"},"cell_type":"markdown","source":"#let us see the distribution of age for title Master with NA's and after imputation"},{"metadata":{"trusted":true,"_uuid":"9c8e26d51e043274576282c04dfcd001980b737a"},"cell_type":"code","source":"summary(cmp_titanic[cmp_titanic$Title=='Master','Age'])\nsummary(round(knnImputation(data = master_dummies, k= 3)[,'Age']))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"767e15709dd13d1a1470d9ce02ff4df4899705fd"},"cell_type":"code","source":"#Here in the distribution there is a slite deviation in the Median, Mean and\n#3rd quadrant due to inclusion of 8 NA records with imputed values.\ncmp_titanic[cmp_titanic$Title=='Master','Age'] = \n  round(knnImputation(data = master_dummies, k= 3)[,'Age'])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"08020399981e4e914d68c865b89d5b0c3cbefa9d"},"cell_type":"markdown","source":"**Mr**"},{"metadata":{"trusted":true,"_uuid":"bf8c66a3937653f9989c26b85992789e2a9a3639"},"cell_type":"code","source":"mr_dummies = dummy.data.frame(cmp_titanic[cmp_titanic$Title ==\n                                            \"Mr\",c(3,5,7,8,10,15,17,18)])\nfor(i in 1:ncol(mr_dummies)){\n  mr_dummies[,i] = fnScaling(mr_dummies[,i])\n}\nmr_dummies=cbind(mr_dummies,cmp_titanic[cmp_titanic$Title == \"Mr\",c(6)])\ncolnames(mr_dummies)[colnames(mr_dummies) ==\n                'cmp_titanic[cmp_titanic$Title == \"Mr\", c(6)]'] <- 'Age'\n\n#let us see the distribution of age for title Mr with NA's and after imputation\nsummary(cmp_titanic[cmp_titanic$Title=='Mr','Age'])\nsummary(round(knnImputation(data = mr_dummies, k= 3)[,'Age']))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"6a142bf2bf44b3423777a7a1a95fc6105a028fa6"},"cell_type":"code","source":"#Here in the distribution there is a slite deviation in the Mean,Median and 2rd quadrant \n#due to inclusion of 176 NA records with imputed values.\n\ncmp_titanic[cmp_titanic$Title=='Mr','Age'] = \n  round(knnImputation(data = mr_dummies, k= 3)[,'Age'])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"b71952562a6e368cd34988a83c3f42e690e46fc4"},"cell_type":"markdown","source":"**Miss**"},{"metadata":{"trusted":true,"_uuid":"a64217e7acfc951e9e38b44fda74b5890cb5a875"},"cell_type":"code","source":"miss_dummies = dummy.data.frame(cmp_titanic[cmp_titanic$Title ==\n                                              \"Miss\",c(3,5,7,8,10,15,17,18)])\nfor(i in 1:ncol(miss_dummies)){\n  miss_dummies[,i] = fnScaling(miss_dummies[,i])\n}\nmiss_dummies=cbind(miss_dummies,cmp_titanic[cmp_titanic$Title == \"Miss\",c(6)])\ncolnames(miss_dummies)[colnames(miss_dummies) ==\n                       'cmp_titanic[cmp_titanic$Title == \"Miss\", c(6)]'] <- 'Age'\ncmp_titanic[cmp_titanic$Title=='Miss','Age'] = \n  round(knnImputation(data = miss_dummies, k= 3)[,'Age'])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a12c327629cd860d742c6dccb51d7c8fe1ed144e"},"cell_type":"markdown","source":"**Mrs**"},{"metadata":{"trusted":true,"_uuid":"dcd3abaec7064be0e37c8cfc4e60d779046973f6"},"cell_type":"code","source":"mrs_dummies = dummy.data.frame(cmp_titanic[cmp_titanic$Title ==\n                                             \"Mrs\",c(3,5,7,8,10,15,17,18)])\nfor(i in 1:ncol(mrs_dummies)){\n  mrs_dummies[,i] = fnScaling(mrs_dummies[,i])\n}\nmrs_dummies=cbind(mrs_dummies,cmp_titanic[cmp_titanic$Title == \"Mrs\",c(6)])\ncolnames(mrs_dummies)[colnames(mrs_dummies) ==\n                         'cmp_titanic[cmp_titanic$Title == \"Mrs\", c(6)]'] <- 'Age'\ncmp_titanic[cmp_titanic$Title=='Mrs','Age'] = \n  round(knnImputation(data = mrs_dummies, k= 3)[,'Age'])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"332d0434a9ac8be1c8e2be703521c47515f56dbf"},"cell_type":"markdown","source":"**Rare**"},{"metadata":{"trusted":true,"_uuid":"961e825f8eeacf2509d73c314a764b4702436085"},"cell_type":"code","source":"rare_dummies = dummy.data.frame(cmp_titanic[cmp_titanic$Title ==\n                                             \"Rare\",c(3,5,7,8,10,15,17,18)])\nfor(i in 1:ncol(rare_dummies)){\n  rare_dummies[,i] = fnScaling(rare_dummies[,i])\n}\nrare_dummies=cbind(rare_dummies,cmp_titanic[cmp_titanic$Title == \"Rare\",c(6)])\ncolnames(rare_dummies)[colnames(rare_dummies) ==\n                        'cmp_titanic[cmp_titanic$Title == \"Rare\", c(6)]'] <- 'Age'\ncmp_titanic[cmp_titanic$Title=='Rare','Age'] = \n  round(knnImputation(data = rare_dummies, k= 3)[,'Age'])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7f1c02b1af0f27bfe8848b4bd9418a0e4054cb83"},"cell_type":"markdown","source":"**Split data as is like titanic training and test data**"},{"metadata":{"trusted":true,"_uuid":"23ae891130f583e27c8c3f061d5007de3dafb7bc"},"cell_type":"code","source":"titanic_train = cmp_titanic[!is.na(cmp_titanic$Survived),]\nnrow(titanic_train)\ntitanic_test = cmp_titanic[is.na(cmp_titanic$Survived),]\nnrow(titanic_test)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d5f2a40d8618d2da1288c3f503080b2b1f68760a"},"cell_type":"markdown","source":"#**Model Bulding**"},{"metadata":{"_uuid":"77551736c5d267927c49aacbe6758b348f9996e6"},"cell_type":"markdown","source":"**Using Random Forest**"},{"metadata":{"_kg_hide-output":true,"trusted":true,"scrolled":true,"_uuid":"2bfcaf3648e0045b7e527c0e3f947131501ee432"},"cell_type":"code","source":"ids = sample(nrow(titanic_train), nrow(titanic_train)* 0.8)\ntrain_rf = titanic_train[ids,]\ntest_rf = titanic_train[-ids,]\n\ntrain_rf <- train_rf %>%  mutate_if(is.character,as.factor)\ntest_rf <- test_rf %>%  mutate_if(is.character,as.factor)\n#str(train_rf)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"scrolled":true,"_uuid":"2ea9bf20911c525e4d3fd24a2736d44ba5b8d477"},"cell_type":"code","source":"rfmod = randomForest(Survived~.-PassengerId-Name-Ticket-Cabin-LastName-Fml_Tkt,\n                     data = train_rf,\n                     ntree=3500,\n                     mtry=3,\n                     nodesize=10,maxnodes=15,\n                     classwt=c(1,1.5),\n                     strata = train_rf$Survived)\nrfmod","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"236db83154a5a9892c3bddd66bbe5dfe73a800d6"},"cell_type":"markdown","source":"Let us see the AUC(Area under curve) for training data"},{"metadata":{"trusted":true,"_uuid":"5234d48b0590583de00ca748c99a693b6e26513b"},"cell_type":"code","source":"pred = prediction(as.vector(rfmod$votes[,2]) , train_rf$Survived)\nperf= performance(pred, \"tpr\",\"fpr\")\nplot(perf, colorize=T,text.adj=c(1.2,1.2), avg=\"threshold\", lwd=3,main= \"ROC\")\nAUC = performance(pred, measure = 'auc')@y.values[[1]]\nprint(AUC)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"486ddf2b41dd928e8aed6ba17c359febd5dc8def"},"cell_type":"markdown","source":"Let us see the AUC(Area under curve) for test data"},{"metadata":{"trusted":true,"_uuid":"a5d499de5948d18d766268842898b63d42b9110a"},"cell_type":"code","source":"pred = prediction(as.vector(predict(rfmod,test_rf,type='vote')[,2]),test_rf$Survived)\nperf= performance(pred, \"tpr\",\"fpr\")\nplot(perf, colorize=T, text.adj=c(1.2,1.2), avg=\"threshold\", lwd=3, main= \"ROC\")\nAUC = performance(pred, measure = 'auc')@y.values[[1]]\nprint(AUC)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"86c6db012428cfd750ee73747c1f28f785cd4343"},"cell_type":"markdown","source":"#Let use this tuned model for predicting the titanic test data"},{"metadata":{"trusted":true,"_uuid":"07ac94c6f3761d5d786ae4ddaaa843613718e404"},"cell_type":"code","source":"titanic_test <- titanic_test %>%  mutate_if(is.character,as.factor)\ntitanic_test$Survived = predict(rfmod,titanic_test,type = 'response')\nwrite.csv(titanic_test[,c('PassengerId','Survived')],'Titanic_sub.csv',row.names=FALSE)","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}