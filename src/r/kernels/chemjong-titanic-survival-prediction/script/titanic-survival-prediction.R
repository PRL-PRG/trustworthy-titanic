library(randomForest)
library(dplyr)
library(ggplot2)
library(VIM)
library(stringr)
library("ggthemes")
library("randomForest")
library("ROCR")
library("mice")
library("scales")
train <- read.csv("../input/train.csv", stringsAsFactors = F)
test <- read.csv("../input/test.csv", stringsAsFactors = F)
glimpse(train)
glimpse(test)
data1 <- bind_rows(train, test)
visual_na <- aggr(data1, numbers = TRUE, labels = names(data1), cex.axis = 0.5, cex.numbers = 0.5, sortVars = T)
data1$Cabin[data1$Cabin == ""] <- NA
sum(is.na(data1$Cabin))
str(data1)
data1$Title <- gsub("(.*,)|(\\..*)", "", data1$Name)
data1$Title <- str_trim(data1$Title)
distinct(data1, Title)
data1$Title <- gsub("Ms", "Miss", data1$Title, ignore.case = T)
data1$Title <- gsub("Mlle", "Miss", data1$Title, ignore.case = T)
no_title <- c("Master", "Don", "Rev", "Dr", "Mme", "Major", "Lady", "Sir", "Col", "Capt", "the Countess", "Jonkheer", "Dona")
data1$Title[data1$Title %in% no_title] <- "No Title"
distinct(data1, Title)
data1$Surname <- sapply(data1$Name, function(x) strsplit(x, "[,.]")[[1]][1])
filter(data1, is.na(Fare))
str(data1)
data1$Cabin_class <- sapply(data1$Cabin, function(x) substr(x, 1, 1)[[1]][1])
distinct(data1, Embarked)
ggplot(filter(data1, Pclass == 3 & Embarked == "S"), aes(Fare)) + geom_density(fill = "green", alpha = 0.5) + scale_x_continuous(labels = dollar_format(), breaks = c(0, 10, 20, 30, 40, 50, 60, 70)) + geom_vline(aes(xintercept = median(Fare, na.rm = TRUE)), color = "red", linetype = "dashed")
data1[is.na(data1$Fare), ]
data1[is.na(data1$Fare), ]$Fare <- median(data1[data1$Pclass == 3 & data1$Embarked == "S", ]$Fare, na.rm = TRUE)
data1[1044, ]
sum(is.na(data1$Embarked))
glimpse(data1)
summary(as.factor(data1$Embarked))
data1[data1 == ""] <- NA
filter(data1, is.na(Embarked))
ggplot(data1, aes(Embarked, Fare)) + geom_boxplot() + geom_hline(aes(yintercept = 80), col = "red", linetype = "dashed", lwd = 0.5) + facet_grid(~Pclass) + theme_bw()
median(data1[data1$Embarked == "C" & data1$Pclass == 1, ]$Fare, na.rm = T)
data1[data1$PassengerId == 62 | data1$PassengerId == 830, ]$Embarked <- "C"
data1[data1$PassengerId == 62 | data1$PassengerId == 830, ]
data1$Family_size <- data1$SibSp + data1$Parch + 1
str(data1)
data1$Sex <- as.factor(data1$Sex)
data1$Ticket <- as.factor(data1$Ticket)
data1$Title <- as.factor(data1$Title)
data1$Embarked <- as.factor(data1$Embarked)
data1$Survived <- as.factor(data1$Survived)
data1$Pclass <- as.factor(data1$Pclass)
data1$Family_size <- as.factor(data1$Family_size)
sum(is.na(data1$Age))
hist(data1$Age, na.rm = T, freq = F)
summary(data1$Age)
data1 %>% filter(Age < 0)
summary(data1)
data1 %>% filter(Fare < 5)
data1[data1$Fare < 5, ]
distinct(data1, Ticket)
ggplot(data1[1:418, ], aes(Embarked, Fare)) + geom_boxplot()
train %>% group_by(Embarked, Pclass) %>% summarise(median(Fare))
visual_na2 <- aggr(data1[892:1309, ], numbers = TRUE, labels = names(data1), cex.axis = 0.5, cex.numbers = 0.5, sortVars = T)
age_pred <- lm(Age ~ Fare + Sex + Pclass, data = data1[!is.na(data1$Age), ])
age_pred
summary(age_pred)
data1$Age[is.na(data1$Age)] <- predict(age_pred, data1)[is.na(data1$Age)]
data1$Age <- round(data1$Age)
train_data <- data1[1:891, ]
test_data <- data1[892:1309, ]
set.seed(7)
str(train_data)
model <- randomForest(factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + Title + Family_size, data = train_data)
model$importance
plot(model)
importance <- importance(model)
VarImportance <- data.frame(Variables = row.names(importance), Importance = round(importance[, "MeanDecreaseGini"], 2))
rank_importance <- VarImportance %>% mutate(Rank = paste0("#", dense_rank(desc(Importance))))
rank_importance
ggplot(rank_importance, aes(x = reorder(Variables, Importance), y = Importance, fill = Importance)) + geom_bar(stat = "identity") + coord_flip() + geom_text(aes(x = Variables, label = Rank, y = 5)) + labs(x = "Variables")
prediction <- predict(model, test_data)
summary(prediction)
solution <- data.frame(PassengerID = test_data$PassengerId, Survived = prediction)
write.csv(solution, file = "test_solution2.csv", row.names = F)
