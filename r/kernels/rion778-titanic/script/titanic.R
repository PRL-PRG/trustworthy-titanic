## ---- message=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(mlr)
library(readr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(gridExtra)
library(formattable)


## ---- message=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
input_path <- "../data/download/"
output_path <- "../submissions/"
kaggle <- FALSE
if(!dir.exists(input_path)) {
    kaggle  <- TRUE
    input_path  <- "../input/"
    output_path <- ""
}
train <- read_csv(paste0(input_path, "train.csv"))
test  <- read_csv(paste0(input_path, "test.csv"))


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train$Set <- factor("Train")
test$Set <- factor("Test")
test$Survived <- NA
df <- rbind(train, test)
df %<>% as.data.frame


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
head(df)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
f <- . %>%
  mutate_if(is.character, factor) %>%
  mutate_at("Survived", as.logical) %>% 
  mutate_at("Pclass", factor)
train %<>% f
test %<>% f
df %<>% f


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
df %>%
  select(-Survived) %>%
  summarise_all(function(x){sum(is.na(x))})


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
p <- train %>%
  ggplot(aes(x = Survived, fill = Pclass))
grid.arrange(
  p + geom_bar(), 
  p + geom_bar(position = "fill") + ylab("rate")
  )


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train %>%
  group_by(Pclass) %>%
  summarise(SurviveRate = mean(Survived)) %>%
  formattable(list(
    SurviveRate = proportion_bar()
  ))


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train %>%
  ggplot(aes(x = Survived, fill = Sex)) +
  geom_bar()


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train %>%
  group_by(Sex) %>%
  summarise(SurviveRate = mean(Survived)) %>%
  formattable(list(
    SurviveRate = proportion_bar()
  ))


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train %>%
  ggplot(aes(x = Age, fill = Survived)) +
  geom_density(alpha = 0.5)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train %>%
  mutate(c_age = cut_width(Age, width = 10, center = 5)) %>%
  group_by(c_age) %>%
  summarise(SurvivedRate = mean(Survived)) %>%
  ggplot(aes(x = c_age, y = SurvivedRate)) + geom_bar(stat = "identity")


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
table(train$SibSp)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train %>%
  ggplot(aes(x = SibSp, fill = Survived)) + 
  geom_bar()


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train %>%
  ggplot(aes(x = SibSp, fill = Survived)) +
  geom_bar(position = "fill")

