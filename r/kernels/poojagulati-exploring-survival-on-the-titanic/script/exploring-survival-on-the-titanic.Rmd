---
---
title: "titanic"
author: "Pooja"
date: "August 29, 2016"
output: html_document
---
##Read and visualize the data
```{r}
train<- read.csv("train.csv")
test<- read.csv("test.csv")
summary(train)
summary(test)
```
Summary of train and test set shows the missing values in age,embarked,cabin and fare column.As we can see,taht data is not big enough to let us ignore the missing value. so its imperative to impute missing values. So first of all we will combine the train and test data and then go ahead for cleaning and imputing the missing data.

###1.Before binding train and test data ,we need to add one colummn named "Survived" in test data similar to train data
```{r}
test$Survived<- NA
bind<- rbind(train,test)
```
###2.Cleaning and imputing of missing data
####a.Passenger 62 and 830 has missing values for embarking station. both passengers travelled in P1 class and bought ticket for 80. So we have to find out of "C","Q" and "S", which port has median value near to 80 for P1 class.
```{r}
library(ggplot2)
ggplot(bind,aes(x=Embarked,y=Fare,fill=factor(Pclass)))+geom_boxplot()+geom_hline(yintercept = 80)
```

This graph indicates thet two passengers seem to board from "Cherbourg" port.

Aassign the missing embarked value to "C" for passengers 62 and 830.

```{r}
bind$Embarked[c(62,830)]<- "C"
```

###2.  Fare value is missing for PassengerId 1044. He had borded from "Southampton" port and travelled in Pclass-3.
So first we subset the passengers travelled in Pclass 3 and then find mean value for each port and imput the missing value with mean value for boarded from "S" port.
```{r}
bind1<- bind[bind$Pclass==3,]
aggregate(Fare~Embarked,bind1,mean)
bind$Fare[which(is.na(bind$Fare))]<- 14.43
```


###3. Cabin column has many missing values and cabin alotment to passenger seems to be unrelated to other variables.Many passengers chose or excahnge cabin as per their convenience. So it seems difficult to impute so many values without proper correlation or prediction. Similarly, ticket column also do not seem to contribute in predicting Survived Individuals.So,will remove the cabin and ticket column from data.

###4.Missing age values can be predicted through rpart method. 
1.We assume that title in name column can strongly contribute in predicting missing values in age column. So fist we extract the title from name column. 

```{r}
bind$title<- gsub('(.*, )|(\\..*)', '', bind$Name)
```


2.Observe the distribution of title acoording to gender and reassign values to titles to avoid confusion and make it simple.
```{r}
table(bind$Sex,bind$title)
bind$title[bind$title=="Capt"]<- "Mr"
bind$title[bind$title=="Col"]<- "Mr"
bind$title[bind$title=="Don"]<- "Mr"
bind$title[bind$title=="Dona"]<- "Mrs"
bind$title[bind$title=="Jonkheer"]<- "Mr"
bind$title[bind$title=="Lady"]<- "Mrs"
bind$title[bind$title=="Major"]<- "Mr"
bind$title[bind$title=="Mlle"]<- "Mrs"
bind$title[bind$title=="Mme"]<- "Mrs"
bind$title[bind$title=="Ms"]<- "Mrs"
bind$title[bind$title=="Rev"]<- "Mr"
bind$title[bind$title=="Sir"]<- "Mr"
bind$title[bind$title=="the Countess"]<- "Mrs"
```

3. Check the distribution of age before and after imputing values to make sure that nothing has gone wrong.

```{r}
hist(bind$Age)
```

4. Subset the data with complete rows for each column and remove columns named 'cabin' (with many missing values) and 'ticket'. Then predict the age by rpart method.
```{r}
bind2<- bind[!is.na(bind$Age),-c(9,11)]
library(rpart)
library(rpart.plot)
library(rattle)
predictage<- rpart(Age~Pclass+Sex+SibSp+Parch+Embarked+title+Fare,data=bind2,method="anova")
fancyRpartPlot(predictage)
bind$Age[is.na(bind$Age)]<- predict(predictage,data= bind[is.na(bind$Age)])
hist(bind$Age,  main = "age distribution after imputing missing values")
```

Histograms show that predicted  values still folows the same distribution. rpart tree indiactes that title,Pclass,Parch and fare are major deciding factor in predicting age.

### As data is complete, so we Will go ahead to predict survived passengers in test column.  For random forest method we need each variable to be in factor class, so change the title variable to factor.Then separate the train and test set

```{r}
library(randomForest)
bind$title<- as.factor(bind$title)
trainnew<- bind[1:891,-c(9,11)]
testnew<- bind[892:1309,-c(9,11)]
rf_model <- randomForest(factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + title ,data = trainnew)
```


Check  the variable importance through mean decrease in Gini calculated across all nodes.

```{r}
varImpPlot(rf_model)
```

Title, Sex and Fare loks like to be strongest predictor variables.

Prediction of survived Individuals in Test set'

```{r}
testpredict<- predict(rf_model,testnew)
titanic<- data.frame(PassengerId=test$PassengerId, survived= testpredict)
write.csv(titanic,"titanic.csv",row.names=FALSE)
```

 



