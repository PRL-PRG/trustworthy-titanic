
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin15.6.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ## ----warning=F,eval=F------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> ## # Pacotes Utilizados:
> ## library(dplyr)       # Manipulacao de dados
> ## library(readr)       # Leitura da base csv
> ## library(ggplot2)     # Visualizacao elegante dos dados
> ## library(GGally)      # Suporte na visualizacao dos dados
> ## library(vcd)         # Calcular as medidas de associaÃ§Ã£o da tabela
> ## library(tabplot)     # Visualizacao geral dos dados
> ## library(data.table)  # Objeto datatable semelhante ao dataframe
> ## library(gtools)      # FunÃ§Ãµes para auxiliar na programaÃ§Ã£o R
> ## library(plotly)      # visualizacao interativa
> ## library(rpart)       # Ajustar arvore de decisoes
> ## library(rpart.plot)  # Visualizar arvore de decisoes
> ## # library(rattle)      # Visualizar arvore de decisoes
> ## library(caret)       # Biblioteca para machine learning
> ## library(formattable) # Criar tabelas elegantes
> ## library(FFTrees)     # Ajuste rÃ¡pido e descritivo de arvore de decisoes
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> suppressMessages(library(dplyr))
Warning message:
package â€˜dplyrâ€™ was built under R version 3.6.2 
> suppressMessages(library(readr))
> suppressMessages(library(ggplot2))
Warning message:
package â€˜ggplot2â€™ was built under R version 3.6.2 
> suppressMessages(library(GGally))
Warning message:
package â€˜GGallyâ€™ was built under R version 3.6.2 
> 
> 
> system("ls ../input", intern=TRUE)
[1] "gender_submission.csv" "test.csv"              "train.csv"            
> 
> train=read.csv("../input/train.csv",header=T)
> test=read.csv("../input/test.csv",header=T)
> full=bind_rows(train, test)
> 
> #Salvando a coluna para enviar os resultados depois
> PassengerId=test$PassengerId
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> glimpse(full)
Rows: 1,309
Columns: 12
$ PassengerId [3m[90m<int>[39m[23m 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17â€¦
$ Survived    [3m[90m<int>[39m[23m 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, â€¦
$ Pclass      [3m[90m<int>[39m[23m 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3, 2, 3, â€¦
$ Name        [3m[90m<fct>[39m[23m "Braund, Mr. Owen Harris", "Cumings, Mrs. John Bradley (Fâ€¦
$ Sex         [3m[90m<fct>[39m[23m male, female, female, female, male, male, male, male, femâ€¦
$ Age         [3m[90m<dbl>[39m[23m 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, 39, 14,â€¦
$ SibSp       [3m[90m<int>[39m[23m 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4, 0, 1, â€¦
$ Parch       [3m[90m<int>[39m[23m 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1, 0, 0, â€¦
$ Ticket      [3m[90m<fct>[39m[23m A/5 21171, PC 17599, STON/O2. 3101282, 113803, 373450, 33â€¦
$ Fare        [3m[90m<dbl>[39m[23m 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, 51.8625â€¦
$ Cabin       [3m[90m<fct>[39m[23m , C85, , C123, , , E46, , , , G6, C103, , , , , , , , , ,â€¦
$ Embarked    [3m[90m<fct>[39m[23m S, C, S, S, S, Q, S, S, S, C, S, S, S, S, S, S, Q, S, S, â€¦
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> g1=ggplot(full, aes(x = as.factor(Survived),fill=as.factor(Survived))) + 
+   geom_bar()+scale_y_continuous(limits = c(0,600), breaks = seq(0,600,100))+theme_bw()+
+   labs(x="Sobrevivente",title="Base Completa")
> 
> g2=ggplot(train, aes(x = as.factor(Survived),fill=as.factor(Survived))) + 
+   geom_bar()+scale_y_continuous(limits = c(0,600), breaks = seq(0,600,100))+theme_bw()+
+   labs(x="Sobrevivente",title="Base de Treino")
> 
> gridExtra::grid.arrange(g1,g2,ncol=2)
> 
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> prop.test(sum(full$Survived,na.rm = T),    # Proporcao de sobreviventes ignorando as linhas de NA
+           length(na.omit(full$Survived)))  # Numero total de pessoas ignorando as linhas NA

	1-sample proportions test with continuity correction

data:  sum(full$Survived, na.rm = T) out of length(na.omit(full$Survived)), null probability 0.5
X-squared = 47.627, df = 1, p-value = 5.154e-12
alternative hypothesis: true p is not equal to 0.5
95 percent confidence interval:
 0.3519194 0.4167722
sample estimates:
        p 
0.3838384 

> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> summary(train$Pclass)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.000   2.000   3.000   2.309   3.000   3.000 
> ggplot(train, aes(x = as.factor(Pclass),fill=as.factor(Survived))) + 
+   geom_bar(position = "dodge")+scale_y_continuous(limits = c(0,600), breaks = seq(0,600,100))+theme_bw()+
+   labs(x="Sobrevivente",title="Base de Treino")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full$Title = gsub('(.*, )|(\\..*)', '', full$Name) #Obtendo apenas o titulo da pessoa
> 
> #Conferindo frequÃªncias:
> sort(table(full$Title))

        Capt          Don         Dona     Jonkheer         Lady          Mme 
           1            1            1            1            1            1 
         Sir the Countess        Major         Mlle           Ms          Col 
           1            1            2            2            2            4 
          Dr          Rev       Master          Mrs         Miss           Mr 
           8            8           61          197          260          757 
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # Titles with very low cell counts to be combined to "rare" level
> rare_title <- c('Dona', 'Lady', 'the Countess','Capt', 'Col', 'Don', 
+                 'Dr', 'Major', 'Rev', 'Sir', 'Jonkheer')
> 
> # Also reassign mlle, ms, and mme accordingly
> full$Title[full$Title == 'Mlle']        <- 'Miss' 
> full$Title[full$Title == 'Ms']          <- 'Miss'
> full$Title[full$Title == 'Mme']         <- 'Mrs' 
> full$Title[full$Title %in% rare_title]  <- 'Rare Title'
> 
> train <- full[1:891,]
> test <- full[892:1309,]
> 
> ggplot(train, aes(x = as.factor(Title),fill=as.factor(Survived))) + 
+   geom_bar(position = "dodge")+scale_y_continuous(limits = c(0,600), breaks = seq(0,600,100))+theme_bw()+
+   labs(x="Sobrevivente",title="Base de Treino")
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> table(train$Sex)

female   male 
   314    577 
> ggplot(train, aes(x = as.factor(Sex),fill=as.factor(Survived))) + 
+   geom_bar(position = "dodge")+scale_y_continuous(limits = c(0,600), breaks = seq(0,600,100))+theme_bw()+
+   labs(x="Sobrevivente",title="Base de Treino")
> 
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> g1=ggplot(train, aes(x=Age, color=factor(Survived), fill=factor(Survived))) + 
+  geom_histogram(aes(y=..density..), alpha=0.5, 
+                 position="identity")+
+  geom_density(alpha=.2) +theme_bw()
> 
> g2=ggplot(train,aes(x=Age, y=Survived))+
+   geom_point()+
+   geom_smooth()+theme_bw()
> 
> gridExtra::grid.arrange(g1,g2,ncol=2)
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`geom_smooth()` using method = 'loess' and formula 'y ~ x'
Warning messages:
1: Removed 177 rows containing non-finite values (stat_bin). 
2: Removed 177 rows containing non-finite values (stat_density). 
3: Removed 177 rows containing non-finite values (stat_smooth). 
4: Removed 177 rows containing missing values (geom_point). 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full$SepAge=ifelse(full$Age<18,"child",ifelse(full$Age<60,"adult", "old"))
> full$SepAge=as.factor(full$SepAge)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # Create a family size variable including the passenger themselves
> full$Fsize <- full$SibSp + full$Parch + 1
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> suppressMessages(library(vcd))
Warning message:
package â€˜vcdâ€™ was built under R version 3.6.2 
> 
> #Comando para tabela cruzada:
> tab <- xtabs(~ Ticket + Pclass, data = train)
> #Calcular as medidas de associaÃ§Ã£o da tabela:
> summary(assocstats(tab))

Call: xtabs(formula = ~Ticket + Pclass, data = train)
Number of cases in table: 891 
Number of factors: 2 
Test for independence of all factors:
	Chisq = NaN, df = 1856, p-value = NA
	Chi-squared approximation may be incorrect
                    X^2   df P(> X^2)
Likelihood Ratio 1777.8 1856  0.90156
Pearson             NaN 1856      NaN

Phi-Coefficient   : NA 
Contingency Coeff.: NaN 
Cramer's V        : NaN 

> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> g1=qplot(y=train$Fare)+geom_boxplot(outlier.colour = "red", outlier.shape = 1)+theme_bw()+labs(title="Distribuicao com alta Tarifa")
> 
> g2=ggplot(train, aes(x=Fare, color=factor(Survived), fill=factor(Survived))) + 
+  geom_histogram(aes(y=..density..), alpha=0.5, 
+                 position="identity")+
+  geom_density(alpha=.2) +theme_bw()+labs(title="Com alta Tarifa")
> 
> #Removendo que tem Fare maior que 50
> 
> g3=qplot(y=train$Fare[train$Fare<50])+geom_boxplot(outlier.colour = "red", outlier.shape = 1)+theme_bw()+labs(title="Distribuicao sem alta Tarifa")
> 
> g4=ggplot(train[train$Fare<50,], aes(x=Fare, color=factor(Survived), fill=factor(Survived))) + 
+  geom_histogram(aes(y=..density..), alpha=0.5, 
+                 position="identity")+
+  geom_density(alpha=.2) +theme_bw()+labs(title="Sem alta Tarifa")
> 
> #Indentificando outliers:
> gridExtra::grid.arrange(g1,g2,g3,g4,ncol=2)
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
Warning messages:
1: Continuous x aesthetic -- did you forget aes(group=...)? 
2: Continuous x aesthetic -- did you forget aes(group=...)? 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full$SupFare=ifelse(full$Fare>50,1,0)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full$Survived=as.factor(full$Survived)
> full$Pclass=as.factor(full$Pclass)
> full$Sex=as.factor(full$Sex)
> full$Embarked=as.factor(full$Embarked)
> full$Title=as.factor(full$Title)
> full$SupFare=as.factor(full$SupFare)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> full=full%>%
+   select(Survived, Pclass, Sex, SepAge, Embarked, Fsize, SupFare,Title)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train <- full[1:891,]
> test <- full[892:1309,]
> 
> 
> ## ----warning=F-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> suppressMessages(library(tabplot))
Error in library(tabplot) : there is no package called â€˜tabplotâ€™
Calls: suppressMessages -> withCallingHandlers -> library
Execution halted
