## ----setup, message = FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(tidyverse)
library(xray)
library(knitr)


## ----import, message = FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
training <- read_csv("../input/train.csv", progress = FALSE)
testing <- read_csv("../input/test.csv", progress = FALSE)


## ----glipse----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
glimpse(training)


## ----factoring-training----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
training <- training %>% 
  mutate(Survived = factor(Survived, 
                           levels = c(1, 0), 
                           labels = c("Yes", "No"))) %>% 
  mutate(Pclass = factor(Pclass, 
                         levels = c(3, 2, 1), 
                         labels = c("3rd", "2nd", "1st"), 
                         ordered = TRUE)) %>% 
  mutate(Sex = factor(Sex, 
                      levels = c("male", "female"))) %>% 
  mutate(Embarked = factor(Embarked, 
                           levels = c("C", "Q", "S"), 
                           labels = c("Cherbourg", "Queenstown", "Southampton")))


## ----factoring_testing-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
testing <- testing %>% 
  mutate(Pclass = factor(Pclass, 
                         levels = c(3, 2, 1), 
                         labels = c("3rd", "2nd", "1st"), 
                         ordered = TRUE)) %>% 
  mutate(Sex = factor(Sex, 
                      levels = c("male", "female"))) %>% 
  mutate(Embarked = factor(Embarked, 
                           levels = c("C", "Q", "S"), 
                           labels = c("Cherbourg", "Queenstown", "Southampton")))


## ----xray_anomalies, results = 'asis'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
xray::anomalies(training)$variables %>% 
  knitr::kable()


## ----xray_distributions, warning = FALSE, fig.width = 9--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
training %>% 
  select(-PassengerId, -Name, -Age, -Cabin, -Ticket) %>% 
  mutate(Pclass = factor(Pclass, ordered = FALSE)) %>% 
  xray::distributions()


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
training %>% 
  filter(Fare <= 200) %>% 
  ggplot(aes(x = Fare)) + 
  geom_histogram(bins = 20, color = "white") +
  theme_bw() +
  labs(x = "Fare", 
       y = "Observations")


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
training %>% 
  filter(!is.na(Age)) %>% 
  ggplot(aes(x = Age)) +
  geom_histogram(bins = 30, color = "white") + 
  theme_bw() +
  labs(x = "Age (years old)", 
       y = "Observations")


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
training %>% 
  filter(is.na(Age)) %>% 
  mutate(Pclass = factor(Pclass, ordered = FALSE)) %>% 
  select(-Age, -PassengerId, -Ticket, -Name, -Cabin) %>% 
  xray::distributions()


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
training %>% 
  group_by(Ticket) %>% 
  count() %>% 
  ungroup() %>% 
  select(-Ticket) %>% 
  table()

