{"cells":[{"metadata":{"_uuid":"ee7f3bb8425f1af4044f7709744a616f61b2375d","trusted":true,"_cell_guid":"15bee6ac-b86d-4485-b9b4-4cfc116c6aef"},"cell_type":"code","source":"# TITANIC PREDICTION - RULE LEARNER\n\n#We are going to use the Rule Learner to make our prediction\n\n#Loading libraries\nlibrary(ggplot2) # Data visualization\nlibrary(readr) # CSV file I/O, e.g. the read_csv function\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(mice)\nlibrary(tibble)\nlibrary(RWeka)\n\n#Loading data\ntrain=read.csv(\"../input/train.csv\", header=TRUE)\ntrain=na.omit(train) # Deleting NA values from Train\ntest=read.csv(\"../input/test.csv\",header = TRUE)\ntest$Survived <- NA # Adding the column Survived to test data frame\ntitanic=rbind(train,test)\n","execution_count":7,"outputs":[]},{"metadata":{"_uuid":"f7011040e546220869d48fe4a18dfa80f2d6b696","trusted":false,"_cell_guid":"55773ef8-1723-4f79-b445-034418759337"},"cell_type":"code","source":"#Review data\n\n#The best way to understand data is plotting some graphs, so let's do it:\n\nhead(train)\nggplot(train)+geom_bar(aes(Survived))+facet_wrap(~Sex)\nggplot(train)+geom_bar(aes(Survived))+facet_wrap(~Pclass)\nggplot(train)+geom_bar(aes(Survived))+facet_wrap(~Embarked)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5112723186b40d2e863a8558010d253196d98f45","trusted":false,"_cell_guid":"975194f4-8c4a-4c84-b606-f13dcecc3e3e"},"cell_type":"code","source":"#So we are analyzing the data as it is, without edditing it (remember that we are checking only train dataset as we know if they survived or not)\n#As you may see in first graph, sex is an important factor. Majority of females survived. On the other hand, majority of males perished. \n#Reason is clear, so obviously, we will consider this variable when we perform our forecast.\n#On second graph we plot Survived vs No survived in function of class. There is also a tendency, majority of passangers of third class perished.\n#Probably it was more difficult to escape from bottom floors, so we'll included it.\n#Third graph, port where passanger embarked, we see it may exist a tendency, despite the fact that right now we don't see a logic. We will consider it and\n#in case it is usefull or useless, model will tell us.\n\n#Right now, it is not comfortable to display the rest of variables (missing/complex data), process work is needed, so let's start with the hard work.\n","execution_count":null,"outputs":[]},{"metadata":{"_kg_hide-output":false,"_kg_hide-input":false,"_uuid":"c8a5df6e9cbd01da243822f2b643b0b92114ab42","_cell_guid":"04577cc0-e211-4cd4-ae1c-befb18d9cac0","_execution_state":"idle","trusted":true},"cell_type":"code","source":"#Once we got the data, it is time to prepare it for extract the maximum profit from it. It is necessary to process it to allow any AI to get \n# some decent result. \n\n#Editing data\n\n#We turn Survived into a factor to be able to use later the Rule Learner\ntitanic$Survived=as.factor(titanic$Survived) \n\n#We calculated the number of family members from Parch and SibSp variables\n#If you did not check it on data explanation, Parch is the number of parents / children and SibSp the number of Siblings and spouses \n\ntitanic$Family=titanic$SibSp+titanic$Parch+1 \n\n# Cabin variable gives us very specific information of passengers location, maybe, to much specific. Unfortunately is not completed for all passengers,\n# what makes everything more complicated. \n# To get a more general information, we are going to isolate only the Deck letter (and cross fingers for get significant data)\n\ntitanic$Deck=as.factor(substring(titanic$Cabin,1,1)) \n\n#Analyzing the Name field, we can appreciate all passengers have a title. This can be usefull to classify passengers.\n#We get a new column with the title\n\ntitanic$title=gsub(\"^.*, (.*?)\\\\..*$\", \"\\\\1\",titanic$Name)\n\n#There are many titles quite similar between them, so we're gonna to simplify them:\n\ntitanic$title[titanic$title == 'Mlle']='Miss'\ntitanic$title[titanic$title == 'Ms']          <- 'Miss'\ntitanic$title[titanic$title == 'Mme']         <- 'Mrs' \ntitanic$title[titanic$title == 'Lady']          <- 'Miss'\ntitanic$title[titanic$title == 'Dona']          <- 'Miss'\ntitanic$title[titanic$title == 'Capt']        <- 'Officer' \ntitanic$title[titanic$title =='Col']        <- 'Officer' \ntitanic$title[titanic$title == 'Major']   <- 'Officer'\ntitanic$title[titanic$title =='Dr']   <- 'Officer'\ntitanic$title[titanic$title == 'Rev']   <- 'Officer'\ntitanic$title[titanic$title == 'Don']   <- 'Officer'\ntitanic$title[titanic$title == 'Sir']   <- 'Officer'\ntitanic$title[titanic$title == 'the Countess']   <- 'Officer'\ntitanic$title[titanic$title == 'Jonkheer']   <- 'Officer'\n\ntitanic$title=as.factor(titanic$title)\n\n#Predicting missing ages\n#Unfortunately data misses age values. In this case, we cannot just delete rows, as it is mandatory to predict if they survived or not.\n#So here we are going to predict the age taking into consideration relevant values:\n\nset.seed(129)\nmice_mod <- mice(titanic[, !names(titanic) %in% c('PassengerId','Name','Ticket','Cabin','Family','Surname','Survived')], method='rf') \nmice_output <- complete(mice_mod)\ntitanic$Age <- mice_output$Age\n\n#Traveling alone\n#We also will include a variable of repeated Tickets (people who bought tickets together)\n\ntitanic <- ddply(titanic,.(Ticket),transform,Ticketsize=length(Ticket))\ntitanic$Ticketsize <- as.factor(titanic$Ticketsize)\ntitanic <- titanic[order(titanic$PassengerId),]\n\n#Finally, we consider to add a new variable, Adult. We certainly know from movie the phrase \"Women and Children first\"\n#Our aim is to generate Adult variable to report us whether a passanger is adult or not,\n# in fact, specific age is not relevant for us here.\n\ntitanic$Adult[titanic$Age<18]=0\ntitanic$Adult[titanic$Age>17]=1\n\n\n#Dividing the data\n#Finally we split into train and test again, taking into consideration that we reduced the number of train values\ntitanic_train=titanic[1:714,]\ntitanic_test=titanic[715:1132,]\n","execution_count":20,"outputs":[]},{"metadata":{"_uuid":"e226e189912e1ac27735a0d8551411e5fc8a5d3c","trusted":false,"_cell_guid":"e2670d7d-4f4e-489a-9db2-8ba97d9ce80e"},"cell_type":"code","source":"head(titanic_train)\nggplot(titanic_train)+geom_bar(aes(Survived))+facet_wrap(~Adult)\nggplot(titanic_train)+geom_bar(aes(Survived))+facet_wrap(~Family)\nggplot(titanic_train)+geom_bar(aes(Survived))+facet_wrap(~Deck)\nggplot(titanic_train)+geom_bar(aes(Survived))+facet_wrap(~title)\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"aa14f4ddc5f506832ef5387f601267f1ed9aa358","trusted":false,"_cell_guid":"83426517-b150-42b6-9f99-a9bffb22cba9"},"cell_type":"code","source":"#Let's analyze the rest of data\n#Adult variable (younger or older than 18) has tendency\n#Family members has an impact on dataset\n#Deck variable seems it doesn't affect. We will consider it anyway.\n#Title is a representative variable (it is related with Sex in a direct way).\n\n#It is time to analyze all data and get our forecast\n","execution_count":null,"outputs":[]},{"metadata":{"scrolled":true,"_uuid":"279778d9bb629200a7ae1e746b5150df831484e3","trusted":true,"_cell_guid":"b06bde63-1781-49a0-b39a-211da0dabe23"},"cell_type":"code","source":"\n#Rule Learner\n\n#Personally I like Rule learner as it is giving us clear information about factors that has an impact on the final results. \n\ntitanic_model_RL <- JRip(Survived ~ Pclass +Sex+ Adult+ Family + Deck + title + Embarked + Ticketsize, data = titanic_train)\nprediction_RL=predict(titanic_model_RL,titanic_test)\n\ntitanic_model_RL\n\n#Rule learner has generated 4 rules for the data set. The first 3 rules are quite precise. Unfortunately, 4th is just pointing that besides \n#3 previous cases, nobody survived. As you may see, it has a error % of 20%. Rule learner has not been able to generate any rule for this set.\n\n","execution_count":21,"outputs":[]},{"metadata":{"_uuid":"4feb52493235ba69b06ec87bd9bdba77f0732474","trusted":false,"_cell_guid":"4a7ac768-d459-4a3c-ba8b-a807e5dea7cd"},"cell_type":"code","source":"#Writting results\n\nresults=data.frame(titanic_test$PassengerId)\nresults$Survived=prediction_RL\nresults$Survived=as.integer(results$Survived)-1\ncolnames(results)=c(\"PassengerID\",\"Survived\")\nwrite.csv(results, file=\"results.csv\",row.names=FALSE)","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}