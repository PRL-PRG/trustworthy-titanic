## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
train<- read.csv("train.csv")
test<- read.csv("test.csv")
summary(train)
summary(test)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test$Survived<- NA
bind<- rbind(train,test)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(ggplot2)
ggplot(bind,aes(x=Embarked,y=Fare,fill=factor(Pclass)))+geom_boxplot()+geom_hline(yintercept = 80)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
bind$Embarked[c(62,830)]<- "C"


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
bind1<- bind[bind$Pclass==3,]
aggregate(Fare~Embarked,bind1,mean)
bind$Fare[which(is.na(bind$Fare))]<- 14.43


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
bind$title<- gsub('(.*, )|(\\..*)', '', bind$Name)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
table(bind$Sex,bind$title)
bind$title[bind$title=="Capt"]<- "Mr"
bind$title[bind$title=="Col"]<- "Mr"
bind$title[bind$title=="Don"]<- "Mr"
bind$title[bind$title=="Dona"]<- "Mrs"
bind$title[bind$title=="Jonkheer"]<- "Mr"
bind$title[bind$title=="Lady"]<- "Mrs"
bind$title[bind$title=="Major"]<- "Mr"
bind$title[bind$title=="Mlle"]<- "Mrs"
bind$title[bind$title=="Mme"]<- "Mrs"
bind$title[bind$title=="Ms"]<- "Mrs"
bind$title[bind$title=="Rev"]<- "Mr"
bind$title[bind$title=="Sir"]<- "Mr"
bind$title[bind$title=="the Countess"]<- "Mrs"


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
hist(bind$Age)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
bind2<- bind[!is.na(bind$Age),-c(9,11)]
library(rpart)
library(rpart.plot)
library(rattle)
predictage<- rpart(Age~Pclass+Sex+SibSp+Parch+Embarked+title+Fare,data=bind2,method="anova")
fancyRpartPlot(predictage)
bind$Age[is.na(bind$Age)]<- predict(predictage,data= bind[is.na(bind$Age)])
hist(bind$Age,  main = "age distribution after imputing missing values")


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(randomForest)
bind$title<- as.factor(bind$title)
trainnew<- bind[1:891,-c(9,11)]
testnew<- bind[892:1309,-c(9,11)]
rf_model <- randomForest(factor(Survived) ~ Pclass + Sex + Age + SibSp + Parch + Fare + Embarked + title ,data = trainnew)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
varImpPlot(rf_model)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
testpredict<- predict(rf_model,testnew)
titanic<- data.frame(PassengerId=test$PassengerId, survived= testpredict)
write.csv(titanic,"titanic.csv",row.names=FALSE)

