
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin15.6.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> 
> # This R environment comes with all of CRAN preinstalled, as well as many other helpful packages
> # The environment is defined by the kaggle/rstats docker image: https://github.com/kaggle/docker-rstats
> # For example, here's several helpful packages to load in 
> 
> library(ggplot2) # Data visualization
Warning message:
package â€˜ggplot2â€™ was built under R version 3.6.2 
> library(readr) # CSV file I/O, e.g. the read_csv function
> 
> # Input data files are available in the "../input/" directory.
> # For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory
> 
> system("ls ../input")
gender_submission.csv
test.csv
train.csv
> 
> # Any results you write to the current directory are saved as output.
> 
> library(tidyverse)
â”€â”€ [1mAttaching packages[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.0 â”€â”€
[32mâœ“[39m [34mtibble [39m 3.0.1     [32mâœ“[39m [34mdplyr  [39m 1.0.2
[32mâœ“[39m [34mtidyr  [39m 1.1.0     [32mâœ“[39m [34mstringr[39m 1.4.0
[32mâœ“[39m [34mpurrr  [39m 0.3.4     [32mâœ“[39m [34mforcats[39m 0.5.0
â”€â”€ [1mConflicts[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
[31mx[39m [34mdplyr[39m::[32mfilter()[39m masks [34mstats[39m::filter()
[31mx[39m [34mdplyr[39m::[32mlag()[39m    masks [34mstats[39m::lag()
Warning messages:
1: package â€˜tibbleâ€™ was built under R version 3.6.2 
2: package â€˜tidyrâ€™ was built under R version 3.6.2 
3: package â€˜purrrâ€™ was built under R version 3.6.2 
4: package â€˜dplyrâ€™ was built under R version 3.6.2 
> library(rpart)
> library(rpart.plot) 
> library(caret)
Loading required package: lattice

Attaching package: â€˜caretâ€™

The following object is masked from â€˜package:purrrâ€™:

    lift

> library(ggplot2)
> library(Hmisc)
Loading required package: survival

Attaching package: â€˜survivalâ€™

The following object is masked from â€˜package:caretâ€™:

    cluster

Loading required package: Formula

Attaching package: â€˜Hmiscâ€™

The following objects are masked from â€˜package:dplyrâ€™:

    src, summarize

The following objects are masked from â€˜package:baseâ€™:

    format.pval, units

Warning message:
package â€˜survivalâ€™ was built under R version 3.6.2 
> 
> #import dataset
> train<-read_csv("../input/train.csv") 
Parsed with column specification:
cols(
  PassengerId = [32mcol_double()[39m,
  Survived = [32mcol_double()[39m,
  Pclass = [32mcol_double()[39m,
  Name = [31mcol_character()[39m,
  Sex = [31mcol_character()[39m,
  Age = [32mcol_double()[39m,
  SibSp = [32mcol_double()[39m,
  Parch = [32mcol_double()[39m,
  Ticket = [31mcol_character()[39m,
  Fare = [32mcol_double()[39m,
  Cabin = [31mcol_character()[39m,
  Embarked = [31mcol_character()[39m
)
> test<-read_csv("../input/test.csv") 
Parsed with column specification:
cols(
  PassengerId = [32mcol_double()[39m,
  Pclass = [32mcol_double()[39m,
  Name = [31mcol_character()[39m,
  Sex = [31mcol_character()[39m,
  Age = [32mcol_double()[39m,
  SibSp = [32mcol_double()[39m,
  Parch = [32mcol_double()[39m,
  Ticket = [31mcol_character()[39m,
  Fare = [32mcol_double()[39m,
  Cabin = [31mcol_character()[39m,
  Embarked = [31mcol_character()[39m
)
> 
> #How dose Embarked impact on the survival or pessengers
> ggplot(train, aes(x = Embarked, fill = factor(Survived))) +
+   geom_bar(stat='count', position='dodge') +
+   labs(x = 'Embarked')
> 
> #How different the Pclass impact on survial of male & female
> ggplot(train,aes(x=Sex,fill=factor(Survived)))+
+   geom_bar(position='dodge')+
+   facet_grid(.~Pclass)+
+   labs(title = "How Different Pclass impact the survival of male&female passengers",x = "Pclass",y = "Count")
> 
> #Test how dose the family size impact the survival of pessengers
> train$FamilySize<-train$SibSp+train$Parch
> ggplot(train, aes(x = FamilySize, fill = factor(Survived))) +
+   geom_bar(stat='count', position='dodge') +
+   scale_x_continuous(breaks=c(1:11)) +
+   labs(x = 'Family Size')
> 
> train$Child[train$Age < 16] <- 'Child'
Warning message:
Unknown or uninitialised column: `Child`. 
> train$Child[train$Age >= 16] <- 'Adult'
> 
> table(train$Child,train$Survived)
       
          0   1
  Adult 390 241
  Child  34  49
> 
> #Deal with the missing values
> ggplot(train, aes(x=Embarked,y=Fare))+geom_boxplot(aes(fill=factor(Pclass)))
> train$Embarked[is.na(train$Embarked)]<-'C'
> test[is.na(test$Fare),]
[90m# A tibble: 1 x 11[39m
  PassengerId Pclass Name    Sex     Age SibSp Parch Ticket  Fare Cabin Embarked
        [3m[90m<dbl>[39m[23m  [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m   [3m[90m<chr>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m  [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m [3m[90m<chr>[39m[23m   
[90m1[39m        [4m1[24m044      3 Storeyâ€¦ male   60.5     0     0 3701      [31mNA[39m [31mNA[39m    S       
> 
> test1<-test[c(test$Embarked=='S'),] 
> test2<-test1[c(test1$Pclass==3),]
> test3<-test2[complete.cases(test2$Fare),]
> test$Fare[is.na(test$Fare)]<-mean(test3$Fare)
> 
> #feature engineering
> # create title from passenger names
> full<-bind_rows(train,test)
> full$Child[full$Age < 16] <- 'Child'
> full$Child[full$Age >= 16] <- 'Adult'
> full$FamilySize<-full$SibSp+full$Parch
> full$FsizeD[full$FamilySize == 0] <- 'singleton'
Warning message:
Unknown or uninitialised column: `FsizeD`. 
> full$FsizeD[full$FamilySize< 4 & full$FamilySize > 0] <- 'small'
> full$FsizeD[full$FamilySize >=4 ] <- 'large'
> 
> full$Title <- gsub('(.*, )|(\\..*)', '', full$Name)
> rare_title <- c('Dona', 'Lady', 'the Countess','Capt', 'Col', 'Don', 
+                 'Dr', 'Major', 'Rev', 'Sir', 'Jonkheer')
> full$Title[full$Title == 'Mlle']        <- 'Miss' 
> full$Title[full$Title == 'Ms']          <- 'Miss'
> full$Title[full$Title == 'Mme']         <- 'Mrs' 
> full$Title[full$Title %in% rare_title]  <- 'Rare Title'
> table(full$Sex, full$Title)
        
         Master Miss  Mr Mrs Rare Title
  female      0  264   0 198          4
  male       61    0 757   0         25
> 
> #Different combinations of feature
> full$Sex <- as.factor(full$Sex)
> full$Pclass <- as.factor(full$Pclass)
> full$Title<-as.factor(full$Title)
> full$Embarked<-as.factor(full$Embarked)
> full$FsizeD<-as.factor(full$FsizeD)
> 
> train <- full[1:891,]
> test <- full[892:1309,]
> 
> #Bulid our Modeling
> fol <- formula(Survived ~Title+ Fare+ Pclass+Age)
> model <- rpart(fol, method="class", data=train)
> 
> #Identify the change of the tree
> rpart.plot(model,branch=0,branch.type=2,type=1,extra=102,shadow.col="pink",box.col="gray",split.col="magenta",
+            main="Decision tree for model")
> rpred <- predict(model, newdata=test, type="class")
> 
> proc.time()
   user  system elapsed 
  4.387   0.312   4.748 
