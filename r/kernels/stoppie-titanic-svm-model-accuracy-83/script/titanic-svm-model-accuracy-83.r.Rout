
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin15.6.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> library(tidyverse) # metapackage with lots of helpful functions
â”€â”€ [1mAttaching packages[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.0 â”€â”€
[32mâœ“[39m [34mggplot2[39m 3.3.2     [32mâœ“[39m [34mpurrr  [39m 0.3.4
[32mâœ“[39m [34mtibble [39m 3.0.1     [32mâœ“[39m [34mdplyr  [39m 1.0.2
[32mâœ“[39m [34mtidyr  [39m 1.1.0     [32mâœ“[39m [34mstringr[39m 1.4.0
[32mâœ“[39m [34mreadr  [39m 1.3.1     [32mâœ“[39m [34mforcats[39m 0.5.0
â”€â”€ [1mConflicts[22m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
[31mx[39m [34mdplyr[39m::[32mfilter()[39m masks [34mstats[39m::filter()
[31mx[39m [34mdplyr[39m::[32mlag()[39m    masks [34mstats[39m::lag()
Warning messages:
1: package â€˜ggplot2â€™ was built under R version 3.6.2 
2: package â€˜tibbleâ€™ was built under R version 3.6.2 
3: package â€˜tidyrâ€™ was built under R version 3.6.2 
4: package â€˜purrrâ€™ was built under R version 3.6.2 
5: package â€˜dplyrâ€™ was built under R version 3.6.2 
> library(mlr) # wrapper for machine learning algorithms
Loading required package: ParamHelpers
'mlr' is in maintenance mode since July 2019. Future development
efforts will go into its successor 'mlr3' (<https://mlr3.mlr-org.com>).
> library(kernlab) # svm learner

Attaching package: â€˜kernlabâ€™

The following object is masked from â€˜package:purrrâ€™:

    cross

The following object is masked from â€˜package:ggplot2â€™:

    alpha

> # library(parallel) # parallel computations
> # library(parallelMap) # parallel computations
> 
> # train
> titanic_train <- read_csv(
+     '../input/train.csv',
+     col_types = cols(
+         PassengerId = col_character(),
+         Survived = col_character(),
+         Pclass = col_character(),
+         Name = col_character(),
+         Sex = col_character(),
+         Age = col_double(),
+         SibSp = col_integer(),
+         Parch = col_integer(),
+         Ticket = col_character(),
+         Fare = col_double(),
+         Cabin = col_character(),
+         Embarked = col_character()
+     )
+ ) %>%
+ mutate(label = 'train') %>%
+ select(-PassengerId)
> 
> # test
> titanic_test <- read_csv(
+     '../input/test.csv',
+     col_types = cols(
+         PassengerId = col_character(),
+         Pclass = col_character(),
+         Name = col_character(),
+         Sex = col_character(),
+         Age = col_double(),
+         SibSp = col_integer(),
+         Parch = col_integer(),
+         Ticket = col_character(),
+         Fare = col_double(),
+         Cabin = col_character(),
+         Embarked = col_character()
+     )
+ ) %>%
+ mutate(
+     label = 'test',
+     Survived = '0'
+ ) %>%
+ select(-PassengerId)
> 
> # merge
> titanic <- rbind(titanic_train, titanic_test)
> 
> # head
> head(titanic, 10)
[90m# A tibble: 10 x 12[39m
   Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare Cabin Embarked
   [3m[90m<chr>[39m[23m    [3m[90m<chr>[39m[23m  [3m[90m<chr>[39m[23m [3m[90m<chr>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<int>[39m[23m [3m[90m<int>[39m[23m [3m[90m<chr>[39m[23m  [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m [3m[90m<chr>[39m[23m   
[90m 1[39m 0        3      Brauâ€¦ male     22     1     0 A/5 2â€¦  7.25 [31mNA[39m    S       
[90m 2[39m 1        1      Cumiâ€¦ femaâ€¦    38     1     0 PC 17â€¦ 71.3  C85   C       
[90m 3[39m 1        3      Heikâ€¦ femaâ€¦    26     0     0 STON/â€¦  7.92 [31mNA[39m    S       
[90m 4[39m 1        1      Futrâ€¦ femaâ€¦    35     1     0 113803 53.1  C123  S       
[90m 5[39m 0        3      Alleâ€¦ male     35     0     0 373450  8.05 [31mNA[39m    S       
[90m 6[39m 0        3      Moraâ€¦ male     [31mNA[39m     0     0 330877  8.46 [31mNA[39m    Q       
[90m 7[39m 0        1      McCaâ€¦ male     54     0     0 17463  51.9  E46   S       
[90m 8[39m 0        3      Palsâ€¦ male      2     3     1 349909 21.1  [31mNA[39m    S       
[90m 9[39m 1        3      Johnâ€¦ femaâ€¦    27     0     2 347742 11.1  [31mNA[39m    S       
[90m10[39m 1        2      Nassâ€¦ femaâ€¦    14     1     0 237736 30.1  [31mNA[39m    C       
[90m# â€¦ with 1 more variable: label [3m[90m<chr>[90m[23m[39m
> 
> summarizeColumns(titanic)
       name      type   na       mean       disp  median      mad    min
1  Survived character    0         NA  0.2612681      NA       NA 342.00
2    Pclass character    0         NA  0.4583652      NA       NA 277.00
3      Name character    0         NA  0.9984721      NA       NA   1.00
4       Sex character    0         NA  0.3559969      NA       NA 466.00
5       Age   numeric  263 29.8811377 14.4134932 28.0000 11.86080   0.17
6     SibSp   integer    0  0.4988541  1.0416584  0.0000  0.00000   0.00
7     Parch   integer    0  0.3850267  0.8655603  0.0000  0.00000   0.00
8    Ticket character    0         NA  0.9915966      NA       NA   1.00
9      Fare   numeric    1 33.2954793 51.7586682 14.4542 10.23617   0.00
10    Cabin character 1014         NA         NA      NA       NA   1.00
11 Embarked character    2         NA         NA      NA       NA 123.00
12    label character    0         NA  0.3193277      NA       NA 418.00
        max nlevs
1  967.0000     2
2  709.0000     3
3    2.0000  1307
4  843.0000     2
5   80.0000     0
6    8.0000     0
7    9.0000     0
8   11.0000   929
9  512.3292     0
10   6.0000   186
11 914.0000     3
12 891.0000     2
> 
> titanic <- titanic %>%
+ mutate(
+     Title = str_extract(Name, '\\w+(?=\\.)'),
+     Nickname = str_extract(Name, '\\(.+\\)'),
+     HasNickname = if_else(is.na(Nickname), '0', '1')
+ ) %>%
+ select(-one_of('Nickname', 'Name'))
> 
> table(titanic$Title) %>% data.frame %>% setNames(c('Title', 'Frequency'))
      Title Frequency
1      Capt         1
2       Col         4
3  Countess         1
4       Don         1
5      Dona         1
6        Dr         8
7  Jonkheer         1
8      Lady         1
9     Major         2
10   Master        61
11     Miss       260
12     Mlle         2
13      Mme         1
14       Mr       757
15      Mrs       197
16       Ms         2
17      Rev         8
18      Sir         1
> 
> titanic <- titanic %>%
+ mutate(
+     Title = case_when(
+         Title %in% c('Capt', 'Col', 'Major') ~ 'Officer',
+         Title %in% c('Countess', 'Don', 'Dona', 'Jonkheer', 'Lady', 'Ms', 'Sir') ~ 'Honorific',
+         Title == 'Mlle' ~ 'Miss',
+         Title == 'Mme' ~ 'Mrs',
+         TRUE ~ as.character(Title)
+     )
+ )
> 
> ggplot(titanic, aes(x = Age)) +
+ geom_histogram(bins = 20) +
+ theme_light() +
+ ggtitle('Age distribution')
Warning message:
Removed 263 rows containing non-finite values (stat_bin). 
> 
> titanic %>%
+ group_by(Title) %>%
+ summarize(
+     min_age = min(Age, na.rm = T),
+     max_age = max(Age, na.rm = T),
+     missing_count = sum(is.na(Age)) / n()
+ )
`summarise()` ungrouping output (override with `.groups` argument)
[90m# A tibble: 8 x 4[39m
  Title     min_age max_age missing_count
  [3m[90m<chr>[39m[23m       [3m[90m<dbl>[39m[23m   [3m[90m<dbl>[39m[23m         [3m[90m<dbl>[39m[23m
[90m1[39m Dr          23       54           0.125
[90m2[39m Honorific   28       49           0.125
[90m3[39m Master       0.33    14.5         0.131
[90m4[39m Miss         0.17    63           0.191
[90m5[39m Mr          11       80           0.232
[90m6[39m Mrs         14       76           0.136
[90m7[39m Officer     45       70           0    
[90m8[39m Rev         27       57           0    
> 
> titanic <- titanic %>%
+ mutate(
+     Family = SibSp + Parch
+ )
> 
> titanic <- titanic %>%
+ group_by(Ticket) %>%
+ mutate(TicketSize = n()) %>%
+ ungroup
> 
> titanic <- titanic %>%
+ mutate(
+     TicketGroup = word(Ticket) %>% str_replace_all("[[:punct:]]", ""),
+     TicketGroup = if_else(is.na(as.numeric(TicketGroup)), TicketGroup, 'NONE')
+ ) %>%
+ select(-Ticket)
Warning messages:
1: Problem with `mutate()` input `TicketGroup`.
[34mâ„¹[39m NAs introduced by coercion
[34mâ„¹[39m Input `TicketGroup` is `if_else(is.na(as.numeric(TicketGroup)), TicketGroup, "NONE")`. 
2: In if_else(is.na(as.numeric(TicketGroup)), TicketGroup, "NONE") :
  NAs introduced by coercion
> 
> # check TicketGroup distribution
> table(titanic$TicketGroup) %>% data.frame %>% setNames(c('TicketGroup', 'Frequency'))
   TicketGroup Frequency
1            A         1
2           A4        10
3           A5        28
4          AQ3         1
5          AQ4         1
6           AS         1
7            C         8
8           CA        68
9      CASOTON         1
10          Fa         1
11          FC         3
12         FCC         9
13        LINE         4
14          LP         1
15        NONE       957
16          PC        92
17          PP         4
18         PPP         2
19          SC         2
20        SCA3         1
21        SCA4         2
22        SCAH         5
23        SCOW         1
24     SCParis         5
25     SCPARIS        14
26         SOC         8
27         SOP         1
28        SOPP         7
29     SOTONO2         3
30     SOTONOQ        24
31          SP         1
32       STONO        14
33      STONO2         7
34      STONOQ         1
35        SWPP         2
36          WC        15
37         WEP         4
> 
> titanic <- titanic %>%
+ group_by(TicketGroup) %>%
+ mutate(
+     group_size = n()
+ ) %>%
+ ungroup %>%
+ mutate(
+     TicketGroup = if_else(
+         group_size < 7L,
+         'OTHER',
+         TicketGroup
+     )
+ ) %>%
+ select(-group_size)
> 
> # distribution of TicketGroup
> table(titanic$TicketGroup) %>% data.frame %>% setNames(c('TicketGroup', 'Frequency'))
   TicketGroup Frequency
1           A4        10
2           A5        28
3            C         8
4           CA        68
5          FCC         9
6         NONE       957
7        OTHER        48
8           PC        92
9      SCPARIS        14
10         SOC         8
11        SOPP         7
12     SOTONOQ        24
13       STONO        14
14      STONO2         7
15          WC        15
> 
> ggplot(titanic, aes(x = Fare)) +
+ geom_histogram(bins = 15) +
+ theme_light() +
+ ggtitle('Fare distribution')
Warning message:
Removed 1 rows containing non-finite values (stat_bin). 
> 
> ggplot(titanic, aes(x = log(Fare + 1))) +
+ geom_histogram(bins = 15) +
+ theme_light() +
+ ggtitle('Log(Fare + 1) distribution')
Warning message:
Removed 1 rows containing non-finite values (stat_bin). 
> 
> titanic$Fare <- log(titanic$Fare + 1)
> 
> titanic <- titanic %>%
+ mutate(
+     CabinGroup =
+         str_split(Cabin, '\\s') %>% # split Cabins by any white space character
+         lapply(substr, start = 1, stop = 1) %>% # get first character of each Cabin
+         # get the mode of all cabins
+         lapply(function(vec) {
+             uniq_vec <- unique(vec) # unique values
+             uniq_vec[which.max(tabulate(match(vec, uniq_vec)))] # mode
+         }) %>%
+         as.character
+ ) %>%
+ select(-Cabin)
> 
> # check CabinGroup distribution
> table(titanic$CabinGroup) %>% data.frame %>% setNames(c('CabinGroup', 'Frequency'))
  CabinGroup Frequency
1          A        22
2          B        65
3          C        94
4          D        46
5          E        41
6          F        21
7          G         5
8          T         1
> 
> titanic <- titanic %>%
+ mutate(
+     CabinGroup = if_else(
+         CabinGroup %in% c('G', 'T'),
+         NA_character_,
+         CabinGroup
+     )
+ )
> 
> table(titanic$Embarked) %>% data.frame %>% setNames(c('Embarked', 'Frequency'))
  Embarked Frequency
1        C       270
2        Q       123
3        S       914
> 
> head(titanic, 20)
[90m# A tibble: 20 x 15[39m
   Survived Pclass Sex     Age SibSp Parch  Fare Embarked label Title
   [3m[90m<chr>[39m[23m    [3m[90m<chr>[39m[23m  [3m[90m<chr>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<int>[39m[23m [3m[90m<int>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<chr>[39m[23m    [3m[90m<chr>[39m[23m [3m[90m<chr>[39m[23m
[90m 1[39m 0        3      male     22     1     0  2.11 S        train Mr   
[90m 2[39m 1        1      femaâ€¦    38     1     0  4.28 C        train Mrs  
[90m 3[39m 1        3      femaâ€¦    26     0     0  2.19 S        train Miss 
[90m 4[39m 1        1      femaâ€¦    35     1     0  3.99 S        train Mrs  
[90m 5[39m 0        3      male     35     0     0  2.20 S        train Mr   
[90m 6[39m 0        3      male     [31mNA[39m     0     0  2.25 Q        train Mr   
[90m 7[39m 0        1      male     54     0     0  3.97 S        train Mr   
[90m 8[39m 0        3      male      2     3     1  3.09 S        train Mastâ€¦
[90m 9[39m 1        3      femaâ€¦    27     0     2  2.50 S        train Mrs  
[90m10[39m 1        2      femaâ€¦    14     1     0  3.44 C        train Mrs  
[90m11[39m 1        3      femaâ€¦     4     1     1  2.87 S        train Miss 
[90m12[39m 1        1      femaâ€¦    58     0     0  3.32 S        train Miss 
[90m13[39m 0        3      male     20     0     0  2.20 S        train Mr   
[90m14[39m 0        3      male     39     1     5  3.47 S        train Mr   
[90m15[39m 0        3      femaâ€¦    14     0     0  2.18 S        train Miss 
[90m16[39m 1        2      femaâ€¦    55     0     0  2.83 S        train Mrs  
[90m17[39m 0        3      male      2     4     1  3.41 Q        train Mastâ€¦
[90m18[39m 1        2      male     [31mNA[39m     0     0  2.64 S        train Mr   
[90m19[39m 0        3      femaâ€¦    31     1     0  2.94 S        train Mrs  
[90m20[39m 1        3      femaâ€¦    [31mNA[39m     0     0  2.11 C        train Mrs  
[90m# â€¦ with 5 more variables: HasNickname [3m[90m<chr>[90m[23m, Family [3m[90m<int>[90m[23m, TicketSize [3m[90m<int>[90m[23m,[39m
[90m#   TicketGroup [3m[90m<chr>[90m[23m, CabinGroup [3m[90m<chr>[90m[23m[39m
> 
> titanic <- titanic %>%
+ mutate_if(sapply(titanic, is.character), factor)
> 
> summarizeColumns(titanic)
          name    type   na       mean       disp    median        mad    min
1     Survived  factor    0         NA  0.2612681        NA         NA 342.00
2       Pclass  factor    0         NA  0.4583652        NA         NA 277.00
3          Sex  factor    0         NA  0.3559969        NA         NA 466.00
4          Age numeric  263 29.8811377 14.4134932 28.000000 11.8608000   0.17
5        SibSp integer    0  0.4988541  1.0416584  0.000000  0.0000000   0.00
6        Parch integer    0  0.3850267  0.8655603  0.000000  0.0000000   0.00
7         Fare numeric    1  2.9794107  0.9686684  2.737881  0.8391131   0.00
8     Embarked  factor    2         NA         NA        NA         NA 123.00
9        label  factor    0         NA  0.3193277        NA         NA 418.00
10       Title  factor    0         NA  0.4216960        NA         NA   7.00
11 HasNickname  factor    0         NA  0.1688312        NA         NA 221.00
12      Family integer    0  0.8838808  1.5836391  0.000000  0.0000000   0.00
13  TicketSize integer    0  2.1016043  1.7798324  1.000000  0.0000000   1.00
14 TicketGroup  factor    0         NA  0.2689076        NA         NA   7.00
15  CabinGroup  factor 1020         NA         NA        NA         NA  21.00
           max nlevs
1   967.000000     2
2   709.000000     3
3   843.000000     2
4    80.000000     0
5     8.000000     0
6     9.000000     0
7     6.240917     0
8   914.000000     3
9   891.000000     2
10  757.000000     8
11 1088.000000     2
12   10.000000     0
13   11.000000     0
14  957.000000    15
15   94.000000     6
> 
> train_data <- titanic %>%
+ # filter(label.train == 1) %>%
+ # select(-one_of(c('label.train', 'label.test'))) %>%
+ filter(label == 'train') %>%
+ select(-label)
> 
> head(train_data, 20)
[90m# A tibble: 20 x 14[39m
   Survived Pclass Sex     Age SibSp Parch  Fare Embarked Title HasNickname
   [3m[90m<fct>[39m[23m    [3m[90m<fct>[39m[23m  [3m[90m<fct>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<int>[39m[23m [3m[90m<int>[39m[23m [3m[90m<dbl>[39m[23m [3m[90m<fct>[39m[23m    [3m[90m<fct>[39m[23m [3m[90m<fct>[39m[23m      
[90m 1[39m 0        3      male     22     1     0  2.11 S        Mr    0          
[90m 2[39m 1        1      femaâ€¦    38     1     0  4.28 C        Mrs   1          
[90m 3[39m 1        3      femaâ€¦    26     0     0  2.19 S        Miss  0          
[90m 4[39m 1        1      femaâ€¦    35     1     0  3.99 S        Mrs   1          
[90m 5[39m 0        3      male     35     0     0  2.20 S        Mr    0          
[90m 6[39m 0        3      male     [31mNA[39m     0     0  2.25 Q        Mr    0          
[90m 7[39m 0        1      male     54     0     0  3.97 S        Mr    0          
[90m 8[39m 0        3      male      2     3     1  3.09 S        Mastâ€¦ 0          
[90m 9[39m 1        3      femaâ€¦    27     0     2  2.50 S        Mrs   1          
[90m10[39m 1        2      femaâ€¦    14     1     0  3.44 C        Mrs   1          
[90m11[39m 1        3      femaâ€¦     4     1     1  2.87 S        Miss  0          
[90m12[39m 1        1      femaâ€¦    58     0     0  3.32 S        Miss  0          
[90m13[39m 0        3      male     20     0     0  2.20 S        Mr    0          
[90m14[39m 0        3      male     39     1     5  3.47 S        Mr    0          
[90m15[39m 0        3      femaâ€¦    14     0     0  2.18 S        Miss  0          
[90m16[39m 1        2      femaâ€¦    55     0     0  2.83 S        Mrs   1          
[90m17[39m 0        3      male      2     4     1  3.41 Q        Mastâ€¦ 0          
[90m18[39m 1        2      male     [31mNA[39m     0     0  2.64 S        Mr    0          
[90m19[39m 0        3      femaâ€¦    31     1     0  2.94 S        Mrs   1          
[90m20[39m 1        3      femaâ€¦    [31mNA[39m     0     0  2.11 C        Mrs   0          
[90m# â€¦ with 4 more variables: Family [3m[90m<int>[90m[23m, TicketSize [3m[90m<int>[90m[23m, TicketGroup [3m[90m<fct>[90m[23m,[39m
[90m#   CabinGroup [3m[90m<fct>[90m[23m[39m
> 
> train_data <- train_data %>%
+ replace_na(
+     replace = list(
+         Age = mean(train_data$Age, na.rm = TRUE),
+         Fare = mean(train_data$Fare, na.rm = TRUE),
+         Embarked = 'S',
+         CabinGroup = 'C'
+     )
+ )
> 
> train_task <- makeClassifTask(
+     data = train_data,
+     target = 'Survived',
+     positive = '1'
+ )
Warning in makeTask(type = type, data = data, weights = weights, blocking = blocking,  :
  Provided data is not a pure data.frame but from class tbl_df, hence it will be converted.
> 
> svm_learner <- makeLearner(
+     'classif.ksvm',
+     predict.type = 'prob',
+     par.vals = list(
+         scaled = TRUE,
+         type = 'nu-svc'
+     )
+ )
> 
> c50_learner <- makeLearner(
+     'classif.C50',
+     predict.type = 'prob',
+     par.vals = list(
+         winnow = TRUE
+     )
+ )
Error in requirePackages(package, why = stri_paste("learner", id, sep = " "),  : 
  For learner classif.C50 please install the following packages: C50
Calls: makeLearner ... addClasses -> makeRLearnerInternal -> requirePackages -> stopf
Execution halted
