
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin15.6.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> # install.packages("xtable")
> # install.packages("ggplot2")
> # install.packages("dplyr")
> # install.packages("plyr")
> # install.packages("vcd")
> # install.packages("png")
> # install.packages("caret")
> # install.packages("randomForest")
> # install.packages("ggrepel")
> # install.packages("party")
> # install.packages("Amelia")
> # install.packages("mice")
> # install.packages("mlbench")
> # install.packages("party")
> # install.packages("rpart")
> # install.packages("rpart.plot")
> # install.packages("rattle")
> # install.packages("ROCR")
> # install.packages("Hmisc")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> suppressMessages(library(caret))                                 # Machine learning
Warning message:
package ‘ggplot2’ was built under R version 3.6.2 
> suppressMessages(library(rpart))
> suppressMessages(library(e1071))
> suppressMessages(library(randomForest))
> suppressMessages(library(mlbench))
> suppressMessages(library(party))
Warning messages:
1: package ‘party’ was built under R version 3.6.2 
2: package ‘zoo’ was built under R version 3.6.2 
> suppressMessages(library(ggplot2))                               # Plotting
> suppressMessages(library(lattice))
> suppressMessages(library(grid))
> suppressMessages(library(gridExtra, warn.conflicts = FALSE))
> suppressMessages(library(ggrepel))
> suppressMessages(library(vcd))
Warning message:
package ‘vcd’ was built under R version 3.6.2 
> suppressMessages(library(rpart.plot))
> suppressMessages(library(rattle))
Warning messages:
1: package ‘rattle’ was built under R version 3.6.2 
2: package ‘tibble’ was built under R version 3.6.2 
> suppressMessages(library(ROCR))
Warning message:
package ‘ROCR’ was built under R version 3.6.2 
> suppressMessages(library(mice))                                  # Data imputation
Warning message:
package ‘mice’ was built under R version 3.6.2 
> suppressMessages(library(xtable))                                # Pretty printing dataframes
> suppressMessages(library(plyr, warn.conflicts = FALSE))          # Manipulating dataframes
> suppressMessages(library(Hmisc))
Warning message:
package ‘survival’ was built under R version 3.6.2 
> suppressMessages(library(Amelia))                                # Missing data
> suppressMessages(library(dplyr, warn.conflicts = FALSE))
Warning message:
package ‘dplyr’ was built under R version 3.6.2 
> suppressMessages(library(stringr))                               # String operations
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> train <- read.csv('../input/train.csv', na.strings=c("NA", "NULL", ""), stringsAsFactors = F)
> test  <- read.csv('../input/test.csv', na.strings=c("NA", "NULL", ""), stringsAsFactors = F)
> all <- rbind.fill(train, test)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> str(test)
'data.frame':	418 obs. of  11 variables:
 $ PassengerId: int  892 893 894 895 896 897 898 899 900 901 ...
 $ Pclass     : int  3 3 2 3 3 3 3 2 3 3 ...
 $ Name       : chr  "Kelly, Mr. James" "Wilkes, Mrs. James (Ellen Needs)" "Myles, Mr. Thomas Francis" "Wirz, Mr. Albert" ...
 $ Sex        : chr  "male" "female" "male" "male" ...
 $ Age        : num  34.5 47 62 27 22 14 30 26 18 21 ...
 $ SibSp      : int  0 1 0 0 1 0 0 1 0 2 ...
 $ Parch      : int  0 0 0 0 1 0 0 1 0 0 ...
 $ Ticket     : chr  "330911" "363272" "240276" "315154" ...
 $ Fare       : num  7.83 7 9.69 8.66 12.29 ...
 $ Cabin      : chr  NA NA NA NA ...
 $ Embarked   : chr  "Q" "S" "Q" "S" ...
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> trainRows <- nrow(train)
> testRows <- nrow(test)
> totalRows <- nrow(train) + nrow(test)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> renderTable <- function(data) {
+   print(xtable(data), type = "html")
+ }
> 
> sampleDataFrame <- function(data, size) {
+   sampleIndex <- sample(1:nrow(train), size)
+   return(data[sampleIndex, ])
+ }
> 
> 
> ## ---- results="asis"-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> renderTable(sampleDataFrame(train, 10))
<!-- html table generated in R 3.6.1 by xtable 1.8-4 package -->
<!-- Thu Sep 10 12:46:32 2020 -->
<table border=1>
<tr> <th>  </th> <th> PassengerId </th> <th> Survived </th> <th> Pclass </th> <th> Name </th> <th> Sex </th> <th> Age </th> <th> SibSp </th> <th> Parch </th> <th> Ticket </th> <th> Fare </th> <th> Cabin </th> <th> Embarked </th>  </tr>
  <tr> <td align="right"> 871 </td> <td align="right"> 871 </td> <td align="right">   0 </td> <td align="right">   3 </td> <td> Balkic, Mr. Cerin </td> <td> male </td> <td align="right"> 26.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 349248 </td> <td align="right"> 7.90 </td> <td>  </td> <td> S </td> </tr>
  <tr> <td align="right"> 673 </td> <td align="right"> 673 </td> <td align="right">   0 </td> <td align="right">   2 </td> <td> Mitchell, Mr. Henry Michael </td> <td> male </td> <td align="right"> 70.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> C.A. 24580 </td> <td align="right"> 10.50 </td> <td>  </td> <td> S </td> </tr>
  <tr> <td align="right"> 10 </td> <td align="right">  10 </td> <td align="right">   1 </td> <td align="right">   2 </td> <td> Nasser, Mrs. Nicholas (Adele Achem) </td> <td> female </td> <td align="right"> 14.00 </td> <td align="right">   1 </td> <td align="right">   0 </td> <td> 237736 </td> <td align="right"> 30.07 </td> <td>  </td> <td> C </td> </tr>
  <tr> <td align="right"> 550 </td> <td align="right"> 550 </td> <td align="right">   1 </td> <td align="right">   2 </td> <td> Davies, Master. John Morgan Jr </td> <td> male </td> <td align="right"> 8.00 </td> <td align="right">   1 </td> <td align="right">   1 </td> <td> C.A. 33112 </td> <td align="right"> 36.75 </td> <td>  </td> <td> S </td> </tr>
  <tr> <td align="right"> 231 </td> <td align="right"> 231 </td> <td align="right">   1 </td> <td align="right">   1 </td> <td> Harris, Mrs. Henry Birkhardt (Irene Wallach) </td> <td> female </td> <td align="right"> 35.00 </td> <td align="right">   1 </td> <td align="right">   0 </td> <td> 36973 </td> <td align="right"> 83.47 </td> <td> C83 </td> <td> S </td> </tr>
  <tr> <td align="right"> 324 </td> <td align="right"> 324 </td> <td align="right">   1 </td> <td align="right">   2 </td> <td> Caldwell, Mrs. Albert Francis (Sylvia Mae Harbaugh) </td> <td> female </td> <td align="right"> 22.00 </td> <td align="right">   1 </td> <td align="right">   1 </td> <td> 248738 </td> <td align="right"> 29.00 </td> <td>  </td> <td> S </td> </tr>
  <tr> <td align="right"> 218 </td> <td align="right"> 218 </td> <td align="right">   0 </td> <td align="right">   2 </td> <td> Jacobsohn, Mr. Sidney Samuel </td> <td> male </td> <td align="right"> 42.00 </td> <td align="right">   1 </td> <td align="right">   0 </td> <td> 243847 </td> <td align="right"> 27.00 </td> <td>  </td> <td> S </td> </tr>
  <tr> <td align="right"> 423 </td> <td align="right"> 423 </td> <td align="right">   0 </td> <td align="right">   3 </td> <td> Zimmerman, Mr. Leo </td> <td> male </td> <td align="right"> 29.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 315082 </td> <td align="right"> 7.88 </td> <td>  </td> <td> S </td> </tr>
  <tr> <td align="right"> 723 </td> <td align="right"> 723 </td> <td align="right">   0 </td> <td align="right">   2 </td> <td> Gillespie, Mr. William Henry </td> <td> male </td> <td align="right"> 34.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 12233 </td> <td align="right"> 13.00 </td> <td>  </td> <td> S </td> </tr>
  <tr> <td align="right"> 814 </td> <td align="right"> 814 </td> <td align="right">   0 </td> <td align="right">   3 </td> <td> Andersson, Miss. Ebba Iris Alfrida </td> <td> female </td> <td align="right"> 6.00 </td> <td align="right">   4 </td> <td align="right">   2 </td> <td> 347082 </td> <td align="right"> 31.27 </td> <td>  </td> <td> S </td> </tr>
   </table>
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> str(train)
'data.frame':	891 obs. of  12 variables:
 $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...
 $ Survived   : int  0 1 1 1 0 0 0 0 1 1 ...
 $ Pclass     : int  3 1 3 1 3 3 1 3 3 2 ...
 $ Name       : chr  "Braund, Mr. Owen Harris" "Cumings, Mrs. John Bradley (Florence Briggs Thayer)" "Heikkinen, Miss. Laina" "Futrelle, Mrs. Jacques Heath (Lily May Peel)" ...
 $ Sex        : chr  "male" "female" "female" "female" ...
 $ Age        : num  22 38 26 35 35 NA 54 2 27 14 ...
 $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...
 $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...
 $ Ticket     : chr  "A/5 21171" "PC 17599" "STON/O2. 3101282" "113803" ...
 $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
 $ Cabin      : chr  NA "C85" NA "C123" ...
 $ Embarked   : chr  "S" "C" "S" "S" ...
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> missmap(train, main = "Missing Values (Training Data-set)", col = c("red", "lightgrey"))
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> missmap(test, main = "Missing Values (Testing Data-set)", col = c("red", "lightgrey"))
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> missingCabinRows <- nrow(all[is.na(all$Cabin), ])
> missingAgeRows <- nrow(all[is.na(all$Age), ])
> missingFareRows <- nrow(all[is.na(all$Fare), ])
> missingEmbarkedRows <- nrow(all[is.na(all$Embarked), ])
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> estimateMissingVariables <- function(data) {
+   predictors <- c("Age", "Sex", "Fare", "Pclass", "SibSp", "Parch", "Embarked", "Title")
+   set.seed(345)
+   capture.output(model <- mice(data[, names(data) %in% predictors], method='rf'))
+   output <- complete(model)
+   data$Age <- output$Age
+   data$Fare <- output$Fare
+   return(data)
+ }
> 
> fixedAll <- estimateMissingVariables(all)
Warning message:
Number of logged events: 2 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> customHistogram <- function(data, column, title) {
+   missing = nrow(data[is.na(data[,  column]), ])
+   ggplot(data=data, aes_string(x = column)) +
+   geom_histogram(bins = 20, na.rm = TRUE, fill = "blue", alpha = 0.2) +
+   xlab(paste(column, "(", title, ", NA Count: ", missing, ")"))
+ }
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> allAge <- customHistogram(all, "Age", "Original")
> fixedAllAge <- customHistogram(fixedAll, "Age", "Fixed")
> 
> allFare <- customHistogram(all, "Fare", "Original")
> fixedAllFare <- customHistogram(fixedAll, "Fare", "Fixed")
> 
> grid.arrange(allAge, fixedAllAge, 
+              allFare, fixedAllFare,
+              ncol=2, nrow=2)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> all <- fixedAll
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ----missingEmbarked, results='asis'---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> missingEmbarkedIndex <- is.na(train$Embarked)
> renderTable(train[missingEmbarkedIndex, ])
<!-- html table generated in R 3.6.1 by xtable 1.8-4 package -->
<!-- Thu Sep 10 12:46:34 2020 -->
<table border=1>
<tr> <th>  </th> <th> PassengerId </th> <th> Survived </th> <th> Pclass </th> <th> Name </th> <th> Sex </th> <th> Age </th> <th> SibSp </th> <th> Parch </th> <th> Ticket </th> <th> Fare </th> <th> Cabin </th> <th> Embarked </th>  </tr>
  <tr> <td align="right"> 62 </td> <td align="right">  62 </td> <td align="right">   1 </td> <td align="right">   1 </td> <td> Icard, Miss. Amelie </td> <td> female </td> <td align="right"> 38.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 113572 </td> <td align="right"> 80.00 </td> <td> B28 </td> <td>  </td> </tr>
  <tr> <td align="right"> 830 </td> <td align="right"> 830 </td> <td align="right">   1 </td> <td align="right">   1 </td> <td> Stone, Mrs. George Nelson (Martha Evelyn) </td> <td> female </td> <td align="right"> 62.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 113572 </td> <td align="right"> 80.00 </td> <td> B28 </td> <td>  </td> </tr>
   </table>
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> estimateMissingEmbarked <- function(data) {
+   missing <- data[is.na(data$Embarked), ]
+   present <- data[!is.na(data$Embarked), ]
+ 
+   fol <- formula(Embarked ~ Sex + Age + Fare + Pclass + SibSp + Parch)
+   model <- rpart(fol, method='class', data=present)
+   missing$Embarked <-predict(model, missing, type="class")
+   all <- rbind.fill(missing, present)
+   all <- all[with(all, order(PassengerId)), ]
+   return(all)
+ }
> 
> all <- estimateMissingEmbarked(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ----fixedEmbarked, results='asis'-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> renderTable(train[missingEmbarkedIndex, ])
<!-- html table generated in R 3.6.1 by xtable 1.8-4 package -->
<!-- Thu Sep 10 12:46:34 2020 -->
<table border=1>
<tr> <th>  </th> <th> PassengerId </th> <th> Survived </th> <th> Pclass </th> <th> Name </th> <th> Sex </th> <th> Age </th> <th> SibSp </th> <th> Parch </th> <th> Ticket </th> <th> Fare </th> <th> Cabin </th> <th> Embarked </th>  </tr>
  <tr> <td align="right"> 1 </td> <td align="right">  62 </td> <td align="right">   1 </td> <td align="right">   1 </td> <td> Icard, Miss. Amelie </td> <td> female </td> <td align="right"> 38.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 113572 </td> <td align="right"> 80.00 </td> <td> B28 </td> <td> C </td> </tr>
  <tr> <td align="right"> 2 </td> <td align="right"> 830 </td> <td align="right">   1 </td> <td align="right">   1 </td> <td> Stone, Mrs. George Nelson (Martha Evelyn) </td> <td> female </td> <td align="right"> 62.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 113572 </td> <td align="right"> 80.00 </td> <td> B28 </td> <td> C </td> </tr>
   </table>
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> toFactor <- function(data) {
+    columns <- intersect(names(data), c("Survived", "Sex", "Embarked", "Pclass", "Ticket"))
+   data[, columns] <- lapply(data[, columns] , factor)
+   return(data)
+ }
> 
> all <- toFactor(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> str(train)
'data.frame':	891 obs. of  12 variables:
 $ PassengerId: int  1 2 3 4 5 6 7 8 9 10 ...
 $ Survived   : Factor w/ 2 levels "0","1": 1 2 2 2 1 1 1 1 2 2 ...
 $ Pclass     : Factor w/ 3 levels "1","2","3": 3 1 3 1 3 3 1 3 3 2 ...
 $ Name       : chr  "Braund, Mr. Owen Harris" "Cumings, Mrs. John Bradley (Florence Briggs Thayer)" "Heikkinen, Miss. Laina" "Futrelle, Mrs. Jacques Heath (Lily May Peel)" ...
 $ Sex        : Factor w/ 2 levels "female","male": 2 1 1 1 2 2 2 2 1 1 ...
 $ Age        : num  22 38 26 35 35 39 54 2 27 14 ...
 $ SibSp      : int  1 1 0 1 0 0 0 3 0 1 ...
 $ Parch      : int  0 0 0 0 0 0 0 1 2 0 ...
 $ Ticket     : Factor w/ 929 levels "110152","110413",..: 721 817 915 66 650 374 110 542 478 175 ...
 $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
 $ Cabin      : chr  NA "C85" NA "C123" ...
 $ Embarked   : Factor w/ 3 levels "C","Q","S": 3 1 3 3 3 2 3 3 3 1 ...
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> sample <- head(train, 12)
> sample$Name
 [1] "Braund, Mr. Owen Harris"                            
 [2] "Cumings, Mrs. John Bradley (Florence Briggs Thayer)"
 [3] "Heikkinen, Miss. Laina"                             
 [4] "Futrelle, Mrs. Jacques Heath (Lily May Peel)"       
 [5] "Allen, Mr. William Henry"                           
 [6] "Moran, Mr. James"                                   
 [7] "McCarthy, Mr. Timothy J"                            
 [8] "Palsson, Master. Gosta Leonard"                     
 [9] "Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)"  
[10] "Nasser, Mrs. Nicholas (Adele Achem)"                
[11] "Sandstrom, Miss. Marguerite Rut"                    
[12] "Bonnell, Miss. Elizabeth"                           
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> namePattern <- "(.+),\\s*(.+?)\\..+"
> 
> extractSurname <- function(name) {
+   return(str_match_all(name, namePattern)[[1]][2])
+ }
> 
> addSurname <- function(data) {
+   data$Surname <- sapply(data$Name, extractSurname)
+   data[, "Surname"] <- as.factor(data[, "Surname"])
+   return(data)
+ }
> 
> all <- addSurname(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> extractTitle <- function(name) {
+   return(str_match_all(name, namePattern)[[1]][3])
+ }
> 
> addTitle <- function(data) {
+   data$Title <- sapply(data$Name, extractTitle)
+   data[, "Title"] <- as.factor(data[, "Title"])
+   return(data)
+ }
> 
> all <- addTitle(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> countBarchart <- function(data, column, title) {
+    ggplot(data, aes_string(x=column)) + 
+    geom_bar(fill = "blue", alpha = 0.2) +
+    geom_text(stat='count', aes(label=sprintf("%d\n(%d %%)", ..count.., round(..count.. * 100/sum(..count..), 0)), vjust=0)) +
+    xlab(paste(column, "(", title, ")"))
+ }
> 
> countBarchart(train, "Title", "Overall")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> addTitleWO <- function(data) {
+   frequent <- c("Mr", "Miss", "Mrs", "Master")
+   data$TitleWO <- sapply(data$Name, extractTitle)
+   data$TitleWO[!(data$Title %in% frequent)] <- "Rare"
+   data[, "TitleWO"] <- as.factor(data[, "TitleWO"])
+   return(data)
+ }
> 
> all <- addTitleWO(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> countBarchart(train, "TitleWO", "Overall")
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultCountBarchart <- function(data, column, categoryColumn) {
+   survivors <- plyr::count(data, vars=c(column, categoryColumn))
+   survivors <- group_by_(survivors, column) %>% dplyr::mutate(Percentage = round(freq * 100 / sum(freq)))
+ 
+   ggplot(data = survivors, aes_string(x = column, y = "Percentage", fill = categoryColumn)) +
+     geom_bar(stat="identity", position = "dodge") +
+     geom_text(aes(label=sprintf("%d\n(%d %%)", freq, Percentage)))
+ }
> 
> categoricalResultCountBarchart(train, "TitleWO", "Survived")
Warning message:
`group_by_()` is deprecated as of dplyr 0.7.0.
Please use `group_by()` instead.
See vignette('programming') for more help
[90mThis warning is displayed once every 8 hours.[39m
[90mCall `lifecycle::last_warnings()` to see where this warning was generated.[39m 
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultCountBarchart(train, "Sex", "Survived")
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultHistogram <- function(data, column, categoryColumn, breaks) {
+   groupColumn <- paste0(column, "Group")
+   suppressWarnings(data[, groupColumn] <- cut2(data[, column], g=breaks, digits=0))
+   survivors <- plyr::count(data, vars=c(groupColumn, categoryColumn))
+   survivors <- group_by_(survivors, groupColumn) %>% dplyr::mutate(Percentage = round(freq * 100 / sum(freq)))
+ 
+   ggplot(data = survivors, aes_string(x = groupColumn, y = "Percentage", fill = categoryColumn)) +
+     geom_bar(stat="identity", position = "dodge") +
+     geom_text(aes(label=sprintf("%d\n(%d %%)", freq, Percentage))) +
+     xlab(column)
+ }
> 
> categoricalResultHistogram(train, "Age", "Survived", 10)
> 
> 
> ## ---- fig.width = 6, fig.height = 12---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> createBoxPlotLabels <- function(data, column) {
+   meta <- boxplot.stats(data[, column])
+   labels <-data.frame(value=round(median(data[, column]), 4), label="Median")
+   labels <-rbind(labels,data.frame(value=round(mean(data[, column]), 4), label="Mean"))
+   labels <-rbind(labels,data.frame(value=meta$stats[2], label="1st Quartile"))
+   labels <-rbind(labels,data.frame(value=meta$stats[4], label="3rd Quartile"))
+   if(length(meta$out) > 0) labels <-rbind(labels,data.frame(value=round(median(meta$out), 4), label="Outliers Median"))
+   if(length(meta$out) > 0) labels <-rbind(labels,data.frame(value=round(mean(meta$out), 4), label="Outliers Mean"))
+   return(labels)
+ }
> 
> customBoxPlot <- function(data, column, title) {
+   labels <- createBoxPlotLabels(data, column)
+   ggplot(data, aes_string(x="factor(0)", y=column)) +
+   geom_boxplot(fill = "blue", alpha=0.2) +
+   geom_point(position = position_jitter(width = 0.2), color = "darkblue") +
+   geom_label_repel(data=labels,
+                    aes(x=factor(0), y=value, label=paste0(label, ": ", value)),
+                    colour="red", angle=0, size=3,
+                    point.padding = unit(1.0, "lines"), box.padding = unit(0.5, "lines")) +
+   xlab(title)
+ }
> 
> customBoxPlot(all, "Age", "Overall")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> quarter1Indexes <- function(data, column) {
+   meta <- boxplot.stats(data[, column])
+   q1 <- meta$stats[2]
+   return(which(data[, column] < q1))
+ }
> 
> quarter3Indexes <- function(data, column) {
+   meta <- boxplot.stats(data[, column])
+   q3 <- meta$stats[4]
+   return(which( data[, column] > q3))
+ }
> 
> outliersMedian <- function(data, column) {
+   meta <- boxplot.stats(data[, column])
+   return(median(meta$out))
+ }
> 
> addAgeWO <- function(data) {
+   data$AgeWO <- data$Age
+   q1Median <- median(data$Age[quarter1Indexes(data, "Age")])
+   q3Median <- median(data$Age[quarter3Indexes(data, "Age")])
+   data$AgeWO[quarter1Indexes(data, "Age")] <- q1Median
+   data$AgeWO[quarter3Indexes(data, "Age")] <- q3Median
+   return(data)
+ }
> 
> all <- addAgeWO(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> ageHistogram <- customHistogram(all, "Age", "Overall")
> ageWOHistogram <- customHistogram(all, "AgeWO", "Overall")
> 
> grid.arrange(ageHistogram, ageWOHistogram, ncol = 2)
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultHistogram(train, "AgeWO", "Survived", 10)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> addAgeWO <- function(data) {
+   data$AgeWO <- data$Age
+   data$AgeWO[data$Age <13] <- 12
+   q3Median <- median(data$Age[quarter3Indexes(data, "Age")])
+   data$AgeWO[quarter3Indexes(data, "Age")] <- q3Median
+   return(data)
+ }
> 
> all <- addAgeWO(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultHistogram(train, "AgeWO", "Survived", 10)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> addIsChild <- function(data) {
+   data$IsChild <- data$Age < 12
+   data[, "IsChild"] <- as.factor(data[, "IsChild"])
+   return(data)
+ }
> 
> all <- addIsChild(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> categoricalResultCountBarchart(train, "IsChild", "Survived")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> verticalLine <- function(value, name, color) {
+   label <- paste("paste(", shQuote(name), ", ", shQuote("\\n"), ", ", value, ")")
+   geomObj <- list(geom_vline(aes_string(xintercept=value), colour=color, linetype='dashed'),
+                   geom_text(aes_string(x=value, y = 0, label=label)))
+   return(geomObj)
+ }
> 
> customDensityPlot <- function(data, xColumn, title) {
+   minXColumn <- paste("min(", xColumn, ", na.rm = TRUE)")
+   medianXColumn <- paste("median(", xColumn, ", na.rm = TRUE)")
+   maxXColumn <- paste("max(", xColumn, ", na.rm = TRUE)")
+   
+   ggplot(data, aes_string(x = xColumn)) + 
+   geom_density(na.rm = TRUE, fill = "blue", alpha=0.2) +
+   xlab(paste(xColumn, "(", title, ")")) +
+ 
+   verticalLine(minXColumn,  "min", "blue") +
+   verticalLine(medianXColumn, "median", "red") +
+   verticalLine(maxXColumn, "max", "blue")
+ }
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> customDensityPlot(all, "Fare", "Overall")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> cData <- all[all$Embarked == "C", ]
> c1Data <- cData[cData$Pclass == 1, ]
> c2Data <- cData[cData$Pclass == 2, ]
> c3Data <- cData[cData$Pclass == 3, ]
> 
> sData <- all[all$Embarked == "S", ]
> s1Data <- sData[sData$Pclass == 1, ]
> s2Data <- sData[sData$Pclass == 2, ]
> s3Data <- sData[sData$Pclass == 3, ]
> 
> qData <- all[all$Embarked == "Q", ]
> q1Data <- qData[qData$Pclass == 1, ]
> q2Data <- qData[qData$Pclass == 2, ]
> q3Data <- qData[qData$Pclass == 3, ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> c1Density <- customDensityPlot(c1Data, "Fare", "1st-class, C")
> c2Density <- customDensityPlot(c2Data, "Fare", "2nd-class, C")
> c3Density <- customDensityPlot(c3Data, "Fare", "3rd-class, C")
> 
> s1Density <- customDensityPlot(s1Data, "Fare", "1st-class, S")
> s2Density <- customDensityPlot(s2Data, "Fare", "2nd-class, S")
> s3Density <- customDensityPlot(s3Data, "Fare", "3rd-class, S")
> 
> q1Density <- customDensityPlot(q1Data, "Fare", "1st-class, Q")
> q2Density <- customDensityPlot(q2Data, "Fare", "2nd-class, Q")
> q3Density <- customDensityPlot(q3Data, "Fare", "3rd-class, Q")
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> grid.arrange(c1Density, s1Density, q1Density, 
+              c2Density, s2Density, q2Density, 
+              c3Density, s3Density, q3Density, 
+              ncol=3, nrow=3)
> 
> 
> ## ----embarkedAnalysis, results='asis'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> renderTable(train[missingEmbarkedIndex, ])
<!-- html table generated in R 3.6.1 by xtable 1.8-4 package -->
<!-- Thu Sep 10 12:46:38 2020 -->
<table border=1>
<tr> <th>  </th> <th> PassengerId </th> <th> Survived </th> <th> Pclass </th> <th> Name </th> <th> Sex </th> <th> Age </th> <th> SibSp </th> <th> Parch </th> <th> Ticket </th> <th> Fare </th> <th> Cabin </th> <th> Embarked </th> <th> Surname </th> <th> Title </th> <th> TitleWO </th> <th> AgeWO </th> <th> IsChild </th>  </tr>
  <tr> <td align="right"> 1 </td> <td align="right">  62 </td> <td> 1 </td> <td> 1 </td> <td> Icard, Miss. Amelie </td> <td> female </td> <td align="right"> 38.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 113572 </td> <td align="right"> 80.00 </td> <td> B28 </td> <td> C </td> <td> Icard </td> <td> Miss </td> <td> Miss </td> <td align="right"> 47.00 </td> <td> FALSE </td> </tr>
  <tr> <td align="right"> 2 </td> <td align="right"> 830 </td> <td> 1 </td> <td> 1 </td> <td> Stone, Mrs. George Nelson (Martha Evelyn) </td> <td> female </td> <td align="right"> 62.00 </td> <td align="right">   0 </td> <td align="right">   0 </td> <td> 113572 </td> <td align="right"> 80.00 </td> <td> B28 </td> <td> C </td> <td> Stone </td> <td> Mrs </td> <td> Mrs </td> <td align="right"> 47.00 </td> <td> FALSE </td> </tr>
   </table>
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultHistogram(train, "Fare", "Survived", 6)
> 
> 
> ## ---- fig.width = 6, fig.height = 12---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> customBoxPlot(all, "Fare", "Overall")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> addFareWO <- function(data) {
+   data$FareWO <- data$Fare
+   q1Median <- median(data$Age[quarter1Indexes(data, "Fare")])
+   q3Median <- median(data$Age[quarter3Indexes(data, "Fare")])
+   data$FareWO[quarter1Indexes(data, "Fare")] <- q1Median
+   data$FareWO[quarter3Indexes(data, "Fare")] <- q3Median
+   return(data)
+ }
> 
> all <- addFareWO(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> fareHistogram <- customHistogram(all, "Fare", "Overall")
> fareWOHistogram <- customHistogram(all, "FareWO", "Overall")
> 
> grid.arrange(fareHistogram, fareWOHistogram, ncol = 2)
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultHistogram(train, "FareWO", "Survived", 6)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultCountBarchart(train, "Pclass", "Survived")
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultCountBarchart(train, "SibSp", "Survived")
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultCountBarchart(train, "Parch", "Survived")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> addIsMother <- function(data) {
+   data$IsMother <- data$Age > 21 & data$Sex == "female" & data$Parch > 0
+   data[, "IsMother"] <- as.factor(data[, "IsMother"])
+   return(data)
+ }
> 
> all <- addIsMother(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> categoricalResultCountBarchart(train, "IsMother", "Survived")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultCountBarchart(train, "Embarked", "Survived")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> cData <- train[train$Embarked == "C", ]
> qData <- train[train$Embarked == "Q", ]
> sData <- train[train$Embarked == "S", ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> cAge <- customHistogram(cData, "Age", "Embarked = C")
> qAge <- customHistogram(qData, "Age", "Embarked = Q")
> sAge <- customHistogram(sData, "Age", "Embarked = S")
> 
> cFare <- customHistogram(cData, "Fare", "Embarked = C")
> qFare <- customHistogram(qData, "Fare", "Embarked = Q")
> sFare <- customHistogram(sData, "Fare", "Embarked = S")
> 
> cSex <- countBarchart(cData, "Sex", "Embarked = C")
> qSex <- countBarchart(qData, "Sex", "Embarked = Q")
> sSex <- countBarchart(sData, "Sex", "Embarked = S")
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> grid.arrange(cAge, qAge, sAge, 
+              cFare, qFare, sFare, 
+              cSex, qSex, sSex, 
+              ncol=3, nrow=3)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> addFamilySize <- function(data) {
+   data$FamilySize <- data$SibSp + data$Parch + 1
+   return(data)
+ }
> 
> all <- addFamilySize(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> computeSurvivalRatePerColumn <- function(data, column) {
+   rates <- plyr::count(data, vars=c(column, "Survived"))
+   rates <- group_by_(rates, column) %>% dplyr::mutate(SurvivalRate = round(freq * 100 / sum(freq)))
+   rates <- rates[rates$Survived == 1, ]
+   rates <- rates[, which(names(rates) %in% c(column, "SurvivalRate"))]
+   names(rates)[names(rates) == "SurvivalRate"] <- paste0("SurvivalRateBy", column)
+   return(rates)
+ }
> 
> addSurvivalRate <- function(column, data, rateData) {
+   rates <- computeSurvivalRatePerColumn(rateData, column)
+   rateColumn <- paste0("SurvivalRateBy", column)
+   
+   if(rateColumn %in% names(data)) {
+     data <- data[ , -which(names(data) %in% c(rateColumn))]
+   }
+   data <- left_join(data, rates,by=column)
+   data[is.na(data[, rateColumn]), rateColumn] <- 0
+   return(data)
+ }
> 
> all <- addSurvivalRate("Surname", all, train)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> countBarchart(train, "SurvivalRateBySurname", "Overall")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> addFamilyID <- function(data) {
+   data$FamilyID <- paste0(data$Surname, as.character(data$FamilySize))
+   data[, "FamilyID"] <- as.factor(data[, "FamilyID"])
+   return(data)
+ }
> 
> all <- addFamilyID(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> MIN_FAMILY_SIZE <- 3
> 
> tooSmallFamiliesIndexes <- function(data) {
+   return(which(data$FamilySize < MIN_FAMILY_SIZE))
+ }
> 
> addFamilyIDWO <- function(data) {
+   data$FamilyIDWO <- paste0(data$Surname, as.character(data$FamilySize))
+   data$FamilyIDWO[tooSmallFamiliesIndexes(data)] <- paste0("FamilySize<", toString(MIN_FAMILY_SIZE))
+   data[, "FamilyIDWO"] <- as.factor(data[, "FamilyIDWO"])
+   return(data)
+ }
> 
> all <- addFamilyIDWO(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> all <- addSurvivalRate("FamilyIDWO", all, train)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> cabins <- train[!is.na(train$Cabin), ]$Cabin
> head(cabins, 12)
 [1] "C85"         "C123"        "E46"         "G6"          "C103"       
 [6] "D56"         "A6"          "C23 C25 C27" "B78"         "D33"        
[11] "B30"         "C52"        
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> allPassengers <- nrow(train)
> firstClassPercent <- round(nrow(train[train$Pclass == 1, ]) * 100 / allPassengers)
> secondClassPercent <- round(nrow(train[train$Pclass == 2, ]) * 100 / allPassengers)
> thirdClassPercent <- round(nrow(train[train$Pclass == 3, ]) * 100 / allPassengers)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> survivors <- nrow(train[train$Survived == 1, ])
> firstClassSurvivorsPercent <- round(nrow(train[train$Pclass == 1 & train$Survived == 1, ]) * 100 / survivors)
> secondClassSurvivorsPercent <- round(nrow(train[train$Pclass == 2 & train$Survived == 1, ]) * 100 / survivors)
> thirdClassSurvivorsPercent <- round(nrow(train[train$Pclass == 3 & train$Survived == 1, ]) * 100 / survivors)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> extractDeck <- function(cabin) {
+   return(toString(unique(strsplit(cabin, "[^A-Z]+")[[1]])))
+ }
> 
> addDeck <- function(data) {
+   data$Deck <- sapply(data$Cabin, extractDeck)
+   data[, "Deck"] <- as.factor(data[, "Deck"])
+   return(data)
+ }
> 
> all <- addDeck(all)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> countBarchart(train, "Deck", "Overall")
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> categoricalResultCountBarchart(train, "Deck", "Survived")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> normalizeList <- function(elems) {
+   elems <- unique(elems)
+   elems <- elems[!is.na(elems)]
+   s <- paste(elems, collapse = " ")
+   if(str_length(trimws(s)) == 0) {
+     s <- NA
+   }
+   return(s)
+ }
> 
> cabins <- all[with(all, order(Ticket)), which(names(all) %in% c("Ticket", "Cabin"))]
> cabins <- cabins %>%
+   group_by(Ticket) %>%
+   summarise(Cabin = list(Cabin))
`summarise()` ungrouping output (override with `.groups` argument)
> cabins$Cabin <- sapply(cabins$Cabin, normalizeList)
> 
> ticketsMissngCabinRows <- nrow(cabins[is.na(cabins$Cabin), ])
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> aggregateFunction <- function(s) {
+   return(paste(s, collapse = " ~ "))
+ }
> 
> tickets <- train[with(train, order(Ticket)), which(names(train) %in% c("Ticket", "Name", "Surname", "Title", "Sex"))]
> tickets <- tickets %>%
+   group_by(Ticket) %>%
+   summarise(Names = aggregateFunction(Name), 
+             Surnames = aggregateFunction(Surname), 
+             Titles = aggregateFunction(Title), 
+             Genders = aggregateFunction(Sex),
+             People = n())
`summarise()` ungrouping output (override with `.groups` argument)
> tickets <- tickets[tickets$People > 1, ]
> 
> 
> ## ---- results="asis"-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> renderTable(tickets)
<!-- html table generated in R 3.6.1 by xtable 1.8-4 package -->
<!-- Thu Sep 10 12:46:40 2020 -->
<table border=1>
<tr> <th>  </th> <th> Ticket </th> <th> Names </th> <th> Surnames </th> <th> Titles </th> <th> Genders </th> <th> People </th>  </tr>
  <tr> <td align="right"> 1 </td> <td> 110152 </td> <td> Cherry, Miss. Gladys ~ Maioni, Miss. Roberta ~ Rothes, the Countess. of (Lucy Noel Martha Dyer-Edwards) </td> <td> Cherry ~ Maioni ~ Rothes </td> <td> Miss ~ Miss ~ the Countess </td> <td> female ~ female ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 2 </td> <td> 110413 </td> <td> Taussig, Mr. Emil ~ Taussig, Mrs. Emil (Tillie Mandelbaum) ~ Taussig, Miss. Ruth </td> <td> Taussig ~ Taussig ~ Taussig </td> <td> Mr ~ Mrs ~ Miss </td> <td> male ~ female ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 3 </td> <td> 110465 </td> <td> Porter, Mr. Walter Chamberlain ~ Clifford, Mr. George Quincy </td> <td> Porter ~ Clifford </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 4 </td> <td> 111361 </td> <td> Hippach, Miss. Jean Gertrude ~ Hippach, Mrs. Louis Albert (Ida Sophia Fischer) </td> <td> Hippach ~ Hippach </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 5 </td> <td> 113505 </td> <td> Chibnall, Mrs. (Edith Martha Bowerman) ~ Bowerman, Miss. Elsie Edith </td> <td> Chibnall ~ Bowerman </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 6 </td> <td> 113572 </td> <td> Icard, Miss. Amelie ~ Stone, Mrs. George Nelson (Martha Evelyn) </td> <td> Icard ~ Stone </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 7 </td> <td> 113760 </td> <td> Carter, Mr. William Ernest ~ Carter, Miss. Lucile Polk ~ Carter, Mrs. William Ernest (Lucile Polk) ~ Carter, Master. William Thornton II </td> <td> Carter ~ Carter ~ Carter ~ Carter </td> <td> Mr ~ Miss ~ Mrs ~ Master </td> <td> male ~ female ~ female ~ male </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 8 </td> <td> 113776 </td> <td> Pears, Mrs. Thomas (Edith Wearne) ~ Pears, Mr. Thomas Clinton </td> <td> Pears ~ Pears </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 9 </td> <td> 113781 </td> <td> Allison, Miss. Helen Loraine ~ Allison, Master. Hudson Trevor ~ Allison, Mrs. Hudson J C (Bessie Waldo Daniels) ~ Cleaver, Miss. Alice </td> <td> Allison ~ Allison ~ Allison ~ Cleaver </td> <td> Miss ~ Master ~ Mrs ~ Miss </td> <td> female ~ male ~ female ~ female </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 10 </td> <td> 113789 </td> <td> Holverson, Mr. Alexander Oskar ~ Holverson, Mrs. Alexander Oskar (Mary Aline Towner) </td> <td> Holverson ~ Holverson </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 11 </td> <td> 113798 </td> <td> Cairns, Mr. Alexander ~ Serepeca, Miss. Augusta </td> <td> Cairns ~ Serepeca </td> <td> Mr ~ Miss </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 12 </td> <td> 113803 </td> <td> Futrelle, Mrs. Jacques Heath (Lily May Peel) ~ Futrelle, Mr. Jacques Heath </td> <td> Futrelle ~ Futrelle </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 13 </td> <td> 113806 </td> <td> Chambers, Mr. Norman Campbell ~ Chambers, Mrs. Norman Campbell (Bertha Griggs) </td> <td> Chambers ~ Chambers </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 14 </td> <td> 11668 </td> <td> Turpin, Mrs. William John Robert (Dorothy Ann Wonnacott) ~ Turpin, Mr. William John Robert </td> <td> Turpin ~ Turpin </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 15 </td> <td> 11751 </td> <td> Beckwith, Mr. Richard Leonard ~ Beckwith, Mrs. Richard Leonard (Sallie Monypeny) </td> <td> Beckwith ~ Beckwith </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 16 </td> <td> 11767 </td> <td> Hays, Miss. Margaret Bechstein ~ Potter, Mrs. Thomas Jr (Lily Alexenia Wilson) </td> <td> Hays ~ Potter </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 17 </td> <td> 11967 </td> <td> Bishop, Mrs. Dickinson H (Helen Walton) ~ Bishop, Mr. Dickinson H </td> <td> Bishop ~ Bishop </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 18 </td> <td> 12749 </td> <td> Perreault, Miss. Anne ~ Hays, Mrs. Charles Melville (Clara Jennings Gregg) </td> <td> Perreault ~ Hays </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 19 </td> <td> 13502 </td> <td> Andrews, Miss. Kornelia Theodosia ~ Longley, Miss. Gretchen Fiske ~ Hogeboom, Mrs. John C (Anna Andrews) </td> <td> Andrews ~ Longley ~ Hogeboom </td> <td> Miss ~ Miss ~ Mrs </td> <td> female ~ female ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 20 </td> <td> 13507 </td> <td> Silvey, Mr. William Baird ~ Silvey, Mrs. William Baird (Alice Munger) </td> <td> Silvey ~ Silvey </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 21 </td> <td> 1601 </td> <td> Bing, Mr. Lee ~ Ling, Mr. Lee ~ Lang, Mr. Fang ~ Foo, Mr. Choong ~ Lam, Mr. Ali ~ Lam, Mr. Len ~ Chip, Mr. Chang </td> <td> Bing ~ Ling ~ Lang ~ Foo ~ Lam ~ Lam ~ Chip </td> <td> Mr ~ Mr ~ Mr ~ Mr ~ Mr ~ Mr ~ Mr </td> <td> male ~ male ~ male ~ male ~ male ~ male ~ male </td> <td align="right">   7 </td> </tr>
  <tr> <td align="right"> 22 </td> <td> 16966 </td> <td> Spedden, Mrs. Frederic Oakley (Margaretta Corning Stone) ~ Burns, Miss. Elizabeth Margaret </td> <td> Spedden ~ Burns </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 23 </td> <td> 17421 </td> <td> Fleming, Miss. Margaret ~ Thayer, Mr. John Borland Jr ~ Thayer, Mrs. John Borland (Marian Longstreth Morris) ~ Thayer, Mr. John Borland </td> <td> Fleming ~ Thayer ~ Thayer ~ Thayer </td> <td> Miss ~ Mr ~ Mrs ~ Mr </td> <td> female ~ male ~ female ~ male </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 24 </td> <td> 17453 </td> <td> Goldenberg, Mr. Samuel L ~ Goldenberg, Mrs. Samuel L (Edwiga Grabowska) </td> <td> Goldenberg ~ Goldenberg </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 25 </td> <td> 17474 </td> <td> Dick, Mr. Albert Adrian ~ Dick, Mrs. Albert Adrian (Vera Gillespie) </td> <td> Dick ~ Dick </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 26 </td> <td> 19877 </td> <td> Barber, Miss. Ellen "Nellie" ~ Cavendish, Mr. Tyrell William </td> <td> Barber ~ Cavendish </td> <td> Miss ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 27 </td> <td> 19928 </td> <td> Minahan, Dr. William Edward ~ Minahan, Miss. Daisy E </td> <td> Minahan ~ Minahan </td> <td> Dr ~ Miss </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 28 </td> <td> 19943 </td> <td> Hoyt, Mr. Frederick Maxfield ~ Hoyt, Mrs. Frederick Maxfield (Jane Anne Forby) </td> <td> Hoyt ~ Hoyt </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 29 </td> <td> 19950 </td> <td> Fortune, Mr. Charles Alexander ~ Fortune, Miss. Mabel Helen ~ Fortune, Miss. Alice Elizabeth ~ Fortune, Mr. Mark </td> <td> Fortune ~ Fortune ~ Fortune ~ Fortune </td> <td> Mr ~ Miss ~ Miss ~ Mr </td> <td> male ~ female ~ female ~ male </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 30 </td> <td> 19996 </td> <td> Taylor, Mrs. Elmer Zebley (Juliet Cummins Wright) ~ Taylor, Mr. Elmer Zebley </td> <td> Taylor ~ Taylor </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 31 </td> <td> 220845 </td> <td> Herman, Miss. Alice ~ Herman, Mrs. Samuel (Jane Laver) </td> <td> Herman ~ Herman </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 32 </td> <td> 230080 </td> <td> Navratil, Mr. Michel ("Louis M Hoffman") ~ Navratil, Master. Michel M ~ Navratil, Master. Edmond Roger </td> <td> Navratil ~ Navratil ~ Navratil </td> <td> Mr ~ Master ~ Master </td> <td> male ~ male ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 33 </td> <td> 230136 </td> <td> Becker, Master. Richard F ~ Becker, Miss. Marion Louise </td> <td> Becker ~ Becker </td> <td> Master ~ Miss </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 34 </td> <td> 230433 </td> <td> Parrish, Mrs. (Lutie Davis) ~ Shelley, Mrs. William (Imanita Parrish Hall) </td> <td> Parrish ~ Shelley </td> <td> Mrs ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 35 </td> <td> 231919 </td> <td> Doling, Mrs. John T (Ada Julia Bone) ~ Doling, Miss. Elsie </td> <td> Doling ~ Doling </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 36 </td> <td> 237736 </td> <td> Nasser, Mrs. Nicholas (Adele Achem) ~ Nasser, Mr. Nicholas </td> <td> Nasser ~ Nasser </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 37 </td> <td> 239853 </td> <td> Parkes, Mr. Francis "Frank" ~ Cunningham, Mr. Alfred Fleming ~ Campbell, Mr. William </td> <td> Parkes ~ Cunningham ~ Campbell </td> <td> Mr ~ Mr ~ Mr </td> <td> male ~ male ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 38 </td> <td> 239865 </td> <td> Fynney, Mr. Joseph J ~ Gaskell, Mr. Alfred </td> <td> Fynney ~ Gaskell </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 39 </td> <td> 24160 </td> <td> Madill, Miss. Georgette Alexandra ~ Allen, Miss. Elisabeth Walton ~ Robert, Mrs. Edward Scott (Elisabeth Walton McMillan) </td> <td> Madill ~ Allen ~ Robert </td> <td> Miss ~ Miss ~ Mrs </td> <td> female ~ female ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 40 </td> <td> 243847 </td> <td> Jacobsohn, Mr. Sidney Samuel ~ Jacobsohn, Mrs. Sidney Samuel (Amy Frances Christy) </td> <td> Jacobsohn ~ Jacobsohn </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 41 </td> <td> 244252 </td> <td> Carter, Rev. Ernest Courtenay ~ Carter, Mrs. Ernest Courtenay (Lilian Hughes) </td> <td> Carter ~ Carter </td> <td> Rev ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 42 </td> <td> 244367 </td> <td> Kantor, Mr. Sinai ~ Kantor, Mrs. Sinai (Miriam Sternin) </td> <td> Kantor ~ Kantor </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 43 </td> <td> 248727 </td> <td> Leitch, Miss. Jessie Wills ~ Harper, Miss. Annie Jessie "Nina" ~ Harper, Rev. John </td> <td> Leitch ~ Harper ~ Harper </td> <td> Miss ~ Miss ~ Rev </td> <td> female ~ female ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 44 </td> <td> 248738 </td> <td> Caldwell, Master. Alden Gates ~ Caldwell, Mrs. Albert Francis (Sylvia Mae Harbaugh) </td> <td> Caldwell ~ Caldwell </td> <td> Master ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 45 </td> <td> 250644 </td> <td> Mellinger, Mrs. (Elizabeth Anne Maidment) ~ Mellinger, Miss. Madeleine Violet </td> <td> Mellinger ~ Mellinger </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 46 </td> <td> 250647 </td> <td> Greenberg, Mr. Samuel ~ Ponesell, Mr. Martin </td> <td> Greenberg ~ Ponesell </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 47 </td> <td> 250649 </td> <td> Hamalainen, Mrs. William (Anna) ~ Hamalainen, Master. Viljo </td> <td> Hamalainen ~ Hamalainen </td> <td> Mrs ~ Master </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 48 </td> <td> 250655 </td> <td> Phillips, Miss. Kate Florence ("Mrs Kate Louise Phillips Marshall") ~ Morley, Mr. Henry Samuel ("Mr Henry Marshall") </td> <td> Phillips ~ Morley </td> <td> Miss ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 49 </td> <td> 2627 </td> <td> Attalah, Miss. Malake ~ Yousseff, Mr. Gerious </td> <td> Attalah ~ Yousseff </td> <td> Miss ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 50 </td> <td> 26360 </td> <td> Quick, Mrs. Frederick Charles (Jane Richards) ~ Quick, Miss. Phyllis May </td> <td> Quick ~ Quick </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 51 </td> <td> 2651 </td> <td> Nicola-Yarred, Miss. Jamila ~ Nicola-Yarred, Master. Elias </td> <td> Nicola-Yarred ~ Nicola-Yarred </td> <td> Miss ~ Master </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 52 </td> <td> 2653 </td> <td> Nakid, Miss. Maria ("Mary") ~ Nakid, Mr. Sahid </td> <td> Nakid ~ Nakid </td> <td> Miss ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 53 </td> <td> 2659 </td> <td> Yasbeck, Mr. Antoni ~ Yasbeck, Mrs. Antoni (Selini Alexander) </td> <td> Yasbeck ~ Yasbeck </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 54 </td> <td> 2661 </td> <td> Moubarek, Master. Gerios ~ Moubarek, Master. Halim Gonios ("William George") </td> <td> Moubarek ~ Moubarek </td> <td> Master ~ Master </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 55 </td> <td> 2665 </td> <td> Zabour, Miss. Hileni ~ Zabour, Miss. Thamine </td> <td> Zabour ~ Zabour </td> <td> Miss ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 56 </td> <td> 2666 </td> <td> Baclini, Miss. Marie Catherine ~ Baclini, Miss. Helene Barbara ~ Baclini, Miss. Eugenie ~ Baclini, Mrs. Solomon (Latifa Qurban) </td> <td> Baclini ~ Baclini ~ Baclini ~ Baclini </td> <td> Miss ~ Miss ~ Miss ~ Mrs </td> <td> female ~ female ~ female ~ female </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 57 </td> <td> 2668 </td> <td> Peter, Miss. Anna ~ Peter, Mrs. Catherine (Catherine Rizk) </td> <td> Peter ~ Peter </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 58 </td> <td> 2678 </td> <td> Boulos, Mrs. Joseph (Sultana) ~ Boulos, Miss. Nourelain </td> <td> Boulos ~ Boulos </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 59 </td> <td> 2691 </td> <td> Barbara, Mrs. (Catherine David) ~ Barbara, Miss. Saiide </td> <td> Barbara ~ Barbara </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 60 </td> <td> 2699 </td> <td> Albimona, Mr. Nassef Cassem ~ Hassan, Mr. Houssein G N </td> <td> Albimona ~ Hassan </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 61 </td> <td> 28403 </td> <td> McKane, Mr. Peter David ~ Downton, Mr. William James </td> <td> McKane ~ Downton </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 62 </td> <td> 2908 </td> <td> Beane, Mr. Edward ~ Beane, Mrs. Edward (Ethel Clarke) </td> <td> Beane ~ Beane </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 63 </td> <td> 29106 </td> <td> Richards, Master. William Rowe ~ Richards, Mrs. Sidney (Emily Hocking) ~ Richards, Master. George Sibley </td> <td> Richards ~ Richards ~ Richards </td> <td> Master ~ Mrs ~ Master </td> <td> male ~ female ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 64 </td> <td> 29750 </td> <td> Brown, Mrs. Thomas William Solomon (Elizabeth Catherine Ford) ~ Brown, Mr. Thomas William Solomon </td> <td> Brown ~ Brown </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 65 </td> <td> 3101278 </td> <td> Backstrom, Mrs. Karl Alfred (Maria Mathilda Gustafsson) ~ Backstrom, Mr. Karl Alfred </td> <td> Backstrom ~ Backstrom </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 66 </td> <td> 3101295 </td> <td> Panula, Master. Juha Niilo ~ Panula, Master. Eino Viljami ~ Panula, Mr. Ernesti Arvid ~ Panula, Mrs. Juha (Maria Emilia Ojala) ~ Panula, Mr. Jaako Arnold ~ Panula, Master. Urho Abraham </td> <td> Panula ~ Panula ~ Panula ~ Panula ~ Panula ~ Panula </td> <td> Master ~ Master ~ Mr ~ Mrs ~ Mr ~ Master </td> <td> male ~ male ~ male ~ female ~ male ~ male </td> <td align="right">   6 </td> </tr>
  <tr> <td align="right"> 67 </td> <td> 31027 </td> <td> Renouf, Mr. Peter Henry ~ Renouf, Mrs. Peter Henry (Lillian Jefferys) </td> <td> Renouf ~ Renouf </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 68 </td> <td> 345764 </td> <td> Vander Planke, Miss. Augusta Maria ~ Vander Planke, Mr. Leo Edmondus </td> <td> Vander Planke ~ Vander Planke </td> <td> Miss ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 69 </td> <td> 345773 </td> <td> Van Impe, Miss. Catharina ~ Van Impe, Mr. Jean Baptiste ~ Van Impe, Mrs. Jean Baptiste (Rosalie Paula Govaert) </td> <td> Van Impe ~ Van Impe ~ Van Impe </td> <td> Miss ~ Mr ~ Mrs </td> <td> female ~ male ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 70 </td> <td> 347054 </td> <td> Strom, Miss. Telma Matilda ~ Strom, Mrs. Wilhelm (Elna Matilda Persson) </td> <td> Strom ~ Strom </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 71 </td> <td> 347077 </td> <td> Asplund, Mrs. Carl Oscar (Selma Augusta Emilia Johansson) ~ Asplund, Master. Clarence Gustaf Hugo ~ Asplund, Miss. Lillian Gertrud ~ Asplund, Master. Edvin Rojj Felix </td> <td> Asplund ~ Asplund ~ Asplund ~ Asplund </td> <td> Mrs ~ Master ~ Miss ~ Master </td> <td> female ~ male ~ female ~ male </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 72 </td> <td> 347080 </td> <td> Danbom, Mrs. Ernst Gilbert (Anna Sigrid Maria Brogren) ~ Danbom, Mr. Ernst Gilbert </td> <td> Danbom ~ Danbom </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 73 </td> <td> 347082 </td> <td> Andersson, Mr. Anders Johan ~ Andersson, Miss. Ellis Anna Maria ~ Andersson, Miss. Ingeborg Constanzia ~ Andersson, Miss. Sigrid Elisabeth ~ Andersson, Mrs. Anders Johan (Alfrida Konstantia Brogren) ~ Andersson, Miss. Ebba Iris Alfrida ~ Andersson, Master. Sigvard Harald Elias </td> <td> Andersson ~ Andersson ~ Andersson ~ Andersson ~ Andersson ~ Andersson ~ Andersson </td> <td> Mr ~ Miss ~ Miss ~ Miss ~ Mrs ~ Miss ~ Master </td> <td> male ~ female ~ female ~ female ~ female ~ female ~ male </td> <td align="right">   7 </td> </tr>
  <tr> <td align="right"> 74 </td> <td> 347088 </td> <td> Skoog, Master. Harald ~ Skoog, Mrs. William (Anna Bernhardina Karlsson) ~ Skoog, Mr. Wilhelm ~ Skoog, Miss. Mabel ~ Skoog, Miss. Margit Elizabeth ~ Skoog, Master. Karl Thorsten </td> <td> Skoog ~ Skoog ~ Skoog ~ Skoog ~ Skoog ~ Skoog </td> <td> Master ~ Mrs ~ Mr ~ Miss ~ Miss ~ Master </td> <td> male ~ female ~ male ~ female ~ female ~ male </td> <td align="right">   6 </td> </tr>
  <tr> <td align="right"> 75 </td> <td> 347742 </td> <td> Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg) ~ Johnson, Miss. Eleanor Ileen ~ Johnson, Master. Harold Theodor </td> <td> Johnson ~ Johnson ~ Johnson </td> <td> Mrs ~ Miss ~ Master </td> <td> female ~ female ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 76 </td> <td> 349237 </td> <td> Arnold-Franchi, Mrs. Josef (Josefine Franchi) ~ Arnold-Franchi, Mr. Josef </td> <td> Arnold-Franchi ~ Arnold-Franchi </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 77 </td> <td> 349909 </td> <td> Palsson, Master. Gosta Leonard ~ Palsson, Miss. Torborg Danira ~ Palsson, Miss. Stina Viola ~ Palsson, Mrs. Nils (Alma Cornelia Berglund) </td> <td> Palsson ~ Palsson ~ Palsson ~ Palsson </td> <td> Master ~ Miss ~ Miss ~ Mrs </td> <td> male ~ female ~ female ~ female </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 78 </td> <td> 35273 </td> <td> Newell, Miss. Madeleine ~ Newell, Miss. Marjorie ~ Newell, Mr. Arthur Webster </td> <td> Newell ~ Newell ~ Newell </td> <td> Miss ~ Miss ~ Mr </td> <td> female ~ female ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 79 </td> <td> 35281 </td> <td> White, Mr. Richard Frasar ~ White, Mr. Percival Wayland </td> <td> White ~ White </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 80 </td> <td> 358585 </td> <td> Patchett, Mr. George ~ Garfirth, Mr. John </td> <td> Patchett ~ Garfirth </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 81 </td> <td> 363291 </td> <td> Goldsmith, Master. Frank John William "Frankie" ~ Goldsmith, Mrs. Frank John (Emily Alice Brown) ~ Goldsmith, Mr. Frank John </td> <td> Goldsmith ~ Goldsmith ~ Goldsmith </td> <td> Master ~ Mrs ~ Mr </td> <td> male ~ female ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 82 </td> <td> 364516 </td> <td> Dowdell, Miss. Elizabeth ~ Emanuel, Miss. Virginia Ethel </td> <td> Dowdell ~ Emanuel </td> <td> Miss ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 83 </td> <td> 364849 </td> <td> Bourke, Mr. John ~ Bourke, Mrs. John (Catherine) </td> <td> Bourke ~ Bourke </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 84 </td> <td> 367226 </td> <td> McCoy, Mr. Bernard ~ McCoy, Miss. Agnes </td> <td> McCoy ~ McCoy </td> <td> Mr ~ Miss </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 85 </td> <td> 367230 </td> <td> Murphy, Miss. Katherine "Kate" ~ Murphy, Miss. Margaret Jane </td> <td> Murphy ~ Murphy </td> <td> Miss ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 86 </td> <td> 36928 </td> <td> Wick, Miss. Mary Natalie ~ Wick, Mrs. George Dennick (Mary Hitchcock) </td> <td> Wick ~ Wick </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 87 </td> <td> 36947 </td> <td> Eustis, Miss. Elizabeth Mussey ~ Stephenson, Mrs. Walter Bertram (Martha Eustis) </td> <td> Eustis ~ Stephenson </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 88 </td> <td> 36973 </td> <td> Harris, Mr. Henry Birkhardt ~ Harris, Mrs. Henry Birkhardt (Irene Wallach) </td> <td> Harris ~ Harris </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 89 </td> <td> 370129 </td> <td> Rosblom, Mrs. Viktor (Helena Wilhelmina) ~ Rosblom, Mr. Viktor Richard </td> <td> Rosblom ~ Rosblom </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 90 </td> <td> 370365 </td> <td> O'Brien, Mrs. Thomas (Johanna "Hannah" Godfrey) ~ O'Brien, Mr. Thomas </td> <td> O'Brien ~ O'Brien </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 91 </td> <td> 371110 </td> <td> Moran, Miss. Bertha ~ Ryan, Mr. Patrick ~ Moran, Mr. Daniel J </td> <td> Moran ~ Ryan ~ Moran </td> <td> Miss ~ Mr ~ Mr </td> <td> female ~ male ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 92 </td> <td> 376564 </td> <td> Thorneycroft, Mrs. Percival (Florence Kate White) ~ Thorneycroft, Mr. Percival </td> <td> Thorneycroft ~ Thorneycroft </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 93 </td> <td> 382652 </td> <td> Rice, Master. Eugene ~ Rice, Master. Arthur ~ Rice, Master. Eric ~ Rice, Master. George Hugh ~ Rice, Mrs. William (Margaret Norton) </td> <td> Rice ~ Rice ~ Rice ~ Rice ~ Rice </td> <td> Master ~ Master ~ Master ~ Master ~ Mrs </td> <td> male ~ male ~ male ~ male ~ female </td> <td align="right">   5 </td> </tr>
  <tr> <td align="right"> 94 </td> <td> 392096 </td> <td> Moor, Master. Meier ~ Moor, Mrs. (Beila) </td> <td> Moor ~ Moor </td> <td> Master ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 95 </td> <td> 4133 </td> <td> Lefebre, Master. Henry Forbes ~ Lefebre, Miss. Mathilde ~ Lefebre, Miss. Ida ~ Lefebre, Miss. Jeannie </td> <td> Lefebre ~ Lefebre ~ Lefebre ~ Lefebre </td> <td> Master ~ Miss ~ Miss ~ Miss </td> <td> male ~ female ~ female ~ female </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 96 </td> <td> 54636 </td> <td> Bowen, Mr. David John "Dai" ~ Williams, Mr. Leslie </td> <td> Bowen ~ Williams </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 97 </td> <td> 7534 </td> <td> Osen, Mr. Olaf Elon ~ Gustafsson, Mr. Alfred Ossian </td> <td> Osen ~ Gustafsson </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 98 </td> <td> A/4 48871 </td> <td> Davies, Mr. Alfred J ~ Lester, Mr. James </td> <td> Davies ~ Lester </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 99 </td> <td> A/5. 3336 </td> <td> Lobb, Mr. William Arthur ~ Lobb, Mrs. William Arthur (Cordelia K Stanlick) </td> <td> Lobb ~ Lobb </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 100 </td> <td> C.A. 2315 </td> <td> Dean, Mr. Bertram Frank ~ Dean, Master. Bertram Vere </td> <td> Dean ~ Dean </td> <td> Mr ~ Master </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 101 </td> <td> C.A. 2673 </td> <td> Abbott, Mrs. Stanton (Rosa Hunt) ~ Abbott, Mr. Rossmore Edward </td> <td> Abbott ~ Abbott </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 102 </td> <td> C.A. 31921 </td> <td> Collyer, Miss. Marjorie "Lottie" ~ Collyer, Mr. Harvey ~ Collyer, Mrs. Harvey (Charlotte Annie Tate) </td> <td> Collyer ~ Collyer ~ Collyer </td> <td> Miss ~ Mr ~ Mrs </td> <td> female ~ male ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 103 </td> <td> C.A. 33112 </td> <td> Nicholls, Mr. Joseph Charles ~ Davies, Master. John Morgan Jr </td> <td> Nicholls ~ Davies </td> <td> Mr ~ Master </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 104 </td> <td> C.A. 34651 </td> <td> West, Miss. Constance Mirium ~ West, Mr. Edwy Arthur ~ West, Mrs. Edwy Arthur (Ada Mary Worth) </td> <td> West ~ West ~ West </td> <td> Miss ~ Mr ~ Mrs </td> <td> female ~ male ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 105 </td> <td> C.A. 37671 </td> <td> Coutts, Master. William Loch "William" ~ Coutts, Master. Eden Leslie "Neville" </td> <td> Coutts ~ Coutts </td> <td> Master ~ Master </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 106 </td> <td> CA 2144 </td> <td> Goodwin, Master. William Frederick ~ Goodwin, Miss. Lillian Amy ~ Goodwin, Master. Sidney Leonard ~ Goodwin, Master. Harold Victor ~ Goodwin, Mrs. Frederick (Augusta Tyler) ~ Goodwin, Mr. Charles Edward </td> <td> Goodwin ~ Goodwin ~ Goodwin ~ Goodwin ~ Goodwin ~ Goodwin </td> <td> Master ~ Miss ~ Master ~ Master ~ Mrs ~ Mr </td> <td> male ~ female ~ male ~ male ~ female ~ male </td> <td align="right">   6 </td> </tr>
  <tr> <td align="right"> 107 </td> <td> CA. 2343 </td> <td> Sage, Master. Thomas Henry ~ Sage, Miss. Constance Gladys ~ Sage, Mr. Frederick ~ Sage, Mr. George John Jr ~ Sage, Miss. Stella Anna ~ Sage, Mr. Douglas Bullen ~ Sage, Miss. Dorothy Edith "Dolly" </td> <td> Sage ~ Sage ~ Sage ~ Sage ~ Sage ~ Sage ~ Sage </td> <td> Master ~ Miss ~ Mr ~ Mr ~ Miss ~ Mr ~ Miss </td> <td> male ~ female ~ male ~ male ~ female ~ male ~ female </td> <td align="right">   7 </td> </tr>
  <tr> <td align="right"> 108 </td> <td> F.C.C. 13529 </td> <td> Hart, Mr. Benjamin ~ Hart, Mrs. Benjamin (Esther Ada Bloomfield) ~ Hart, Miss. Eva Miriam </td> <td> Hart ~ Hart ~ Hart </td> <td> Mr ~ Mrs ~ Miss </td> <td> male ~ female ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 109 </td> <td> LINE </td> <td> Leonard, Mr. Lionel ~ Tornquist, Mr. William Henry ~ Johnson, Mr. William Cahoone Jr ~ Johnson, Mr. Alfred </td> <td> Leonard ~ Tornquist ~ Johnson ~ Johnson </td> <td> Mr ~ Mr ~ Mr ~ Mr </td> <td> male ~ male ~ male ~ male </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 110 </td> <td> P/PP 3381 </td> <td> Abelson, Mr. Samuel ~ Abelson, Mrs. Samuel (Hannah Wizosky) </td> <td> Abelson ~ Abelson </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 111 </td> <td> PC 17477 </td> <td> Aubart, Mme. Leontine Pauline ~ Sagesser, Mlle. Emma </td> <td> Aubart ~ Sagesser </td> <td> Mme ~ Mlle </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 112 </td> <td> PC 17485 </td> <td> Francatelli, Miss. Laura Mabel ~ Duff Gordon, Sir. Cosmo Edmund ("Mr Morgan") </td> <td> Francatelli ~ Duff Gordon </td> <td> Miss ~ Sir </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 113 </td> <td> PC 17558 </td> <td> Baxter, Mr. Quigg Edmond ~ Baxter, Mrs. James (Helene DeLaudeniere Chaput) </td> <td> Baxter ~ Baxter </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 114 </td> <td> PC 17569 </td> <td> Spencer, Mrs. William Augustus (Marie Eugenie) ~ Lurette, Miss. Elise </td> <td> Spencer ~ Lurette </td> <td> Mrs ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 115 </td> <td> PC 17572 </td> <td> Harper, Mrs. Henry Sleeper (Myna Haxtun) ~ Harper, Mr. Henry Sleeper ~ Hassab, Mr. Hammad </td> <td> Harper ~ Harper ~ Hassab </td> <td> Mrs ~ Mr ~ Mr </td> <td> female ~ male ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 116 </td> <td> PC 17582 </td> <td> Graham, Mrs. William Thompson (Edith Junkins) ~ Graham, Mr. George Edward ~ Shutes, Miss. Elizabeth W </td> <td> Graham ~ Graham ~ Shutes </td> <td> Mrs ~ Mr ~ Miss </td> <td> female ~ male ~ female </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 117 </td> <td> PC 17593 </td> <td> Giglio, Mr. Victor ~ Guggenheim, Mr. Benjamin </td> <td> Giglio ~ Guggenheim </td> <td> Mr ~ Mr </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 118 </td> <td> PC 17604 </td> <td> Meyer, Mr. Edgar Joseph ~ Meyer, Mrs. Edgar Joseph (Leila Saks) </td> <td> Meyer ~ Meyer </td> <td> Mr ~ Mrs </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 119 </td> <td> PC 17608 </td> <td> Ryerson, Miss. Emily Borie ~ Ryerson, Miss. Susan Parker "Suzette" </td> <td> Ryerson ~ Ryerson </td> <td> Miss ~ Miss </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 120 </td> <td> PC 17611 </td> <td> Frauenthal, Mrs. Henry William (Clara Heinsheimer) ~ Frauenthal, Dr. Henry William </td> <td> Frauenthal ~ Frauenthal </td> <td> Mrs ~ Dr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 121 </td> <td> PC 17755 </td> <td> Ward, Miss. Anna ~ Cardeza, Mr. Thomas Drake Martinez ~ Lesurer, Mr. Gustave J </td> <td> Ward ~ Cardeza ~ Lesurer </td> <td> Miss ~ Mr ~ Mr </td> <td> female ~ male ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 122 </td> <td> PC 17757 </td> <td> Bidois, Miss. Rosalie ~ Robbins, Mr. Victor ~ Astor, Mrs. John Jacob (Madeleine Talmadge Force) ~ Endres, Miss. Caroline Louise </td> <td> Bidois ~ Robbins ~ Astor ~ Endres </td> <td> Miss ~ Mr ~ Mrs ~ Miss </td> <td> female ~ male ~ female ~ female </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 123 </td> <td> PC 17758 </td> <td> Penasco y Castellana, Mrs. Victor de Satode (Maria Josefa Perez de Soto y Vallejo) ~ Penasco y Castellana, Mr. Victor de Satode </td> <td> Penasco y Castellana ~ Penasco y Castellana </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 124 </td> <td> PC 17760 </td> <td> Bissette, Miss. Amelia ~ Young, Miss. Marie Grice ~ Ringhini, Mr. Sante </td> <td> Bissette ~ Young ~ Ringhini </td> <td> Miss ~ Miss ~ Mr </td> <td> female ~ female ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 125 </td> <td> PC 17761 </td> <td> LeRoy, Miss. Bertha ~ Douglas, Mr. Walter Donald </td> <td> LeRoy ~ Douglas </td> <td> Miss ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 126 </td> <td> PP 9549 </td> <td> Sandstrom, Miss. Marguerite Rut ~ Sandstrom, Mrs. Hjalmar (Agnes Charlotta Bengtsson) </td> <td> Sandstrom ~ Sandstrom </td> <td> Miss ~ Mrs </td> <td> female ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 127 </td> <td> S.C./PARIS 2079 </td> <td> Mallet, Mr. Albert ~ Mallet, Master. Andre </td> <td> Mallet ~ Mallet </td> <td> Mr ~ Master </td> <td> male ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 128 </td> <td> S.O./P.P. 3 </td> <td> Mack, Mrs. (Mary) ~ Mudd, Mr. Thomas Charles </td> <td> Mack ~ Mudd </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 129 </td> <td> S.O.C. 14879 </td> <td> Hood, Mr. Ambrose Jr ~ Hickman, Mr. Stanley George ~ Davies, Mr. Charles Henry ~ Hickman, Mr. Leonard Mark ~ Hickman, Mr. Lewis </td> <td> Hood ~ Hickman ~ Davies ~ Hickman ~ Hickman </td> <td> Mr ~ Mr ~ Mr ~ Mr ~ Mr </td> <td> male ~ male ~ male ~ male ~ male </td> <td align="right">   5 </td> </tr>
  <tr> <td align="right"> 130 </td> <td> SC/Paris 2123 </td> <td> Laroche, Miss. Simonne Marie Anne Andree ~ Laroche, Mrs. Joseph (Juliette Marie Louise Lafargue) ~ Laroche, Mr. Joseph Philippe Lemercier </td> <td> Laroche ~ Laroche ~ Laroche </td> <td> Miss ~ Mrs ~ Mr </td> <td> female ~ female ~ male </td> <td align="right">   3 </td> </tr>
  <tr> <td align="right"> 131 </td> <td> STON/O2. 3101279 </td> <td> Hakkarainen, Mrs. Pekka Pietari (Elin Matilda Dolck) ~ Hakkarainen, Mr. Pekka Pietari </td> <td> Hakkarainen ~ Hakkarainen </td> <td> Mrs ~ Mr </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 132 </td> <td> W./C. 6607 </td> <td> Johnston, Mr. Andrew G ~ Johnston, Miss. Catherine Helen "Carrie" </td> <td> Johnston ~ Johnston </td> <td> Mr ~ Miss </td> <td> male ~ female </td> <td align="right">   2 </td> </tr>
  <tr> <td align="right"> 133 </td> <td> W./C. 6608 </td> <td> Ford, Mr. William Neal ~ Ford, Miss. Robina Maggie "Ruby" ~ Ford, Miss. Doolina Margaret "Daisy" ~ Ford, Mrs. Edward (Margaret Ann Watson) </td> <td> Ford ~ Ford ~ Ford ~ Ford </td> <td> Mr ~ Miss ~ Miss ~ Mrs </td> <td> male ~ female ~ female ~ female </td> <td align="right">   4 </td> </tr>
  <tr> <td align="right"> 134 </td> <td> WE/P 5735 </td> <td> Crosby, Miss. Harriet R ~ Crosby, Capt. Edward Gifford </td> <td> Crosby ~ Crosby </td> <td> Miss ~ Capt </td> <td> female ~ male </td> <td align="right">   2 </td> </tr>
   </table>
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> all <- addSurvivalRate("Ticket", all, train)
> train <- all[all$PassengerId %in% train$PassengerId, ]
> test <- all[all$PassengerId %in% test$PassengerId, ]
> 
> 
> ## ---- fig.width = 12, fig.height = 12--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> countBarchart(train, "SurvivalRateByTicket", "Overall")
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> randomForestRandomCrossValidation <- function(fml, data, metric, radius, repeats) {
+   set.seed(345)
+   control <- trainControl(method="repeatedcv", number=10, repeats=repeats, search="random")
+   
+   rfCV <- train(fml, data=data, method="rf", metric=metric, tuneLength=radius, trControl=control, importance = TRUE)
+   return(rfCV)
+ }
> 
> fml <-Survived ~ Sex + Age + Fare + Pclass + SibSp + Parch + FamilySize
> plot(randomForestRandomCrossValidation(fml, train, "Accuracy", 10, 1))
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> fml <-Survived ~ Sex + Age + Fare + Pclass + SibSp + Parch + FamilySize + Embarked + TitleWO + FamilyIDWO
> #plot(randomForestRandomCrossValidation(fml, train, "Accuracy", 10, 3))
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> mtryTunning <- function(data) {
+   set.seed(345)
+   suppressMessages(mtry <- tuneRF(data[, names(data) %in% attr(terms(fml), "term.labels")],
+                                   data[, names(data) %in% c("Survived")],
+                                   stepFactor=3.0,
+                                   improve=1e-8,
+                                   ntree=500,
+                                   trace=FALSE))
+   return(mtry)
+ }
> 
> fml <-Survived ~ Sex + Age + Fare + Pclass + SibSp + Parch + FamilySize + Embarked + TitleWO
> print(mtryTunning(train))
0 1e-08 
-0.09333333 1e-08 
      mtry  OOBError
1.OOB    1 0.1683502
3.OOB    3 0.1683502
9.OOB    9 0.1840629
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> RandomForestBuilder <- function() {
+   mtry = 1
+   
+   name = paste("Random Forest (randomForest) mtry:", mtry)
+   
+   model = function(fml, data) {
+     set.seed(345)
+     numVars <- length(attr(terms(fml), "term.labels"))
+     maxMtry <- floor(sqrt(numVars))
+     
+     if (mtry > maxMtry) {
+       return(randomForest(formula(fml), data = data))
+     }
+     return(randomForest(formula(fml), data = data, mtry = mtry))
+   }
+   
+   predictions = function(model, data) {
+     return(stats::predict(model, newdata = data, type = "class"))
+   }
+   
+   probabilities = function(model, data) {
+     result <- predict(model, newdata=data, type="prob")
+     return(result[, 2])
+   }
+   
+   return(list(name=name, model=model, predictions=predictions, probabilities=probabilities))
+ }
> 
> RandomForestRandomCVBuilder <- function() {
+   name = "Random Forest with Random Search Cross Validation (rpart)"
+   
+   model = function(fml, data) {
+     set.seed(345)
+     return(randomForestRandomCrossValidation(fml, data, "Accuracy", radius=10, repeats=3))
+   }
+   
+   predictions = function(model, data) {
+     return(stats::predict(model, newdata = data, type = "raw"))
+   }
+   
+   probabilities = function(model, data) {
+     result <- predict(model, newdata=data, type="prob")
+     return(result[, 2])
+   }
+   
+   return(list(name=name, model=model, predictions=predictions, probabilities=probabilities))
+ }
> 
> DecisionTreeBuilder <- function() {
+   name = "Decision Tree (rpart)"
+   
+   model = function(fml, data) {
+     set.seed(345)
+     return(rpart(fml, data = data, method="class"))
+   }
+   
+   predictions = function(model, data) {
+     return(stats::predict(model, newdata = data, type = "class"))
+   }
+   
+   probabilities = function(model, data) {
+     result <- predict(model, newdata=data, type="prob")
+     return(result[, 2])
+   }
+   
+   return(list(name=name, model=model, predictions=predictions, probabilities=probabilities))
+ }
> 
> ConditionalInferenceBuilder <- function() {
+   mtry = 3
+   
+   name = paste("Conditional Inference Forest (party) mtry: ", mtry)
+   
+   model = function(fml, data) {
+     set.seed(345)
+     
+     numVars <- length(attr(terms(fml), "term.labels"))
+     maxMtry <- floor(sqrt(numVars))
+     
+     if (mtry > maxMtry) {
+       return(cforest(fml, data = data, controls=cforest_unbiased()))
+     }
+     return(cforest(fml, data = data, controls=cforest_unbiased(mtry = mtry)))
+   }
+   
+   predictions = function(model, data) {
+     return(stats::predict(model, newdata = data, type = "response"))
+   }
+   
+   probabilities = function(model, data) {
+     result <- predict(model, newdata=data, type="prob")
+     result <- lapply(result, `[`, 2)
+     return(result)
+   }
+   
+   return(list(name=name, model=model, predictions=predictions, probabilities=probabilities))
+ }
> 
> SVMBuilder <- function(fml, data) {
+   name = "SVM (e1071)"
+   
+   model = function(fml, data) {
+     set.seed(345)
+     return(svm(formula(fml), data = data, probability=TRUE))
+   }
+   
+   predictions = function(model, data) {
+     return(stats::predict(model, newdata = data, type = "class"))
+   }
+   
+   probabilities = function(model, data) {
+     result <- stats::predict(model, newdata = data, probability=TRUE)
+     return(attr(result, "probabilities")[, 2])
+   }
+   
+   return(list(name=name, model=model, predictions=predictions, probabilities=probabilities))
+ }
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> builder <- DecisionTreeBuilder()
> fml <-Survived ~ Sex + Age + Fare + Pclass + SibSp + Parch + FamilySize + Embarked + TitleWO + FamilyIDWO
> model <- builder$model(fml, train)
> fancyRpartPlot(model)
> 
> 
> ## --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> fmeasure <- function(confusion) {
+   p <- confusion$byClass["Pos Pred Value"]
+   r <- confusion$byClass["Sensitivity"]
+   f <- 2 * ((p * r) / (p + r))
+   return(f)
+ }
> 
> accuracy <- function(confusion) {
+   return(confusion$overall["Accuracy"])
+ }
> 
> createFormulaName <- function(fml) {
+   formulaName <- paste(format(fml), collapse = "")
+   formulaName <- str_replace_all(formulaName, "[\\s]", "")
+   return(formulaName)
+ }
> 
> evaluateModel <- function(fml, ModelBuilder, predictionColumn, trainData, testData) {
+   formula <- createFormulaName(fml)
+   modelBuilder <- ModelBuilder()
+   model <- modelBuilder$model(fml, trainData)
+   predictions <- modelBuilder$predictions(model, testData)
+   confusion <- confusionMatrix(data = predictions, reference = testData$Survived)
+   evaluation <- data.frame(model = modelBuilder$name, 
+                            formula = formula,
+                            accuracy = accuracy(confusion), 
+                            fmeasure = fmeasure(confusion), 
+                            stringsAsFactors=FALSE)
+   return(evaluation)
+ }
> 
> evaluateModels <- function(formulas, ModelBuilders, predictionColumn, data, testData = NULL) {
+   set.seed(3456)
+   if(is.null(testData)) {
+     trainIdx <- createDataPartition(data$Survived, p = 0.6, list = FALSE, times = 1)
+     trainData <- data[trainIdx,]
+     testData <- data[-trainIdx,]
+   } else {
+     trainData <- data
+   }
+   
+   evaluations <- data.frame(model = character(), 
+                             formula = character(), 
+                             accuracy = numeric(0), 
+                             fmeasure = numeric(0), 
+                             stringsAsFactors=FALSE)
+ 
+   for (ModelBuilder in ModelBuilders) {
+     for (fml in formulas) {
+       evaluation <- evaluateModel(fml, ModelBuilder, predictionColumn, trainData, testData)
+       evaluations <- bind_rows(evaluations, evaluation)
+     }
+   }
+   renderTable(evaluations)
+ }
> 
> 
> ## ---- results="asis"-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
> trainIdx <- createDataPartition(train$Survived, p = 0.6, list = FALSE, times = 1)
> trainData <- train[trainIdx,]
> testData <- train[-trainIdx,]
> trainData <- addSurvivalRate("Surname", trainData, trainData)
> testData <- addSurvivalRate("Surname", testData, trainData)
> 
> 
> trainData <- addSurvivalRate("Ticket", trainData, trainData)
> testData <- addSurvivalRate("Ticket", testData, trainData)
> 
> trainData <- addSurvivalRate("FamilyID", trainData, trainData)
> testData <- addSurvivalRate("FamilyID", testData, trainData)
> 
> trainData <- addSurvivalRate("FamilyIDWO", trainData, trainData)
> testData <- addSurvivalRate("FamilyIDWO", testData, trainData)
> 
> formulas <- c(Survived ~ Sex,
+               Survived ~ Sex + Age,
+               Survived ~ Sex + Age + Fare,
+               Survived ~ Sex + Age + Fare + Pclass,
+               Survived ~ Sex + Age + Fare + Pclass + SibSp,
+               Survived ~ Sex + Age + Fare + Pclass + SibSp + Parch,
+               Survived ~ Sex + Age + Fare + Pclass + FamilySize,
+               Survived ~ Sex + Age + Fare + Pclass + FamilySize + Embarked,
+               Survived ~ Sex + Age + Fare + Pclass + FamilySize + Embarked + Title,
+               Survived ~ Sex + Age + Fare + Pclass + FamilySize + Embarked + TitleWO,
+               Survived ~ Sex + AgeWO + Fare + Pclass + FamilySize + Embarked + TitleWO,
+               Survived ~ Sex + AgeWO + FareWO + Pclass + FamilySize + Embarked + TitleWO,
+               Survived ~ Sex + AgeWO + FareWO + Pclass + FamilySize + Embarked + TitleWO + IsChild,
+               Survived ~ Sex + AgeWO + FareWO + Pclass + FamilySize + Embarked + TitleWO + IsChild + IsMother)
> 
> models <- c(RandomForestBuilder, SVMBuilder)
> 
> evaluateModels(formulas, models, "Survived", trainData, testData)
Error in table(data, reference, dnn = dnn, ...) : 
  all arguments must have the same length
Calls: evaluateModels ... confusionMatrix -> confusionMatrix.default -> table
Execution halted
